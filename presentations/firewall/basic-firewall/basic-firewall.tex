\documentclass[18pt,landscape,a4paper]{foils}

% HLK/ security6
\usepackage{sec6slides}

% nyheder:
% http://portswigger.net/proxy/download.html Burp proxy kan ændre
% requests
% husk 
% mindre tcpdump, mere "øvelse 1" "øvelse 2" osv.
% mine setups med John the ripper fra sylvester, evt kombineret med googlehacking?
% lidt cutenews?
% lidt mindre om dcom
% input fra Grey Hat Hacking bogen metasploit intro? kan måske 
% erstatte/udvide dcom som eksempel?

% Basic things that we need are below
\selectlanguage{danish}

%\externaldocument{unix-audit-security-oevelser}
\externaldocument{\jobname-exercises}

\begin{document}

\mytitlepage
{Basic firewall}
{Juli 2008}



\slide{Formålet med foredraget}
\vskip 2 cm

%{\hlkbig En 3 dages workshop, hvor du lærer at angribe dit netværk!}

\begin{list1}
\item At introducere Firewall begrebet 
\item At vise de sikkerhedsmæssige aspekter af firewalls og netsikkerhed
\item Kendskab til kendte sårbarheder i almindelige netværk
og hvorfor en firewall ikke beskytter mod alt
\item Minimering af risici i netværk
\item Design af netværk til minimering af risici.
\end{list1}


\slide{Hacker - cracker}

{\bfseries Det korte svar - drop diskussionen}

%Det lidt længere svar:\\
Det havde oprindeligt en anden betydning, men medierne har taget
udtrykket til sig - og idag har det begge betydninger. 

{\color{red}\hlkbig Idag er en hacker stadig en der bryder ind i systemer!}

ref. Spafford, Cheswick, Garfinkel, Stoll, ...
- alle kendte navne indenfor sikkerhed

Hvis man vil vide mere kan man starte med:
\begin{list2}
\item \emph{Cuckoo's Egg: Tracking a Spy Through the Maze of Computer
 Espionage},  Clifford Stoll  
\item \emph{Hackers: Heroes of the Computer Revolution},
Steven Levy
\item \emph{Practical Unix and Internet Security},
Simson Garfinkel, Gene Spafford, Alan Schwartz 
\end{list2}

\slide{Aftale om test af netværk}

{\bfseries Straffelovens paragraf 263 Stk. 2. Med bøde eller fængsel
  indtil 6 måneder 
straffes den, som uberettiget skaffer sig adgang til en andens
oplysninger eller programmer, der er bestemt til at bruges i et anlæg
til elektronisk databehandling.}

Hacking kan betyde:
\begin{list2}
\item At man skal betale erstatning til personer eller virksomheder
\item At man får konfiskeret sit udstyr af politiet
\item At man, hvis man er over 15 år og bliver dømt for hacking, kan
  få en bøde - eller fængselsstraf i alvorlige tilfælde 
\item At man, hvis man er over 15 år og bliver dømt for hacking, får
en plettet straffeattest. Det kan give problemer, hvis man skal finde
et job eller hvis man skal rejse til visse lande, fx USA og
Australien
\item Frit efter: \link{http://www.stophacking.dk} lavet af Det
  Kriminalpræventive Råd 
\item Frygten for terror har forstærket ovenstående - så lad være!
\end{list2}

\slide{Referencer}

\begin{list1}
\item Det meste jeg siger kan genfindes i referencer på internet, eksempelvis:
\begin{list2}
\item OpenBSD PF User's Guide\link{http://www.openbsd.org/faq/index.html}
\item Firewalling with OpenBSD's PF packet filter \link{http://home.nuug.no/~peter/pf/}
\end{list2}
\item eller i bøger som:\\
\emph{Firewalls and Internet Security:
Repelling the Wily Hacker} 2nd ed.
William R. Cheswick, Steven M. Bellovin, and Aviel D. Rubin \link{http://www.wilyhacker.com/}
\end{list1}


\slide{Kursusnetværk}

\hlkimage{22cm}{images/kursus-netvaerk.pdf}


\slide{UNIX starthjælp}
\begin{list1}
\item Da UNIX indgår er her et lille \emph{cheat sheet} til UNIX
\begin{list2}
\item DOS/Windows kommando - tilsvarende UNIX, og forklaring
\item dir - ls - står for list files, viser filnavne
\item del - rm - står for remove, sletter filer
%\item ren - mv - move flytter filer til nyt navn, rename
%\item md - mkdir - make directory, lav en mappe/katalog
\item cd - cd - change directory, skifter katalog
\item type - cat - concatenate, viser indholdet af tekstfiler 
\item more - less - viser tekstfiler en side af gangen
\item attrib - chmod - change mode, ændrer rettighederne på filer 
\end{list2}
\item Prøv bare:
  \begin{list2}
    \item {\bfseries ls} list, eller long listing med {\bfseries ls -l} 
    \item {\bfseries cat /etc/hosts} viser hosts filen 
\item {\bfseries chmod +x head.sh} - sæt execute bit på en fil så den
  kan udføres som et program med kommandoen \verb+./head.sh+
  \end{list2}
\end{list1}

\slide{Hackerværktøjer}
% måske til reference afsnit?

\begin{list1}
\item Der benyttes en del værktøjer:
\begin{list2}
\item nmap - \link{http://www.insecure.org} portscanner
%\item Nessus - \link{http://www.nessus.org} automatiseret testværktøj
%\item libnet m.fl. - \link{http://www.packetfactory.net} - diverse projekter
%  relateret til pakker og IP netværk
%\item l0phtcrack - \link{http://www.atstake.com/research/lc/} - The Password
%  Auditing and Recovery Application
\item Wireshark - \link{http://http://www.wireshark.org/} avanceret netværkssniffer
%\item F.I.R.E -  \link{http://biatchux.dmzs.com/} - en cd-rom der indeholder en 
%  bootable Linux del.
\item OpenBSD - \link{http://www.openbsd.org} operativsystem med fokus
  på sikkerhed 
%\item \link{http://www.isecom.org/} - Open Source Security Testing
%  Methodology Manual - gennemgang af elementer der bør indgå i en struktureret test 
\item BackTrack \link{http://www.remote-exploit.org/backtrack.html}
\item Putty - 
\link{http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html}
terminal emulator med indbygget SSH
\item m0n0wall - \link{http://www.m0n0.ch} gratis firewall baseret på FreeBSD


\end{list2}

\end{list1}

\slide{Hvad skal der ske?}

\begin{list1}
\item Tænk som en hacker
\item Rekognoscering
\begin{list2}
\item ping sweep, port scan
\item OS detection - TCP/IP eller banner grab
\item Servicescan - rpcinfo, netbios, ...
\item telnet/netcat interaktion med services
\end{list2}
\item Udnyttelse/afprøvning: Nessus, nikto, exploit programs
\item Oprydning vises ikke på kurset, men I bør i praksis:
\begin{list2}
\item Lav en rapport
\item Gennemgå rapporten, registrer ændringer
\item Opdater programmer, konfigurationer, arkitektur, osv. 
\end{list2}
\item I skal jo også VISE andre at I gør noget ved sikkerheden.
\end{list1}

\slide{Er Firewalls og netsikkerhed interessant?}

\hlkimage{13cm}{images/hacker-color.jpg}

\begin{center}
  

Sikkerhedsproblemerne i netværk er mange

Mange services  - mange sårbare services 
\end{center}


\slide{Jeres kendskab til firewalls}

\begin{list1}
\item Hvad kender I til firewalls?  
\end{list1}

\slide{Emner}

\begin{list2}

% historie
\item Internet som en landsby
\item Firewall historik 
\item An evening with Berferd
\item Moderne firewalls
\item Specielle features
\item personlige firewalls
% demoer
\item Unicode angreb - hjælper firewall?


\item Firewall konfiguration
\item Bloker indefra og ud
\item tips og tricks - samt diverse firewall relaterede emner
%\item Overvej at filtrere post

\end{list2}


\slide{Internet idag}

\hlkimage{14cm}{images/server-client.pdf}

\begin{list1}
\item Klienter og servere
\item Rødder i akademiske miljøer
\item Protokoller der er op til 20 år gamle
\item Meget lidt kryptering, mest på http til brug ved e-handel 
\end{list1}

\slide{Internet er åbne standarder!}

{\hlkbig \color{titlecolor}
We reject kings, presidents, and voting.\\
We believe in rough consensus and running code.\\
-- The IETF credo Dave Clark, 1992.}

\begin{list1}
\item Request for comments - RFC\\
 - er en serie af dokumenter tilbage fra 1969
\item Et RFC dokument ændres ikke, men får status Obsoleted
\item Standards track:\\
Proposed Standard $\rightarrow$ Draft Standard $\rightarrow$ Standard
\item  Åbne standarder = åbenhed, ikke garanti for sikkerhed
\end{list1}

\slide{The Internet Worm 2. nov 1988}

\begin{list1}
\item Udnyttede følgende sårbarheder
\begin{list2}
\item buffer overflow i fingerd - VAX kode
\item  Sendmail - DEBUG
\item Tillid mellem systemer: rsh, rexec, ...
\item dårlige passwords
\end{list2}
\item Avanceret + camouflage!
\begin{list2}
\item Programnavnet sat til 'sh'
\item Brugte fork() til at skifte PID jævnligt
\item password cracking med intern liste med 432 ord og /usr/dict/words
\item Fandt systemer i /etc/hosts.equiv, .rhosts, .forward, netstat ...
\end{list2}
\item Lavet af Robert T. Morris, Jr. 
\item Medførte dannelsen af CERT, \link{http://www.cert.org}
\end{list1}

\slide{CERT/CC - www.cert.org}

\hlkimage{10cm}{images/CERT-org.png}

\begin{list1}
\item Stiftet som reaktion på The Internet Worm i 1988  
\item betragtet som de seriøse - og konservative
\item informerer om sårbarheder og trusler
\item koordinerer aktiviteter - mellem leverandører
\item opsamler statistik for hacker aktivitet
\end{list1}

\slide{Firewallrollen idag}

\begin{list1}
\item Idag skal en firewall være med til at:
\begin{list2}
\item Forhindre angribere i at komme ind
\item Forhindre angribere i at sende traffik ud
\item Forhindre virus og orme i at sprede sig i netværk
\item Indgå i en samlet løsning med ISP, routere, firewalls, switchede
  strukturer, intrusion detectionsystemer samt andre dele af infrastrukturen
\end{list2}
\item Det kræver overblik!
\end{list1}

\slide{Praktiske øvelser!}

\vskip 2 cm

\begin{quote}
Planen er at vi arbejder os gennem emnet - opbygger en rigtig firewallløsning
og afprøver lidt hackerprogrammer mod systemerne
\end{quote}

\slide{Hvad er en firewall}

\vskip 4 cm
\centerline{\hlkbig En firewall er noget som {\color{green}blokerer}
  traffik på Internet}  

\vskip 1 cm
\pause

\centerline{\hlkbig En firewall er noget som {\color{red}tillader}
  traffik på Internet} 

\slide{firewalls}

\begin{list1}
\item Indeholder typisk:
  \begin{list2}
   \item Grafisk brugergrænseflade til konfiguration
\item TCP/IP filtermuligheder - pakkernes afsender, modtager, retning
  ind/ud, porte, protokol, ...
\item kun IPv4 for de kommercielle firewalls
\item både IPv4 og IPv6 for Open Source firewalls: IPF, OpenBSD PF,
  Linux firewalls, ...
\item foruddefinerede regler/eksempler
\item typisk NAT funktionalitet indbygget - NAT is BAD
\item typisk mulighed for nogle serverfunktioner:\\
  DHCP-server, DNS caching server og lignende
  \end{list2}
\item En router med Access Control Lists - kaldes ofte netværksfilter,
  mens en dedikeret maskine kaldes firewall
%  funktionen er reelt den samme - der filtreres traffik
\end{list1}


\slide{\hskip 2 cm firewalls - 100\% sikkerhed?}

\begin{center}
\colorbox{white}{\includegraphics[width=12cm]{images/kut.jpg}}  
\end{center}

\begin{list1}
\item Hvor skal en firewall placeres for at gøre størst nytte?
\item Hvad er forudsætningen for at en firewall virker?\\
At der er konfigureret et sæt fornuftige regler!
\item Hvor kommer reglerne fra? Sikkerhedspolitikken!
%\item Kan man lave en 100\% sikker firewall? Ja selvfølgelig, se!
\end{list1}


\centerline{\small Kilde: Billedet er fra Marcus Ranum The ULTIMATELY
  Secure Firewall} 



\slide{Firewall historik}


\hlkimage{6cm}{images/cheswick-cover2e.jpg}

\begin{list1}
\item Firewalls har været kendt siden starten af 90'erne
\item Den første bog \emph{Firewalls and Internet Security} udkom i
  1994 men der findes mange akademiske artikler om firewalls 
\item Bogen \emph{Firewalls and Internet Security} anbefales,  
William R. Cheswick, Steven M. Bellovin, Aviel D. Rubin,
Addison-Wesley, 2nd edition, 2003  
\end{list1}

\slide{An Evening with Berferd}


\begin{list1}
\item Artikel om en hacker der lokkes, vurderes, overvåges
\item Et tidligt eksempel på en honeypot
\item Idag anbefales The Honeynet Project hvis man vil vide mere
\\\link{http://www.honeynet.org}
\end{list1}


\slide{Kommercielle firewalls}
\begin{list2}
\item Checkpoint Firewall-1 \link{http://www.checkpoint.com}
\item Nokia appliances - Nokia IPSO \link{http://www.nokia.com}
\item Cisco PIX \link{http://www.cisco.com}
\item Clavister firewalls \link{http://www.clavister.com}
\item Netscreen - nu ejet af Juniper
  \link{http://www.juniper.net}
\end{list2}

Ovenstående er dem som jeg oftest ser ude hos mine kunder

\slide{Open source baserede firewalls}
\begin{list2} 
\item Linux firewalls - fra begyndelsen til det nuværende netfilter
  til kerner version 2.4 og 2.6\\
\link{http://www.netfilter.org}
\item Firewall GUIs ovenpå Linux - mange! IPcop, Guarddog, Watchguard
nogle Linux firewalls er kommercielle produkter
\item IP Filter (IPF) \link{http://coombs.anu.edu.au/~avalon/}
\item OpenBSD PF - findes idag på andre operativsystemer
\link{http://www.openbsd.org} 
\item FreeBSD IPFW og IPFW2 \link{http://www.freebsd.org}
\item Mac OS X benytter IPFW
\item FreeBSD inkluderer også OpenBSD PF
\item NetBSD - bruger IPF og er ved at inkludere OpenBSD PF
\end{list2}

NB: kun eksempler og dem jeg selv har brugt

\slide{personlige firewalls}

\begin{list1}
\item Personlige firewalls:  

\begin{list2}
\item Microsoft Windows XP
\item ZoneAlarm \link{http://www.zonelabs.com}  
\end{list2}
\item Personlige firewalls til Microsoft Windows inkluderer ofte
blokering af hvilket programmer der må tilgå netværk
\end{list1}

\centerline{\color{titlecolor}Det anbefales at bruge en personlig firewall}

Note: Lad være med at stille spørgsmål om logfilen i diverse fora!

{\bfseries Hvis du ikke forstår loggen så lad den ligge!}

\slide{OSI og Internet modellerne}

\hlkimage{14cm,angle=90}{images/compare-osi-ip.pdf}

\slide{Packet filtering}

\begin{alltt}
\small
0                   1                   2                   3   
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |         Header Checksum       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
\end{alltt}

\begin{list1}
\item Packet filtering er firewalls der filtrerer på IP niveau
\item Idag inkluderer de fleste statefull inspection 
\end{list1}

\slide{TCP three way handshake}

\hlkimage{7cm}{images/tcp-three-way.pdf}

\begin{list2}
\item {\bfseries TCP SYN half-open} scans
\item Tidligere loggede systemer kun når der var etableret en fuld TCP
  forbindelse - dette kan/kunne udnyttes til \emph{stealth}-scans
\item Hvis en maskine modtager mange SYN pakker kan dette fylde
  tabellen over connections op - og derved afholde nye forbindelser
  fra at blive oprette - {\bfseries SYN-flooding}
\end{list2}


\slide{Proxy servers}

\begin{list1}
\item Filtrering på højere niveauer i OSI modellen er muligt
\item Idag findes proxy applikationer til de mest almindelige
  funktioner
\item Den typiske proxy er en caching webproxy der kan foretage HTTP
  request på vegne af arbejdsstationer og gemme resultatet 
\item NB: nogle protokoller egner sig ikke til proxy servere - SSL
  forbindelser til \emph{secure websites}
\item Se eksempelvis på Squid webcache \link{http://www.squid-cache.org/}\\ 
eller Varnish reverse proxy \link{http://varnish.projects.linpro.no/}
\end{list1}

\slide{Hardware eller software}


\begin{list1}
\item Man hører indimellem begrebet \emph{hardware firewall}  
\item Det er dog et faktum at en firewall består af:
\begin{list2}
\item Netværkskort - som er hardware
\item Filtreringssoftware - som er \emph{software}!    
\end{list2}
\item Det giver ikke mening at kalde en Zyxel 10 en hardware firewall
  og en Soekris med OpenBSD for en software firewall!
\item Det er efter min mening et marketingtrick
\vskip 1 cm
\item Man kan til gengæld godt argumentere for at en dedikeret
  firewall som en separat enhed kan give bedre sikkerhed
\end{list1}


\slide{First or Last match firewall?}

\hlkimage{20cm}{images/first-last-match-1.pdf}
\begin{list2}
\item To typer af firewalls:
 First match - eksempelvis IPFW,
 Last match - eksempelvis PF
%\item {\bf Det er ekstremt vigtigt at vide hvilken type firewall
%    man bruger!} 
\end{list2}


\slide{First match - IPFW}

\begin{alltt}
\hlksmall
00100 16389  1551541 allow ip from any to any via lo0
00200     0        0 deny log ip from any to 127.0.0.0/8
00300     0        0 check-state
...
{\bfseries 
65435    36     5697 deny log ip from any to any}
65535   865    54964 allow ip from any to any
\end{alltt}

\vskip 2 cm

\centerline{Den sidste regel nås aldrig!}

\slide{Last match - OpenBSD PF}

\begin{alltt}
\small
ext_if="ext0"
int_if="int0"

block in
pass out keep state

pass quick on \{ lo $int_if \}

# Tillad forbindelser ind på port 80=http og port 53=domain
# på IP-adressen for eksterne netkort ($ext_if) syntaksen
pass in on $ext_if proto tcp to ($ext_if) port http keep state
pass in on $ext_if proto \{ tcp, udp \} to ($ext_if) port domain keep state
\end{alltt}

\vskip 2 cm
\centerline{Pakkerne markeres med block eller pass indtil sidste
  regel}
\centerline{nøgleordet \emph{quick} afslutter match - god til store
  regelsæt} 

\slide{Linux iptables/netfilter eksempel}

\begin{alltt}
\footnotesize
# Firewall configuration written by system-config-securitylevel
# Manual customization of this file is not recommended.
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:RH-Firewall-1-INPUT - [0:0]
-A INPUT -j RH-Firewall-1-INPUT
-A FORWARD -j RH-Firewall-1-INPUT
-A RH-Firewall-1-INPUT -i lo -j ACCEPT
-A RH-Firewall-1-INPUT -p icmp --icmp-type any -j ACCEPT
-A RH-Firewall-1-INPUT -p 50 -j ACCEPT
-A RH-Firewall-1-INPUT -p 51 -j ACCEPT
-A RH-Firewall-1-INPUT -p udp --dport 5353 -d 224.0.0.251 -j ACCEPT
-A RH-Firewall-1-INPUT -p udp -m udp --dport 631 -j ACCEPT
-A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 443 -j ACCEPT
-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited
COMMIT
\end{alltt}

\centerline{NB: husk at aktivere IP forwarding}

\slide{Firewall GUI}

\hlkimage{24cm}{images/fwbuilder-screenshot1.png}

\begin{list1}
\item Der findes mange GUI programmer til Open Source firewalls
\end{list1}

Kilde: billede fra \link{http://www.fwbuilder.org}


\slide{Firewalls og ICMP}


\begin{alltt}
ipfw add allow icmp from any to any icmptypes 3,4,11,12
\end{alltt}

\begin{list1}
\item Ovenstående er IPFW syntaks for at tillade de interessant ICMP beskeder igennem
\item Tillad ICMP types:
\begin{list2}
\item 3 Destination Unreachable
\item 4 Source Quench Message
\item 11 Time Exceeded
\item 12 Parameter Problem Message
\end{list2}
\end{list1}



\slide{Specielle features}

\begin{list2}
\item Network Address Translation - NAT
\item IPv6 funktionalitet
\item IPsec og Andre VPN features
\item Båndbredde håndtering
\item VLAN funktionalitet - mere udbredt i forbindelse med VoIP
\item Redundante firewalls - pfsync og CARP
% pfsync giver et indblik i hvordan den slags kan laves, hvor de
% kommercielle ``bare kan det''
\end{list2}

\slide{NAT}

\vskip 2 cm
\centerline{Network Address Translation}

\vskip 2 cm
\begin{list1}
\item En quick and dirty fix der vil forfølge os for resten af vores
  liv 
\item Ødelægger en del protokoller :-(
\item Lægger state i netværket - ødelægger fate sharing  
\end{list1}

\slide{IPv6}

\hlkimage{5cm}{images/kame-noanime-small.png}

\begin{list1}
\item IPv6 understøttes i næsten alle Open Source firewalls  
\item IPv6 understøttes i næsten ingen kommercielle firewalls  
\item Cisco PIX IPv6 support er udskudt flere gange 
\end{list1}

\centerline{Der mangler erfaring med IPv6 firewalls}

\slide{m0n0wall}

\hlkimage{20cm}{images/m0n0wall-1.pdf}

Kilde: billede fra \link{http://m0n0.ch/wall/}


\slide{Kursus netværk - 1}

\hlkimage{20cm}{images/firewall-course-netvaerk.pdf}
\slide{Kursus netværk - 2}

%\hlkimage{18cm}{images/firewall-netvaerk-1.pdf}

\begin{list2}
\item PROSA kursusnetværk er inside LAN på firewalls
\item I København benyttes 192.168.100/24, i Århus benyttes 10.0.0/24
\item WAN netværk er 5 netværk: 192.168.200/24, 
192.168.201/24,
192.168.202/24,
192.168.203/24,
192.168.204/24
\item DMZ netværk benyttes ikke som udgangspunkt 
\item Det forventes at kursisterne arbejder i hold og der er en
  firewall til hvert hold - i alt max 5 hold
\item Allesammen deler det fysiske inderside netværk, dog er der flere
  logiske switchede netværk - portbaserert VLAN
\end{list2}

\slide{Kursus netværk - 3}

\hlkimage{22cm}{images/firewall-netvaerk-3.pdf}

\begin{list2}
\item Sådan er jeres systemer konfigureret i udgangspunktet og kablet
\item vi skal tilføje adresser og routes til "WAN netværk" til arbejdspladsen!
\item Prøv kun at tænke på jeres lille del af netværket - som er vist
  på tegningen
\end{list2}

\slide{Kursus netværk - 4}

\hlkimage{20cm}{images/firewall-netvaerk-4.pdf}

\begin{list2}
\item I vores netværk er der kun en fysisk server - Fiona med HTTP webserver
\item Fiona er en server med flere adresser på hvert sit fysiske netkort
\item For at undgå at skulle splitte LAN benyttes NAT, og derfor WAN interface!
\item Tegningen viser hvor I bør placere internetservere i et rigtigt netværk
\end{list2}

\slide{Netværkskonfiguration - Windows}

\begin{list1}
\item Windows
\begin{list2}
\item Brug kontrolpanelet 
\item Ret adresserne og husk routing information    
\end{list2}
\item UNIX
\begin{list2}
\item \verb+ifconfig -a+ viser alle netkort og adresserne  
\item \verb+netstat -rn+ viser routing informationerne
\item \verb+ifconfig eth0 10.1.2.3 netmask 255.255.255.0+\\ sætter
  adressen 10.1.2.3 på netkortet med navnet eth0
\item \verb+route add default 10.1.1.1+\\
sæt default route til at være 10.1.1.1
\item Kommandoen \verb+route+ kan bruges med \verb+change+ istedet for
  \verb+add+ 
\end{list2}
\item Der udleveres tilpasset routing.bat og routing.sh scripts til
  dette!
\end{list1}

\slide{Portscan demo}

\begin{list1}
\item Hvad er forskellen med og uden firewall, kan man se det?
\item Brug kursusserver, Linux boot-CD eller Windows portscanner
\item Formålet er senere at kunne afgøre om firewall virker og
  er konfigureret korrekt
\item En gylden regel er at en firewall ikke svarer på blokerede porte, sender ikke RESET pakker
\end{list1}




\slide{Vores firewall giver optimal sikkerhed}

\begin{quote}
Vi har en server og har sat den bagved firewalls!

Den er sikker!
\end{quote}

\centerline{Desværre ikke!}

\slide{Start på demo: DCOM sårbarhed}

\hlkimage{13cm}{images/server-client.pdf}

\begin{list2}
\item To almindelige computere - en switch erstatter Internet
\item VMware player benyttes til det sårbare Windows 2000 system
\item Windows er installeret på et system og ikke opdateret
\item dcom.c exploit er hentet fra Internet og bruges næsten uændret
\end{list2}

\slide{Hvad sker der?}

\begin{alltt}
\hlksmall
[hlk@fiona hlk]$ ./dcom 6 10.0.0.206
---------------------------------------------------------
- Remote DCOM RPC Buffer Overflow Exploit
- Original code by FlashSky and Benjurry
- Rewritten by HDM <hdm [at] metasploit.com>
- Using return address of 0x77e626ba
- Dropping to System Shell...

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

\verb+C:\WINDOWS\system32>+exit   {\bf - find selv på kommandoer, fri adgang!!}
exit

 - Read failure
[hlk@fiona hlk]$ 
\end{alltt}

\slide{Unicode - det klassiske port 80 problem}

\hlkimage{22cm}{images/unicode-1.pdf}

\begin{list1}
\item Hvorfor går det galt? gennemgang på tavlen
\item Traffikken går via de godkendte porte - normal port 80 webtraffik
\end{list1}


\slide{Når adgangen er skabt}

\begin{list1}
\item Så går man igang med de almindelige værktøjer
\item Fyodor Top 100 Network Security Tools\\ \link{http://sectools.org/}  
\end{list1}
\vskip 2 cm

\centerline{\hlkbig Forsvaret er som altid - flere lag af sikkerhed! }
(engelsk: Security in depth)

\slide{Firewall er ikke alene}

\begin{list1}
\item Firewalls er ikke alene
\begin{list2}
\item anti-virus på klienter og postsystemer
\item IDS systemer
\item Backupsystemer
\item Adgangskontrol
\item ... mange andre ting er mindst ligeså vigtige
\end{list2}
\end{list1}



\slide{Firewall konfiguration}

\begin{list1}
\item Den bedste firewall konfiguration starter med:
\begin{list2}
\item Papir og blyant
\item En fornuftig adressestruktur
\end{list2}
\item Brug dernæst en firewall med GUI første gang!
\item Husk dernæst:
\begin{list2}
\item En firewall skal passes
\item En firewall skal opdateres
\item Systemerne bagved skal hærdes!    
\end{list2}
\end{list1}


\slide{En typisk firewall konfiguration}

\hlkimage{22cm}{images/firma-netvaerk.pdf}

\centerline{Opdeling i separate netværkssegmenter!}


\slide{Bloker indefra og ud}

\begin{list1}
\item Der er porte og services som altid bør blokeres
\item Det kan være kendte sårbare services
\begin{list2}
\item Windows SMB filesharing - ikke til brug på Internet!
\item UNIX NFS - ikke til brug på Internet!
\end{list2}
\item Kendte problemer:
\begin{list2}
\item KaZaA og andre P2P programmer - hvis muligt!
\item Portmapper - port 111    
\end{list2}
\end{list1}

%\slide{Forslag til døde porte i firmanetværk}

%\begin{alltt}
%25/TCP
%139/TCP
%445/TCP
%9996/TCP
%5554/TCP
%gnutella.fileflash.com:6346/TCP
%gnet2.ath.cx:6346/TCP
%public.bearshare.net:6346/TCP
%connect1.bearshare.net:6346/TCP
%connect2.bearshare.net:6346/TCP
%connect3.bearshare.net:6346/TCP
%update.kazaa.com:*
%*:1214/TCP
%*:1214/UDP
%\end{alltt}


\slide{IPsec og Andre VPN features}

\begin{list1}
\item De fleste firewalls giver mulighed for at lave krypterede
  tunneler
\item Nyttigt til fjernkontorer der skal have usikker traffik henover
  usikre netværk som Internet 
\item Konceptet kaldes Virtual Private Network VPN
\item IPsec er de facto standarden for VPN og beskrevet i RFC'er 
\end{list1}

\slide{IPsec - de facto for VPN}

\begin{list1}
\item Giver sikkerhed i netværket på lavt niveau - IP-niveau
\begin{list2}
\item RFC-2401 Security Architecture for the Internet Protocol
\item RFC-2402 IP Authentication Header (AH)
\item RFC-2406 IP Encapsulating Security Payload (ESP)
\item RFC-2409 The Internet Key Exchange (IKE) - dynamisk keying
\end{list2}
\item Både til IPv4 og IPv6
\item {\bfseries MANDATORY} i IPv6! - et krav hvis man implementerer
  fuld IPv6 support
\item god præsentation på\\ \link{http://www.hsc.fr/presentations/ike/}
\end{list1}

\slide{IPsec er ikke simpelt!}

\begin{center}
\colorbox{white}{\includegraphics[width=16cm]{images/ipsec-hsc.png}}  
\end{center}
\centerline{Kilde: \link{http://www.hsc.fr/presentations/ike/}}


\slide{RFC-2402 IP AH}

\begin{alltt}
\small
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Next Header   |  Payload Len  |          RESERVED             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Security Parameters Index (SPI)               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Sequence Number Field                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                Authentication Data (variable)                 |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\end{alltt}

\slide{RFC-2402 IP AH}

Indpakning - pakkerne før og efter Authentication Header: 
\begin{alltt}
\small
                BEFORE APPLYING AH
            ----------------------------
      IPv4  |orig IP hdr  |     |      |
            |(any options)| TCP | Data |
            ----------------------------

                  AFTER APPLYING AH
            ---------------------------------
      IPv4  |orig IP hdr  |    |     |      |
            |(any options)| AH | TCP | Data |
            ---------------------------------
            |<------- authenticated ------->|
                 except for mutable fields
\end{alltt}

\slide{RFC-2406 IP ESP}

Pakkerne før og efter:
\begin{alltt}
\small 
            BEFORE APPLYING ESP
      ---------------------------------------
IPv6  |             | ext hdrs |     |      |
      | orig IP hdr |if present| TCP | Data |
      ---------------------------------------



            AFTER APPLYING ESP
      ---------------------------------------------------------
IPv6  | orig |hop-by-hop,dest*,|   |dest|   |    | ESP   | ESP|
      |IP hdr|routing,fragment.|ESP|opt*|TCP|Data|Trailer|Auth|
      ---------------------------------------------------------
                                   |<---- encrypted ---->|
                               |<---- authenticated ---->| 
\end{alltt}

\slide{OpenVPN}

\begin{quote}
OpenVPN is a full-featured SSL VPN solution which can accomodate a
wide range of configurations, including remote access, site-to-site
VPNs, WiFi security, and enterprise-scale remote access solutions with
load balancing, failover, and fine-grained access-controls (articles)
(examples) (security overview) (non-english languages).   
\end{quote}

\begin{list1}
\item Et andet populært VPN produkt er OpenVPN
\item Kilde: \link{http://openvpn.net/}  
\end{list1}

\slide{OpenSSH portforward}


\begin{list1}
\item OpenSSH kan bruges både til login og til filoverførsel
\item Men den kan også forwarde porte over usikre netværk\\
\verb+ssh -L2500:127.0.0.1:25 mail.kramse.dk+

\item De senere versioner kan oprette tun interface til VPN brug
\item Secure Shell kan bruges som "fattigmandsVPN"
\end{list1}


\slide{Videregående firewalls}

\begin{list1}
\item Mange firewalls tilbyder idag mere avancerede funktioner
\item Båndbreddestyring  
\item Firewallcluster redundante firewalls
\item Virtuelle firewalls, firewall blades, men også i produkter som VMware
\end{list1}

\slide{Båndbreddestyring}

\begin{list1}
\item Mange firewalls idag kan lave båndbredde allokering til
  protokoller, porte og derved bestemte services
\item Mest kendte er i Open Source:
\begin{list2}
\item ALTQ bruges på OpenBSD - integreret i PF
%  \link{http://www.csl.sony.co.jp/person/kjc/kjc/software.html}
\item FreeBSD har dummynet
\item Linux har tilsvarende\\
ADSL-Bandwidth-Management-HOWTO, ADSL Bandwidth Management HOWTO\\
Adv-Routing-HOWTO, Linux Advanced Routing \& Traffic Control HOWTO\\
\link{http://www.knowplace.org/shaper/resources.html} Linux resources
\end{list2}
\end{list1}

\slide{Redundante firewalls - pfsync og CARP}

\hlkimage{7cm}{images/pfsync-carp-1.jpg}

\begin{list1}
\item OpenBSD 3.5 har fået funktionalitet til at bygge redundante
  firewalls:
\begin{list2}
\item Common Address Redundancy Protocol CARP - overtagelse af
  adresse både IPv4 og IPv6
\item pfsync - sender opdateringer om firewall states mellem de to systemer  
\item Kilde: \link{http://www.countersiege.com/doc/pfsync-carp/}
\end{list2}
\end{list1}


\slide{Design af en firewall platform}

\begin{list1}
\item Hvordan ser den perfekte firewall ud?
\item Start med papir og blyant!
\end{list1}



\slide{Hændelseshåndtering}

\hlkimage{13cm}{images/virksomhedens-netvaerk.pdf}
\begin{list2}
\item Du VIL komme ud for hændelser, man kan ikke regne med at
sikkerhedsforanstaltninger altid virker
  \item Der ER sket en hændelse - håndterer I den optimalt? - hvad er
    forøvrigt optimalt?
  \item Lav en plan over håndtering af hændelser
  \end{list2}


\slide{Hændelseshåndtering - en metode}

\begin{list1}
\item Vær forberedt på at håndtere hændelser!
\item Incident Response, E. Eugene Schultz og Russel Shumway foreslår: 
  \begin{list2}
    \item Preparation - forberedelse lær at snakke med politiet, hav
    kontaktinformation på plads, mobiltelefonnumre m.v.
\item Detection - man opdager, her kan integritetscheckere og IDS hjælpe
\item Containment - indkapsling, undgå spredning til andre systemer
\item Eradication - udryddelse af problemet, eventuelt reinstallation
  af systemer
\item Recovery - sæt systemerne i produktion igen
\item Follow-up - undgå det sker igen, opsamling af statistik om hændelser
  \end{list2}

\item \emph{ Incident Response: A Strategic Guide to Handling System and Network Security Breaches}
 af E. Eugene, Dr Schultz, Russell Shumway, Que, 2002
\end{list1}




\slide{Spørgsmål?}


\vskip 2cm

Dette afslutter det basale firewall foredrag, pause - derefter fortsættter vi med mere avancerede ting som pentestværktøjer, VLANs, WLANs osv.

\begin{center}
\hlkbig 

\myname

\myweb
\vskip 2 cm

I er altid velkomne til at sende spørgsmål på e-mail
\end{center}

\slide{Anbefalinger til jer}
% oversigt over dem

{\bf \large Oversigt over anbefalinger} 
\begin{list1}
\item {\bf Følg med!} - læs websites, bøger, artikler, mailinglister, ...
\item {\bf Vurder altid sikkerhed} - skal integreres i processer
\item {\bf Hændelseshåndtering} - du vil komme ud for sikkerhedshændelser
\item {\bf Lav en sikkerhedspolitik} - herunder software og e-mail politik 
\end{list1}


\slide{TCPDUMP - protokolanalyse pakkesniffer}

\hlkimage{14cm}{images/tcpdump-manual.pdf}


\centerline{\link{http://www.tcpdump.org}
- både til Windows og UNIX}
\slide{tcpdump - normal brug}

\begin{list2}
  \item tekstmode
\item kan gemme netværkspakker i filer
\item kan læse netværkspakker fra filer
\item er de-facto standarden for at gemme netværksdata i filer
\end{list2}

\begin{alltt}
\tiny [root@otto hlk]# tcpdump -i en0
tcpdump: listening on en0
13:29:39.947037 fe80::210:a7ff:fe0b:8a5c > ff02::1: icmp6: router advertisement
13:29:40.442920 10.0.0.200.49165 > dns1.cybercity.dk.domain:  1189+[|domain]
13:29:40.487150 dns1.cybercity.dk.domain > 10.0.0.200.49165:  1189 NXDomain*[|domain]
13:29:40.514494 10.0.0.200.49165 > dns1.cybercity.dk.domain:  24765+[|domain]
13:29:40.563788 dns1.cybercity.dk.domain > 10.0.0.200.49165:  24765 NXDomain*[|domain]
13:29:40.602892 10.0.0.200.49165 > dns1.cybercity.dk.domain:  36485+[|domain]
13:29:40.648288 dns1.cybercity.dk.domain > 10.0.0.200.49165:  36485 NXDomain*[|domain]
13:29:40.650596 10.0.0.200.49165 > dns1.cybercity.dk.domain:  4101+[|domain]
13:29:40.694868 dns1.cybercity.dk.domain > 10.0.0.200.49165:  4101 NXDomain*[|domain]
13:29:40.805160 10.0.0.200 > mail: icmp: echo request
13:29:40.805670 mail > 10.0.0.200: icmp: echo reply
...
\end{alltt}



\slide{Wireshark - grafisk pakkesniffer}

\hlkimage{20cm}{images/wireshark-website.png} 

\centerline{\link{http://www.wireshark.org}}
\centerline{både til Windows og UNIX, tidligere kendt som Ethereal}

\slide{Programhygiejne!}

\begin{list1}
  \item {\color{red}Download, installer - kør!} - farligt!
\item Sådan gøres det:
  \begin{list2}
    \item download program OG signaturfil/MD5
\item verificer signatur eller MD5
\item installer
\item brug programmet
\item hold programmet opdateret!\\
Se eksempelvis teksten på hjemmesiden:\\
\emph{Wireshark 0.99.2 has been released. Several security-related vulnerabilities have been fixed and several new features have been added.}
  \end{list2}
\item NB: ikke alle programmer har signaturer :(
\item MD5 er en envejs hash algoritme - mere om det senere
\end{list1}


\slide{Brug af Wireshark}

\hlkimage{13cm}{images/ethereal-capture-options.png}

\centerline{Man starter med Capture - Options}

\slide{Brug af Wireshark}

\hlkimage{24cm}{images/ethereal-main-window.png}

\centerline{Læg mærke til filtermulighederne}


\demo{Wireshark}

\slide{Secure Shell - SSH og SCP}

\begin{center}
\colorbox{white}{\includegraphics[width=12cm]{images/tshirt-9b.jpg}}  
\end{center}
\begin{list1}
\item SSH afløser en række protokoller som er usikre:
  \begin{list2}
  \item Telnet til terminal adgang
  \item r* programmerne, rsh, rcp, rlogin, ...
  \item FTP med brugerid/password
  \end{list2}
\end{list1}


\slide{SSH - de nye kommandoer er}
\begin{list1}
\item kommandoerne er:
\begin{list2}
  \item ssh - Secure Shell
  \item scp - Secure Copy
  \item sftp - secure FTP 
  \end{list2}
\item Husk: SSH er både navnet på protokollerne - version 1 og 2 samt
  programmet \verb+ssh+ til at logge ind på andre systemer
\item SSH tillader også port-forward, tunnel til usikre protokoller,
  eksempelvis X protokollen til UNIX grafiske vinduer
\item {\bfseries NB: Man bør idag bruge SSH protokol version 2!}
\end{list1}


\slide{Putty en SSH til Windows}

\begin{center}
\colorbox{white}{\includegraphics[width=13cm]{images/putty-1.jpg}}  

Login skærmen til Putty terminal programmet
\end{center}

\slide{Putty terminaladgang}

\begin{center}
\colorbox{white}{\includegraphics[width=20cm]{images/putty-screen2.jpg}}  

Billede fra \link{http://edu.muhos.fi/opas/ssh/putty-ohje.htm}
\end{center}

\slide{Grafisk Secure Copy - WinSCP}

\begin{center}
\colorbox{white}{\includegraphics[width=16cm]{images/winscp-login-advanced.png}}  
\end{center}

\begin{center}
\item screenshot fra \link{http://winscp.vse.cz/eng/screenshots/large/advanced.gif}
\end{center}

\slide{Grafisk Secure Copy - WinSCP}

\begin{center}
\colorbox{white}{\includegraphics[width=12cm]{images/winscp-explorer.png}}  
\end{center}

\begin{center}
\item screenshot fra
  \link{http://winscp.vse.cz/eng/screenshots/large/explorer.gif} 
\end{center}


\slide{traceroute}

\begin{list1}
  \item traceroute programmet virker ved hjælp af TTL
\item levetiden for en pakke tælles ned i hver router på vejen og ved at sætte denne lavt
  opnår man at pakken \emph{timer ud} - besked fra hver router på vejen
\item default er UDP pakker, men på UNIX systemer er der ofte mulighed
  for at bruge ICMP
\end{list1}

\begin{alltt}
{\bfseries  traceroute 217.157.20.129}
traceroute to 217.157.20.129 (217.157.20.129)\\
, 30 hops max, 40 byte packets
 1  safri (10.0.0.11)  3.577 ms  0.565 ms  0.323 ms
 2  router (217.157.20.129)  1.481 ms  1.374 ms  1.261 ms
\end{alltt}


\slide{traceroute - med UDP}

\begin{alltt}
\small # {\bfseries tcpdump -i en0 host 217.157.20.129 or host 10.0.0.11}
tcpdump: listening on en0
23:23:30.426342 10.0.0.200.33849 > router.33435: udp 12 [ttl 1]
23:23:30.426742 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.436069 10.0.0.200.33849 > router.33436: udp 12 [ttl 1]
23:23:30.436357 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.437117 10.0.0.200.33849 > router.33437: udp 12 [ttl 1]
23:23:30.437383 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.437574 10.0.0.200.33849 > router.33438: udp 12
23:23:30.438946 router > 10.0.0.200: icmp: router udp port 33438 unreachable
23:23:30.451319 10.0.0.200.33849 > router.33439: udp 12
23:23:30.452569 router > 10.0.0.200: icmp: router udp port 33439 unreachable
23:23:30.452813 10.0.0.200.33849 > router.33440: udp 12
23:23:30.454023 router > 10.0.0.200: icmp: router udp port 33440 unreachable
23:23:31.379102 10.0.0.200.49214 > safri.domain:  6646+ PTR? \\
200.0.0.10.in-addr.arpa. (41)
23:23:31.380410 safri.domain > 10.0.0.200.49214:  6646 NXDomain* 0/1/0 (93)
14 packets received by filter
0 packets dropped by kernel
\end{alltt}

\slide{Værdien af traceroute}

\begin{list1}
\item diagnosticering af netværksproblemer - formålet med traceroute
\item indblik i netværkets opbygning!
\item svar fra hosts - en modtaget pakke fremfor et \emph{sort hul}

\item traceroute er ikke et angreb - det er også vigtigt at kunne
  genkende normal trafik!
\end{list1}

\slide{Network mapping}

\hlkimage{23cm}{images/network-example.pdf}

\begin{list1}
\item Ved brug af traceroute og tilsvarende programmer kan man ofte
  udlede topologien i det netværk man undersøger  
\end{list1}



\slide{Flere traceprogrammer}

\begin{list1}

\item mtr My traceroute - grafisk \link{http://www.bitwizard.nl/mtr/}
\item lft - \emph{layer four trace} benytter TCP SYN og FIN prober
\item trace ved hjælp af TCP og andre protokoller findes
\item paratrace - \emph{Parasitic Traceroute via Established TCP Flows
    and IPID Hopcount} 
\item Der findes webservices hvor man kan trace fra, eksempelvis: \link{http://www.samspade.org}
\end{list1}

\slide{What time is it?}

\hlkimage{8cm}{images/xclock.pdf}

\begin{center}
\hlkbig Hvad er klokken?

\vskip 1 cm
Hvad betydning har det for sikkerheden?

Brug NTP Network Time Protocol på produktionssystemer
\end{center}

\slide{What time is it? - spørg ICMP}

\vskip 1 cm

\begin{list1}
  \item ICMP timestamp option - request/reply
\item hvad er klokken på en server
\item Slayer icmpush - er installeret på server
\item viser tidstempel
\end{list1}

\begin{alltt}
# {\bfseries icmpush -v -tstamp 10.0.0.12}
ICMP Timestamp Request packet sent to 10.0.0.12 (10.0.0.12)

Receiving ICMP replies ...
fischer         -> 21:27:17
icmpush: Program finished OK
\end{alltt}



\demo{ICMPUSH og tracroute}



% session 1-4

\slide{Informationsindsamling}

\begin{list1}
\item Det vi har udført er informationsindsamling
\item Indsamlingen kan være aktiv eller passiv indsamling i forhold
  til målet for angrebet
\item passiv kunne være at lytte med på trafik eller søge i databaser
  på Internet
\item aktiv indsamling er eksempelvis at sende ICMP pakker og
  registrere hvad man får af svar
\end{list1}


\slide{whois systemet}

\begin{list1}
\item IP adresserne administreres i dagligdagen af et antal Internet
  registries, hvor de største er:
\begin{list2}
\item RIPE (Réseaux IP Européens)  \link{http://ripe.net}
\item ARIN American Registry for Internet Numbers \link{http://www.arin.net}
\item Asia Pacific Network Information Center \link{http://www.apnic.net}
\item LACNIC (Regional Latin-American and Caribbean IP Address
  Registry) - Latin America and some Caribbean Islands
  \link{http://www.lacnic.net} 
\item AfriNIC African Internet Numbers Registry \link{http://www.afrinic.net}
\end{list2}
\item disse fem kaldes for Regional Internet Registries (RIRs) i
  modsætning til Local Internet Registries (LIRs) og National Internet
  Registry (NIR) 
\end{list1}

\slide{whois systemet -2}

\begin{list1}
\item ansvaret for Internet IP adresser ligger hos ICANN The Internet
  Corporation for Assigned Names and Numbers
\link{http://www.icann.org}
\item NB: ICANN må ikke forveksles med IANA Internet Assigned Numbers
  Authority\\ \link{http://www.iana.org/} som bestyrer portnumre og
  andre magiske konstanter m.v.
\end{list1}


%\slide{top leveldomæner og DNS}


\slide{DNS systemet}
 
\begin{list1}
\item navneopslag på Internet  
\item tidligere brugte man en {\bfseries hosts} fil\\
  hosts filer bruges stadig lokalt til serveren - IP-adresser
\item UNIX: /etc/hosts
\item Windows \verb+c:\windows\system32\drivers\etc\hosts+
\item Eksempel: www.security6.net har adressen 217.157.20.131
\item skrives i database filer, zone filer
\end{list1}
\begin{alltt}
  ns1     IN      A       217.157.20.130
  IN      AAAA    2001:618:433::1
  www     IN      A       217.157.20.131
  IN      AAAA    2001:618:433::14
\end{alltt}

\slide{Mere end navneopslag}

\begin{list1}
\item består af resource records med en type:
  \begin{list2}
  \item adresser A-records
  \item IPv6 adresser AAAA-records
  \item autoritative navneservere NS-records
  \item post, mail-exchanger MX-records
  \item flere andre: md ,  mf ,  cname ,  soa ,
    mb , mg ,  mr ,  null ,  wks ,  ptr ,
    hinfo ,  minfo ,  mx ....
  \end{list2}
\end{list1}
\begin{alltt}
  IN      MX      10      mail.security6.net.
  IN      MX      20      mail2.security6.net.
\end{alltt}


\slide{Små DNS tools bind-version - Shell script}

\begin{alltt}\small
#! /bin/sh
# Try to get version info from BIND server
PROGRAM=`basename $0`
. `dirname $0`/functions.sh
if [ $# -ne 1 ]; then
   echo "get name server version, need a target! "
   echo "Usage: $0 target"
   echo "example $0 10.1.2.3"
   exit 0
fi
TARGET=$1
# using dig 
start_time
dig @$1 version.bind chaos txt
echo Authors BIND er i versionerne 9.1 og 9.2 - måske ...
dig @$1 authors.bind chaos txt
stop_time
\end{alltt}
\centerline{\link{http://www.kramse.dk/files/tools/dns/bind-version}}

\slide{Små DNS tools dns-timecheck - Perl script}

\begin{alltt}\small
#!/usr/bin/perl
# modified from original by Henrik Kramshøj, hlk@kramse.dk
# 2004-08-19
#
# Original from: http://www.rfc.se/fpdns/timecheck.html
use Net::DNS;

my $resolver = Net::DNS::Resolver->new;
$resolver->nameservers($ARGV[0]);

my $query = Net::DNS::Packet->new;
$query->sign_tsig("n","test");

my $response = $resolver->send($query);
foreach my $rr ($response->additional) {
  print "localtime vs nameserver $ARGV[0] time difference: ";
  print$rr->time_signed - time() if $rr->type eq "TSIG";
}  
\end{alltt}
% inserting stupid $ to stop EMACS from
\centerline{\link{http://www.kramse.dk/files/tools/dns/dns-timecheck}}

\slide{Google for it}

\hlkimage{18cm}{images/googledorks-1.pdf}

\begin{list1}
\item Google som hacker værktøj?
\item Googledorks
\link{http://johnny.ihackstuff.com/}
\end{list1}



\slide{Hvordan virker ARP?}

\begin{center}
\colorbox{white}{\includegraphics[width=18cm]{images/arp-basic.pdf}}  
\end{center}

%server 00:30:65:22:94:a1\\
%client 00:40:70:12:95:1c\\
%hacker 00:02:03:04:05:06\\

\slide{Hvordan virker ARP? - 2}
\begin{list1}
\item {\bfseries ping 10.0.0.2} udført på server medfører
\item ARP Address Resolution Protocol request/reply:
  \begin{list2}
  \item ARP request i broadcast - Who has 10.0.0.2 Tell 10.0.0.1
  \item ARP reply (fra 10.0.0.2) 10.0.0.2 is at 00:40:70:12:95:1c
  \end{list2}
\item IP ICMP request/reply:
  \begin{list2}
    \item Echo (ping) request fra 10.0.0.1 til 10.0.0.2
\item Echo (ping) reply fra 10.0.0.2 til 10.0.0.1
\item ...
  \end{list2}
\item ARP udføres altid på Ethernet før der kan sendes IP trafik
\item (kan være RARP til udstyr der henter en adresse ved boot)
\end{list1}


\slide{Hvordan virker ARP spoofing?}

\begin{center}
\colorbox{white}{\includegraphics[width=15cm]{images/arp-spoof.pdf}}  
\end{center}

\begin{list1}
\item Hackeren sender forfalskede ARP pakker til de to parter
\item De sender derefter pakkerne ud på Ethernet med hackerens MAC
  adresse som modtager - han får alle pakkerne
\end{list1}



\slide{dsniff}

\begin{list1}
\item en sniffer til mange usikre protokoller
\item inkluderer {\bfseries arpspoof}  
\item Lavet af Dug Song, dugsong@monkey.org
\end{list1}

\begin{alltt}
dsniff  is  a  password sniffer which handles FTP, Telnet,
SMTP, HTTP, POP, poppass, NNTP, IMAP, SNMP, LDAP,  Rlogin,
RIP,  OSPF,  PPTP  MS-CHAP, NFS, VRRP, YP/NIS, SOCKS, X11,
CVS, IRC, AIM, ICQ, Napster,  PostgreSQL,  Meeting  Maker,
Citrix  ICA,  Symantec  pcAnywhere, NAI Sniffer, Microsoft
SMB, Oracle SQL*Net, Sybase and Microsoft SQL protocols.
\end{alltt}

\slide{dsniff forudsætninger}

\begin{list1}
\item Der er visse forudsætninger der skal være opfyldt
  \begin{list2}
\item Man skal have trafikken
\item Det kan gøres gennem arp spoofing eller ved at hacke ind i et
  system/router på netværksvejen
\end{list2}
\end{list1}

\begin{center}
  \colorbox{white}{\includegraphics[width=12cm]{images/arp-spoof.pdf}}  
\end{center}

\slide{Forsvar mod ARP spoofing}

\begin{list1}
\item Hvad kan man gøre? 
\item låse MAC adresser til porte på switche
\item låse MAC adresser til bestemte IP adresser
\item Efterfølgende administration!
\vskip 1 cm
\item {\bfseries arpwatch er et godt bud} - overvåger ARP
\item bruge protokoller som ikke er sårbare overfor opsamling
\end{list1}


\slide{Kommenteret dsniff}

\hlkimage{22cm}{images/dsniff-comments.pdf}


\slide{netværksdesign og sikkerhed}

\hlkimage{12cm}{images/kursus-netvaerk.pdf}

\begin{list1}
  \item Hvad kan man gøre for at få bedre netværkssikkerhed?
    \begin{list2}
    \item bruge switche - der skal ARP spoofes og bedre performance
    \item opdele med firewall til flere DMZ zoner for at holde
      udsatte servere adskilt fra hinanden, det interne netværk og
      Internet
    \item overvåge, læse logs og reagere på hændelser 
    \end{list2}
\end{list1}


\slide{Intrusion Detection Systems - IDS}

\begin{list1}
  \item angrebsværktøjerne efterlader spor

\item hostbased IDS - kører lokalt på et system og forsøger at
  detektere om der er en angriber inde
\item network based IDS - NIDS - bruger netværket
\item Automatiserer netværksovervågning:
  \begin{list2}
  \item bestemte pakker kan opfattes som en signatur
\item analyse af netværkstrafik - FØR angreb
\item analyse af netværk under angreb - sender en alarm
  \end{list2}
\item \link{http://www.snort.org} - det kan anbefales at se på Snort
\end{list1}

\slide{Ulemper ved IDS}

\hlkimage{5cm}{images/snort_tm.png}

\begin{list1}
\item snort er baseret på signaturer
\item mange falske alarmer - tuning og vedligehold
\item hvordan sikrer man sig at man har opdaterede signaturer for
  angreb som går verden rundt på et døgn 
\end{list1}


% session 1-6
% basal portscanning og intro til cd-rom
\slide{Basal Portscanning}

\begin{list1}
  \item Hvad er portscanning
\item afprøvning af alle porte fra 0/1 og op til 65535
\item målet er at identificere åbne porte - sårbare services
\item typisk TCP og UDP scanning
\item TCP scanning er ofte mere pålidelig end UDP scanning
\end{list1}

{\hlkbig TCP handshake er nemmere at identificere

UDP applikationer svarer forskelligt - hvis overhovedet}

\slide{TCP three way handshake}

\hlkimage{7cm}{images/tcp-three-way.pdf}

\begin{list2}
\item {\bfseries TCP SYN half-open} scans
\item Tidligere loggede systemer kun når der var etableret en fuld TCP
  forbindelse - dette kan/kunne udnyttes til \emph{stealth}-scans
\item Hvis en maskine modtager mange SYN pakker kan dette fylde
  tabellen over connections op - og derved afholde nye forbindelser
  fra at blive oprette - {\bfseries SYN-flooding}
\end{list2}


\slide{Ping og port sweep}

\begin{list1}
\item scanninger på tværs af netværk kaldes for sweeps 
\item Scan et netværk efter aktive systemer med PING
\item Scan et netværk efter systemer med en bestemt port åben
\item Er som regel nemt at opdage:
  \begin{list2}
    \item konfigurer en maskine med to IP-adresser som ikke er i brug
\item hvis der kommer trafik til den ene eller anden er det portscan
\item hvis der kommer trafik til begge IP-adresser er der nok
  foretaget et sweep - bedre hvis de to adresser ligger et stykke fra hinanden
  \end{list2}

\end{list1}

\slide{nmap port sweep efter port 80/TCP}

\begin{list1}
  \item Port 80 TCP er webservere
\end{list1}

\begin{alltt}
\small # {\bfseries nmap  -p 80 217.157.20.130/28}

Starting nmap V. 3.00 ( www.insecure.org/nmap/ )
Interesting ports on router.kramse.dk (217.157.20.129):
Port       State       Service
80/tcp     filtered    http                    

Interesting ports on www.kramse.dk (217.157.20.131):
Port       State       Service
80/tcp     open        http                    

Interesting ports on  (217.157.20.139):
Port       State       Service
80/tcp     open        http                    

\end{alltt}

\slide{nmap port sweep efter port 161/UDP}

\begin{list1}
  \item Port 161 UDP er SNMP
\end{list1}

\begin{alltt}  
\small # {\bfseries nmap -sU -p 161 217.157.20.130/28}

Starting nmap V. 3.00 ( www.insecure.org/nmap/ )
Interesting ports on router.kramse.dk (217.157.20.129):
Port       State       Service
161/udp    open        snmp                    

The 1 scanned port on mail.kramse.dk (217.157.20.130) is: closed

Interesting ports on www.kramse.dk (217.157.20.131):
Port       State       Service
161/udp    open        snmp                    

The 1 scanned port on  (217.157.20.132) is: closed
\end{alltt}

\slide{OS detection}
\begin{alltt}
\footnotesize
# nmap -O ip.adresse.slet.tet \emph{scan af en gateway}
Starting nmap 3.48 ( http://www.insecure.org/nmap/ ) at 2003-12-03 11:31 CET
Interesting ports on gw-int.security6.net (ip.adresse.slet.tet):
(The 1653 ports scanned but not shown below are in state: closed)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
1080/tcp open  socks
5000/tcp open  UPnP
Device type: general purpose
Running: FreeBSD 4.X
OS details: FreeBSD 4.8-STABLE
Uptime 21.178 days (since Wed Nov 12 07:14:49 2003)
Nmap run completed -- 1 IP address (1 host up) scanned in 7.540 seconds
\end{alltt}

\begin{list2}
  \item lavniveau måde at identificere operativsystemer på
\item send pakker med \emph{anderledes} indhold
\item Reference: \emph{ICMP Usage In Scanning} Version 3.0,
  Ofir Arkin\\ \link{http://www.sys-security.com/html/projects/icmp.html}
\end{list2}

\demo{Portscans med Nmap Frontend program}

% afslutning dag 1
\slide{Erfaringer hidtil}

\begin{list1}
  \item mange oplysninger
\item kan man stykke oplysningerne sammen kan man sige en hel del om
  netværket 
\item en skabelon til registrering af maskiner er god
  \begin{list2}
    \item svarer på ICMP: $\Box$\  echo, $\Box$\ mask, $\Box$\ time
\item svarer på traceroute: $\Box$\ ICMP, $\Box$\ UDP
\item Åbne porte TCP og UDP: 
\item Operativsystem:
\item ... (banner information m.v.)
  \end{list2}
\item Mange små pakker kan oversvømme store forbindelser og
  give problemer for netværk
\end{list1}



\slide{Simple Network Management Protocol}

\begin{list1}
\item SNMP er en protokol der supporteres af de fleste professionelle
  netværksenheder, såsom switche, routere
\item hosts - skal slås til men følger som regel med
\item SNMP bruges til: 
  \begin{list2}
    \item \emph{network management}
    \item statistik
    \item rapportering af fejl - SNMP traps
  \end{list2}
\item {\bfseries sikkerheden baseres på community strings der sendes
    som klartekst ...}
\item det er nemmere at brute-force en community string end en
  brugerid/kodeord kombination
\end{list1}

\slide{brute force}

\begin{list1}
\item hvad betyder bruteforcing?\\
afprøvning af alle mulighederne
\end{list1}

\begin{alltt}
\small
Hydra v2.5 (c) 2003 by van Hauser / THC <vh@thc.org>
Syntax: hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]] 
[-o FILE] [-t TASKS] [-g TASKS] [-T SERVERS] [-M FILE] [-w TIME] 
[-f] [-e ns] [-s PORT] [-S] [-vV] server service [OPT]

Options:
  -S        connect via SSL
  -s PORT   if the service is on a different default port, define it here
  -l LOGIN  or -L FILE login with LOGIN name, or load several logins from FILE
  -p PASS   or -P FILE try password PASS, or load several passwords from FILE
  -e ns     additional checks, "n" for null password, "s" try login as pass
  -C FILE   colon seperated "login:pass" format, instead of -L/-P option
  -M FILE   file containing server list (parallizes attacks, see -T)
  -o FILE   write found login/password pairs to FILE instead of stdout
...  
\end{alltt}

\demo{snmpwalk og Hydra}


\slide{NT hashes}

\begin{list1}
  \item NT LAN manager hash værdier er noget man typisk kan samle op i
  netværk 
\item det er en hash værdi af et password som man ikke burde kunne
  bruge til noget - hash algoritmer er envejs
\item opbygningen gør at man kan forsøge brute-force på 7 tegn ad
  gangen!
\item en moderne pc med l0phtcrack kan nemt knække de fleste password
  på få dage!
\item og sikkert 25-30\% indenfor den første dag - hvis der ingen
  politik er omkring kodeord! 
\item ved at generere store tabeller, eksempelvis 100GB kan man dække
  mange hashværdier af passwords med almindelige bogstaver, tal og
  tegn - og derved knække passwordshashes på sekunder. Søg efter
  rainbowcrack med google
\end{list1}

\slide{l0phtcrack LC4}
\begin{center}
\colorbox{white}{\includegraphics[width=10cm]{images/lc4_splash.png}}  
\end{center}

\begin{alltt}
\small
Consider that at one of the largest technology companies, where policy
required that passwords exceed 8 characters, mix cases, and include
numbers or symbols...   
        
L0phtCrack obtained 18\% of the passwords in 10 minutes         
90\% of the passwords were recovered within 48 hours on a Pentium II/300           
The Administrator and most Domain Admin passwords were cracked 
\link{http://www.atstake.com/research/lc/}
\end{alltt}

\slide{Cain og Abel}

%\hlkimage{10cm}{cain_brute_attack.jpg}
\hlkimage{20cm}{cain_win.jpg}

\begin{list1}
\item  Cain og Abel anbefales ofte istedet for l0phtcrack
  \link{http://www.oxid.it}
\end{list1}

\slide{John the ripper}

\begin{quote}
John the Ripper is a fast password cracker, currently available for
many flavors of Unix (11 are officially supported, not counting
different architectures), Windows, DOS, BeOS, and OpenVMS. Its primary
purpose is to detect weak Unix passwords. Besides several crypt(3)
password hash types most commonly found on various Unix flavors,
supported out of the box are Kerberos AFS and Windows NT/2000/XP/2003
LM hashes, plus several more with contributed patches.   
\end{quote}

\begin{list1}
\item UNIX passwords kan knækkes med alec Muffets kendte Crack program
  eller eksempelvis John The Ripper \link{http://www.openwall.com/john/}  
\item Jeg bruger selv John The Ripper
\end{list1}

\demo{Cain og Abel}

\slide{kryptering, PGP og SSL/TLS}

\begin{list1}
  \item kryptering er den eneste måde at sikre:
    \begin{list2}
      \item fortrolighed
      \item autenticitet
    \end{list2}
\item kryptering består af:
  \begin{list2}
    \item Algoritmer - eksempelvis RSA
    \item \emph{protokoller} - måden de bruges på
\item programmer - eksempelvis PGP
\end{list2}
\item fejl eller sårbarheder i en af komponenterne kan formindske
  sikkerheden  
\item PGP = mail sikkerhed, se eksempelvis Enigmail plugin til Mozilla Thunderbird
\item Secure Sockets Layer SSL / Transport Layer Services TLS =
  webservere og klienter
\end{list1}


\slide{DES, Triple DES og AES/Rijndael}

%\hlkimage{15cm}{images/AES_head.png}

\begin{list1}
\item DES kryptering baseret på den IBM udviklede Lucifer algoritme
  har været benyttet gennem mange år. 
\item Der er vedtaget en ny standard algoritme Advanced Encryption
  Standard (AES) som afløser Data Encryption Standard (DES)
\item Algoritmen hedder Rijndael og er udviklet
af Joan Daemen og Vincent Rijmen.
%\item \emph{Rijndael is available for free. You can use it for
%whatever purposes  you want, irrespective of whether
%it is accepted as AES or not.}
\item Kilder:
\link{http://csrc.nist.gov/encryption/aes/} - AES Homepage\\
\link{http://www.esat.kuleuven.ac.be/~rijmen/rijndael/} - The Rijndael Page
\end{list1}


\slide{Windows RPC CVE-2003-0352} 

\begin{list1}
\item Hackergruppe "Last Stage of Delirium" finder sårbarhed i RPC
\item Den 27. juni 2003skrev LSD til Microsoft om fejlen
\begin{list2}
  

\item Microsoft har frigivet rettelser i juli 2003. 
\item LSD har ry for at arbejde seriøst sammen med
produkt-leverandørerne. De kommunikerer sårbarheder til
leverandørerne og frigiver ikke "exploit-programmer" før
leverandørerne har fået en fair chance til at løse deres
problemer. 

\item Beskrivelse af sårbarheden kan findes hos Microsoft på:\\
\link{http://microsoft.com/technet/treeview/default.asp?url=/technet/security/bulletin/MS03-026.asp}
\end{list2}
\item Kilder:\\
%\link{http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-0352}\\
\link{http://www.securityfocus.com/news/6519}\\
\link{http://www.cert.org/advisories/CA-2003-16.html}\\
\link{http://lsd-pl.net/} -  detaljerede beskrivelser af exploits
\end{list1}


\demo{Exploit dcom.c }

\hlkimage{16cm}{images/server-client.pdf}

\begin{list2}
\item To almindelige computere - en switch erstatter Internet
\item Windows er installeret på et system og ikke opdateret
\item dcom.c exploit er hentet fra Internet og bruges næsten uændret
\item Husk at selom dcom er gammel er der mange tilsvarende idag! 
\end{list2}


\slide{Hvad sker der?}

\begin{alltt}
[hlk@fiona hlk]$ ./dcom 1 10.0.0.206
---------------------------------------------------------
- Remote DCOM RPC Buffer Overflow Exploit
- Original code by FlashSky and Benjurry
- Rewritten by HDM <hdm [at] metasploit.com>
- Using return address of 0x77e626ba
- Dropping to System Shell...

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

\verb+C:\WINDOWS\system32>exit+   {\bf - find selv på kommandoer, fri adgang!!}

 - Read failure
[hlk@fiona hlk]$ 
\end{alltt}


\slide{Sårbarheder - CVE og ICAT}

\begin{list1}
\item Common Vulnerabilities and Exposures (CVE) er:
  \begin{list2}
  \item klassifikation
  \item unik navngivning af sårbarheder. 
  \end{list2}
\item Sårbarheder tildeles
  \begin{list2}
  \item initielt oprettes med status CANDIDATE
  \end{list2}
\item CVE vedligeholdes af MITRE - som er en not-for-profit 
organisation skabt til forskning og udvikling i USA.
National Vulnerability Database er en af mulighederne for at søge i CVE. 
%\item CVE er et kvantespring indenfor sikkerhed - og en stor succes!
\item Kilde: \link{http://cve.mitre.org/} og \link{http://nvd.nist.gov}
\end{list1}

\slide{ICAT klassifikation af sårbarheder}

\begin{list1}
\item ICAT is a fine-grained searchable index of standardized
  vulnerabilities that links users into publicly available
  vulnerability and patch information 
\item ICAT klassificerer efter:
  \begin{list2}
  \item Input validation error, Boundary overflow og Buffer overflow
  \item Access validation error
  \item Exceptional condition handling error
  \item Environmental error
  \item Configuration error
  \item Race condition
  \item Design error
  \item Other
  \end{list2}
\item Kilde:
  \link{http://icat.nist.gov/icat.cfm}
\end{list1}


\slide{Altid aktuelt - DNS og web}

\begin{list1}
\item Navneservere er tit under angreb, hvorfor?!
  \begin{list2}
  \item Står på netværk med god forbindelse
  \item Har kendte adresser
  \item Kører oftest ISC BIND
  \item BIND har mange funktioner - mange fejl
  \item Den der kontrollerer navneservere kan omdirigere trafik
  \end{list2}
\item webservere er altid under angreb
  \begin{list2}
\item Webserveren er virksomhedens ansigt ud mod Internet eller måske
  selve indtjeningen - for e-handel
    \item Microsoft Internet Information Services - IIS - kendt og
    berygtet for at indeholder megen funktionalitet - farlig
    funktionalitet
\item Apache har haft nogle grimme oplevelser for nyligt, og PHP er en
  kilde til mange sikkerhedsproblemer - hvem sagde PHP Nuke?!
  \end{list2}
\end{list1}


\slide{Windows NT familien}

\begin{list1}
\item Windows NT, Windows 2000 - server og workstation versioner
\item Læg mærke til de applikationer i lægger ovenpå - åbner porte!
\begin{list2}
\item Internet Information Services IIS
\item databaser
\item diverse klienter - TSM klient!
\end{list2}
\item Opsætning af Microsoft Internet Information Services IIS\\
brug Microsoft's egne guider og andre checklister
\item Eksempelvis Gold Standard\\
{\small \emph{Windows 2000 Professional Gold Standard Security Benchmarks
are available for download at: \\
Center for Internet Security \link{www.cisecurity.org} \\
The National Security Agency \link{www.nsa.gov}}} 
\end{list1}


\slide{konfigurationsfejl - ofte overset}

\begin{list1}
\item Forkert brug af programmer er ofte overset
\begin{list2}
\item opfyldes forudsætningerne
\item er programmet egnet til dette miljø
\item er man udannet/erfaren i dette produkt
\end{list2}
\item Kunne I finde på at kopiere cmd.exe til
/scripts kataloget på en IIS?
\item Det har jeg engang været ude for at en kunde havde gjort!
\item hvis I under test af en server opdager at denne har
  /scripts/cmd1.exe eller "FTP-scripts" til at hente værktøjer ...
så er den pågældende server formentlig kompromitteret 
\end{list1}

\slide{Insecure programming}

\vskip 2 cm

\begin{list1}
\item Problem:\\
Ønsker et simpelt CGI program, en web udgave af finger
\item Formål:\\
Vise oplysningerne om brugere på systemet
\end{list1}

\slide{review af nogle muligheder}

\begin{list1}
\item ASP
\begin{list2}
\item server scripting, meget generelt - man kan alt
\end{list2}

\item SQL
\begin{list2}
\item databasesprog - meget kraftfuldt
\item mange databasesystemer giver mulighed for specifik tildeling af
  privilegier "grant" 
  \end{list2}
\item JAVA
\begin{list2}
\item generelt programmeringssprog
\item bytecode verifikation
\item indbygget sandbox funktionalitet 
\end{list2}
\item Perl og andre generelle programmeringssprog
\item Pas på shell escapes!!!
\end{list1}

\slide{Hello world of insecure web CGI}

\begin{list1}
\item Demo af et sårbart system - badfinger
\item Løsning:
\begin{list2}
\item Kalde finger kommandoen
\item et Perl script
\item afvikles som CGI 
\item standard Apache HTTPD 1.3 server
\end{list2}
\end{list1}

\slide{De vitale - og usikre dele}

{\small
\begin{verbatim}
print "Content-type: text/html\n\n<html>";
print "<body bgcolor=#666666 leftmargin=20 topmargin=20"; 
print "marginwidth=20 marginheight=20>";
print <<XX;
<h1>Bad finger command!</h1>
<HR COLOR=#000>
<form method="post" action="bad_finger.cgi">
Enter userid: <input type="text" size="40" name="command">
</form>
<HR COLOR=#000>
XX
if(&ReadForm(*input)){
    print "<pre>\n";
    print "will execute:\n/usr/bin/finger $input{'command'}\n";
    print "<HR COLOR=#000>\n";
    print `/usr/bin/finger $input{'command'}`;
    print "<pre>\n";
}
\end{verbatim}}

\slide{Almindelige problemer}

\begin{list1}
\item validering af forms
\item validering på klient er godt\\
- godt for brugervenligheden, hurtigt feedback
\item validering på clientside gør intet for sikkerheden
\item serverside validering er nødvendigt
\item generelt er input validering det største problem!
\end{list1}

Brug \emph{Open Web Application Security
Project} \link{http://www.owasp.org}

\slide{SQL injection}

\begin{list1}
\item SQL Injection FAQ 
\link{http://www.sqlsecurity.com}:
\begin{alltt}
\small  
Set myRecordset = myConnection.execute
("SELECT * FROM myTable
WHERE someText ='" & request.form("inputdata") & "'")  
med input: ' exec master..xp_cmdshell 'net user test testpass /ADD' --
modtager og udfører serveren:
SELECT * FROM myTable 
WHERE someText ='' exec master..xp_cmdshell
'net user test testpass /ADD'--' 
\end{alltt}
\item -- er kommentar i SQL
\end{list1}

\slide{Er SQL injection almindeligt?}


\begin{list1}
\item Ja, meget almindeligt!
\item Prøv at søge med google  
\end{list1}

\hlkimage{5cm}{images/database-hackers-handbook.jpg}

\begin{list1}
\item \emph{The Database Hacker's Handbook : Defending Database Servers
} David  Litchfield, Chris  Anley, John  Heasman, Bill  Grindlay,
Wiley 2005 ISBN: 0764578014
\end{list1}






\slide{Mere SQL injection / SQL server}

\begin{list1}
\item Threat Profiling Microsoft SQL Server\\
\link{http://www.nextgenss.com/papers/tp-SQL2000.pdf}
\begin{list2}
\item Hvordan sikrer man en SQL server?
\item mod fejl
\item mod netværksadgang
\item mod SQL injection
\end{list2}
\item NB: Hold øje med andre artikler fra samme sted\\
\link{http://www.nextgenss.com/research/papers.html}
\item Advanced SQL Injection In SQL Server Applications\\
\href{http://www.nextgenss.com/papers/advanced_sql_injection.pdf}
{http://www.nextgenss.com/papers/advanced\_sql\_injection.pdf}\\
(more) Advanced SQL Injection\\
\href{http://www.nextgenss.com/papers/more_advanced_sql_injection.pdf}
{http://www.nextgenss.com/papers/more\_advanced\_sql\_injection.pdf}\\
begge af Chris Anley [chris@ngssoftware.com]
\end{list1}

\slide{Mere Web application hacking}

\hlkimage{5cm}{images/web-app-hackers-handbook.jpeg}

\begin{list1}
\item \emph{The Web Application Hacker's Handbook: Discovering and Exploiting Security Flaws}
Dafydd Stuttard, Marcus Pinto, Wiley 2007 ISBN: 978-0470170779
\end{list1}

\slide{Hvordan udnyttes forms nemmest?}

\begin{list1}
\item Manuelt download form:
\begin{alltt}
<FORM ACTION="opret.asp?mode=bruger?id=doopret"
METHOD="POST" NAME="opret"
ONSUBMIT="return validate(this)">
\end{alltt}
\item fjern kald til validering:
\begin{alltt}
<FORM ACTION="opret.asp?mode=bruger?id=doopret"
METHOD="POST" NAME="opret">
\end{alltt}
\item Tilføj 'BASE HREF' i header, findes med browser - højreklik
  properties i Internet Explorer

\end{list1}    


\slide{Hvordan udnyttes forms nemmest?}

\begin{list1}
\item Den form som man bruger er så - fra sin lokale harddisk:
\begin{alltt}
<HEAD>
<TITLE>Our Products</TITLE>
<BASE href="http://www.target.server/sti/til/form">
</HEAD>
...
<FORM ACTION="opret.asp?mode=bruger?id=doopret"
METHOD="POST" NAME="opret">
\end{alltt}
\item Kald form i en browser og indtast værdier
\end{list1}    

\slide{WebScarab eller Firefox plugins} 

\begin{list1}
\item Man bliver hurtigt træt af at ændre forms på den måde
\item Istedet anvendes en masse proxyprogrammer
\item Nogle af de mest kendte er:
\begin{list2}
\item Burp proxy
\item Parox proxy
\item Firefox extension tamper data
\item OWASP WebScarab
\end{list2}
\item Jeg anbefaler de sidste to
\end{list1}


\slide{Historik indenfor websikkerhed}

\begin{list1}
\item IIS track record
\begin{list2}
\item meget funktionalitet
\item større risiko for fejl
\item alvorlige fejl - arbitrary code execution
\end{list2}
\item Apache track record
\begin{list2}
\item typisk mindre funktionalitet
\item typisk haft mindre alvorlige fejl
\end{list2}
\item PHP track record?
\item Sammenligning IIS med Apache+PHP, idet en direkte sammenligning mellem
IIS og Apache vil være unfair 
\item {\bfseries Meget få har idag små websteder med statisk indhold}
\item Både IIS version 6 og Apache version 2 anbefales idag, fremfor tidligere versioner
\end{list1}


\slide{Opsummering websikkerhed}

\begin{list1}
\item Husk hidden fields er ikke mere skjulte end
"view source"-knappen i browseren
\item serverside validering er nødvendigt
\item SQL injection er nemt at udføre og almindeligt
\item Cross-site scripting kan have uanede muligheder
\item Brug listen fra \link{http://www.owasp.org}
\end{list1}

\slide{Privilegier least privilege}

\begin{list1}
\item Hvorfor afvikle applikationer med administrationsrettigheder -
  hvis der kun skal læses fra eksempelvis en database?
\item {\bfseries least privilege} 
betyder at man afvikler kode med det mest
restriktive sæt af privileger - kun lige nok til at
opgaven kan udføres
\item Dette praktiseres ikke i webløsninger i Danmark - eller meget få steder
\end{list1}

\slide{Privilegier privilege escalation}
\begin{list1}
\item {\bfseries privilege escalation} er når man på en eller anden vis
opnår højere privileger på et system, eksempelvis som
følge af fejl i programmer der afvikles med højere
privilegier. Derfor HTTPD servere på UNIX afvikles som
nobody - ingen specielle rettigheder.
\item En angriber der kan afvikle vilkårlige kommandoer kan ofte finde
  en sårbarhed som kan udnyttes lokalt - få rettigheder = lille skade
\end{list1}


\slide{Hærdning af Microsoft IIS}

\begin{list1}
\item Internet Information Services kan hærdes ...
\item det kræver blot at man følger den guide som Microsoft har lavet
\item - og at man jævnligt følger med i opdateringer til denne guide
\item det anbefales at bruge de tilgængelige værktøjer som
  eksempelvis urlscan
\vskip 2 cm
\item IIS version 6 er mere sikker i default
  opsætningen - næsten alt er slået fra
\end{list1}

\slide{Undgå standard indstillinger}

\begin{list1}
\item når vi scanner efter services går det nemt med at finde dem
\item Giv jer selv mere tid til at omkonfigurere og opdatere ved at undgå standardindstillinger
\item Tiden der går fra en sårbarhed annonceres på bugtraq til den
  bliver udnyttet er meget kort idag! 
\item Ved at undgå standard indstillinger kan der
  måske opnås en lidt længere frist - inden ormene kommer
\item NB: ingen garanti - og det hjælper sjældent mod en dedikeret angriber
\end{list1}


\slide{buffer overflows et C problem}

\begin{list1}
\item {\bfseries Et buffer overflow}
er det der sker når man skriver flere data end der er afsat plads til
i en buffer, et dataområde. Typisk vil programmet gå ned, men i visse
tilfælde kan en angriber overskrive returadresser for funktionskald og
overtage kontrollen. 
\item {\bfseries Stack protection} 
er et udtryk for de systemer der ved hjælp af operativsystemer,
programbiblioteker og lign. beskytter stakken med returadresser og
andre variable mod overskrivning gennem buffer overflows. StackGuard
og Propolice er nogle af de mest kendte.
\end{list1}

\slide{Exploits - udnyttelse af sårbarheder}

\begin{list1}
\item exploit/exploitprogram er
\begin{list2}
\item udnytter eller demonstrerer en sårbarhed
\item rettet mod et specifikt system.
\item kan være 5 linier eller flere sider
\item Meget ofte Perl eller et C program 
\end{list2}
\end{list1}

Eksempel:
\begin{verbatim}
 #! /usr/bin/perl
 # ./chars.pl | nc server 31337
 print "abcdefghijkl";
 print chr(237);
 print chr(13);
 print chr(220);
 print chr(186);
 print "\n";
\end{verbatim}

\slide{local vs. remote exploits}

\begin{list1} 
\item {\bfseries local vs. remote}
angiver om et exploit er rettet mod
en sårbarhed lokalt på maskinen, eksempelvis
opnå højere privilegier, eller beregnet
til at udnytter sårbarheder over netværk
\item {\bfseries remote root exploit} 
- den type man frygter mest, idet
det er et exploit program der når det afvikles giver
angriberen fuld kontrol, root user er administrator
på UNIX, over netværket. 
\item {\bfseries zero-day exploits} dem som ikke offentliggøres - dem
  som hackere holder for sig selv. Dag 0 henviser til at ingen kender
  til dem før de offentliggøres og ofte er der umiddelbart ingen
  rettelser til de sårbarheder
\end{list1}

\slide{Hvordan laves et buffer overflow?}

\begin{list1}
\item Findes ved at prøve sig frem
\begin{list2}
\item black box testing
\item closed source
\item reverse engineering
\end{list2}
\item Ved Open source Findes de typisk ved at læse/analysere koden 
\begin{list2}
\item RATS
\item flere andre 
\end{list2}
\item Virker typisk mod specifikke versioner
\begin{list2}
\item Windows IIS 4.0 med service pack XX
\item Red Hat Linux 7.3 default
\end{list2}
\end{list1}

\slide{Buffer overflows}

\hlkimage{3cm}{images/shellcoders-handbook.jpg}

\begin{list1}
\item Hvis man vil lære at lave buffer overflows og exploit programmer
  er følgende dokumenter et godt sted at starte
\item \emph{Smashing The Stack For Fun And Profit} Aleph One
\item \emph{Writing Buffer Overflow Exploits with Perl - anno 2000}
\item Dernæst kan man bevæge sig mod Windows epxloits, integer
  overflows m.fl.
\item Følgende bog kan ligeledes anbefales:
\emph{The Shellcoder's Handbook : Discovering and Exploiting Security Holes} 
af Jack Koziol, David Litchfield, Dave Aitel, Chris Anley, Sinan
"noir" Eren, Neel Mehta, Riley Hassell, John Wiley \& Sons, 2004 
\item NB: bogen er avanceret og således IKKE for begyndere! 
\end{list1}



\slide{Stack protection}

\begin{list1}
\item Stack protection er mere almindeligt\\
- med i OpenBSD current fra 2. dec 2002

\item Buffer overflows er almindeligt kendte
\begin{list2}    
\item Selv OpenSSH har haft buffer overflows
\item Stack protection prøver at modvirke/fjerne
  muligheden for buffer overflows. arbitrary code execution
  bliver til ude af drift for berørte services
\end{list2}

\item Propolice\\
\link{http://www.openbsd.org}\\
\link{http://www.trl.ibm.com/projects/security/ssp/}

\item StackGuard\\
\link{http://www.immunix.org/stackguard.html}
\end{list1}





% session 3-4 automatiseret sårbarhedsscanning

\slide{Hackerværktøjer}

\begin{list1}
\item Dan Farmer og Wietse Venema skrev i 1993 artiklen\\
\emph{Improving the Security of Your Site by Breaking Into it}
\item Senere i 1995 udgav de så en softwarepakke med navnet SATAN
\emph{Security Administrator Tool for Analyzing Networks}
 Pakken vagte
 en del furore, idet man jo gav alle på internet mulighed for at hacke
\begin{quote}
We realize that SATAN is a two-edged sword - like
many tools, it can be used for good and for evil
purposes. We also realize that intruders (including
wannabees) have much more capable (read intrusive)
tools than offered with SATAN. 
\end{quote}
\item SATAN og ideerne med automatiseret scanning efter sårbarheder
  blev siden ført videre i programmer som Saint, SARA og idag findes
  mange hackerværktøjer og automatiserede scannere: 
\begin{list2}
\item Nessus, ISS scanner, Fyodor Nmap, Typhoon, ORAscan
\end{list2}
\end{list1}
Kilde:
\link{http://www.fish.com/security/admin-guide-to-cracking.html}



\slide{Brug hackerværktøjer!}

\begin{list1}
\item Hackerværktøjer - bruger I dem? - efter dette kursus gør I 
\item portscannere kan afsløre huller i forsvaret
\item webtestværktøjer som crawler igennem et website og finder alle
  forms kan hjælpe
\item I vil kunne finde mange potentielle problemer proaktivt ved
  regelmæssig brug af disse værktøjer - også potentielle driftsproblemer
\item husk dog penetrationstest er ikke en sølvkugle
\item honeypots kan måske være med til at afsløre angreb og
  kompromitterede systemer hurtigere
\end{list1}

\slide{Metasploit}
\hlkimage{20cm}{metasploit-about.png}

\begin{list1}
\item Metasploit er modulært og nemt at bruge
\item Det er skræmmende enkelt at udvikle og udføre exploits
\item \link{http://www.metasploit.com/}
\end{list1}


\demo{Metasploit med dcom}


% wireless

\input{wireless-80211}

\slide{firewalls}

\begin{itemize}
\item Basalt set et netværksfilter - det yderste fæstningsværk
\item Indeholder typisk:
  \begin{list2}
   \item Grafisk brugergrænseflade til konfiguration - er det en
   fordel?
\item TCP/IP filtermuligheder - pakkernes afsender, modtager, retning
  ind/ud, porte, protokol, ...
\item kun IPv4 for de kommercielle firewalls
\item både IPv4 og IPv6 for Open Source firewalls: IPF, OpenBSD PF,
  Linux firewalls, ...
\item foruddefinerede regler/eksempler - er det godt hvis det er nemt
  at tilføje/åbne en usikker protokol?
\item typisk NAT funktionalitet indbygget
\item typisk mulighed for nogle serverfunktioner: kan agere
  DHCP-server, DNS caching server og lignende
  \end{list2}
\item En router med Access Control Lists - ACL kaldes ofte
  netværksfilter, mens en dedikeret maskine kaldes firewall -
  funktionen er reelt den samme - der filtreres trafik
\end{itemize}

\slide{firewall regelsæt eksempel}

\begin{alltt}
\tiny 
# hosts
router="217.157.20.129"
webserver="217.157.20.131"
# Networks
homenet="{ 192.168.1.0/24, 1.2.3.4/24 }"
wlan="10.0.42.0/24"
wireless=wi0

# things not used
spoofed="{ 127.0.0.0/8, 172.16.0.0/12, 10.0.0.0/16, 255.255.255.255/32 }"

block in all # default block anything
# loopback and other interface rules
pass out quick on lo0 all
pass in quick on lo0 all

# egress and ingress filtering - disallow spoofing, and drop spoofed
block in quick from $spoofed to any
block out quick from any to $spoofed

pass in on $wireless proto tcp from $wlan to any port = 22
pass in on $wireless proto tcp from $homenet to any port = 22
pass in on $wireless proto tcp from any to $webserver port = 80

pass out quick proto tcp  from $homenet to any flags S/S keep state
pass out quick proto udp  from $homenet to any         keep state
pass out quick proto icmp from $homenet to any         keep state
\end{alltt}
%$


\slide{netdesign - med firewalls - 100\% sikkerhed?}

\begin{center}
\colorbox{white}{\includegraphics[width=12cm]{images/kut.jpg}}  
\end{center}

\begin{list1}
\item Hvor skal en firewall placeres for at gøre størst nytte?
\item Hvad er forudsætningen for at en firewall virker?\\
At der er konfigureret et sæt fornuftige regler!
\item Hvor kommer reglerne fra? Sikkerhedspolitikken!
%\item Kan man lave en 100\% sikker firewall? Ja selvfølgelig, se!
\end{list1}


\centerline{\small Kilde: Billedet er fra Marcus Ranum The ULTIMATELY
  Secure Firewall} 




\slide{Confidentiality Integrity Availability}

\vskip 1 cm

{\hlkbig Husk altid de fundamentale principper indenfor sikkerhed}

\hlkimage{15cm}{images/cia-triad.pdf}


\slide{Sikkerhedsteknologier}

\begin{list1}
\item Brug alt hvad I kan overkomme:
\begin{list2}
\item Firewalls: IPfilter, IPtables, OpenBSD PF
\item Kryptografi 
\item Secure Shell - SSH
\item betragt Telnet, Rlogin, Rsh, Rexec som døde!
\item FTP bør kun bruges til anonym FTP
\item Intrusion Detection - Snort
\item Sudo
\item Tripwire, mtree, MD5
\end{list2}
\item Sikkerhedspolitikken er din "plan" for sikkerheden
- og er med til at sikre niveauet er ens
\item Firewalls hjælper ikke mod alle trusler
\end{list1}

\slide{Tip ACK prioritering}

\begin{list1}
\item Daniel Hartemeier som oprindeligt skrev PF har en god hjemmeside\\ \link{http://www.benzedrine.cx/dhartmei.html}
\item Et eksempel er prioritering af ACK pakker, som blot sender acknowledgement - men ellers er tomme
\item Ved at prioritere disse kan man både downloade og uploade med fuld hastighed
\end{list1}

\slide{PF konfigurationen}

\begin{alltt}
\footnotesize
ext_if="kue0"

altq on $ext_if priq bandwidth 100Kb queue \{ q_pri, q_def \}
queue q_pri priority 7
queue q_def priority 1 priq(default)

pass out on $ext_if proto tcp from $ext_if to any flags S/SA 
	keep state queue (q_def, q_pri)

pass in  on $ext_if proto tcp from any to $ext_if flags S/SA 
	keep state queue (q_def, q_pri)
\end{alltt}

\slide{Relayd}

\begin{alltt}
www1="10.0.0.1"
www2="10.0.0.2"
table <webhosts> \{
                   $www1
                   $www2
                 \}
\end{alltt}

relayd - OpenBSD 4.1 og fremefter, tidligere hostated

\begin{quote}
DESCRIPTION
     relayd is a daemon to relay and dynamically redirect incoming connections
     to a target host.  Its main purposes are to run as a load-balancer, ap-
     plication layer gateway, or transparent proxy.  The daemon is able to
     monitor groups of hosts for availability, which is determined by checking
     for a specific service common to a host group.  When availability is con-
     firmed, Layer 3 and/or layer 7 forwarding services are set up by relayd.

\end{quote}

\slide{relayd eksempel}

\begin{alltt}
 table <service> \{ 192.168.1.1, 192.168.1.2, 192.168.2.3 \}
           table <backup> disable \{ 10.1.5.1 retry 2 \}

           redirect "www" \{
                   listen on www.example.com port 80
                   forward to <service> check http "/" code 200
                   forward to <backup> check http "/" code 200
           \}
\end{alltt}

\begin{list1}
\item Den kan checke med HTTP eller ICMP
\item relayd kan forwarde med HTTP/HTTPS
\end{list1}

\slide{PF og integration med andre dele}

\begin{list1}
\item OpenBSD integrerer en masse daemoner og services
\item DHCPD er eksempelvis integreret så man kunne blokere for alle, undtagen dem som har fået en adresse fra DHCPD
\item Login authpf ved ssh login tilføjes regler for en bruger
\item Mange andre steder, for mange til at jeg kan huske dem :-)
\end{list1}


\slide{VLAN Virtual LAN}

\hlkimage{10cm}{vlan-portbased.pdf}

\begin{list1}
\item Nogle switche tillader at man opdeler portene
\item Denne opdeling kaldes VLAN og portbaseret er det mest simple
\item Port 1-4 er et LAN
\item De resterende er et andet LAN
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\end{list1}

\slide{IEEE 802.1q}

\hlkimage{20cm}{vlan-8021q.pdf}

\begin{list1}
\item Nogle switche tillader at man opdeler portene, men tillige benytter 802.1q
\item Med 802.1q tillades VLAN tagging på Ethernet niveau
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\item VLAN trunking giver mulighed for at dele VLANs ud på flere switches
\item Der findes administrationsværktøjer der letter dette arbejde: OpenNAC FreeNAC, Cisco VMPS
\end{list1}

\slide{OpenBSD VLAN}

Normal konfiguration af fast IP på en OpenBSD med hostname.if fil:
\begin{alltt}
hlk@luffe:hlk$ cat /etc/hostname.vr0                                           
inet 10.0.45.2 255.255.255.0 NONE 
inet6 2001:7b8:3e4:0045::2
\end{alltt}

VLAN konfiguration af fast IP på en OpenBSD med hostname.if fil:
\begin{alltt}
hlk@luffe:hlk$ cat /etc/hostname.vlan2 
inet 10.0.72.2 255.255.255.0 NONE \bf{vlan 2 vlandev vr0 }
inet6 2001:7b8:3e4:0072::2
\end{alltt}

\slide{IEEE 802.1x  Port Based Network Access Control}

\hlkimage{15cm}{osx-8021x.png}

\begin{list1}
\item Nogle switche tillader at man benytter 802.1x
\item Denne protokol sikrer at man valideres før der gives adgang til porten
\item Når systemet skal have adgang til porten afleveres brugernavn og kodeord/certifikat
\item Denne protokol indgår også i WPA Enterprise
\end{list1}


\slide{802.1x og andre teknologier}

\begin{list1}
\item 802.1x i forhold til MAC filtrering giver væsentlige fordele
\item MAC filtrering kan spoofes, hvor 802.1x kræver det rigtige kodeord
\item Typisk benyttes RADIUS og 802.1x integrerer således mod både LDAP og Active Directory
\end{list1}

\slide{IPv6 firewalls} 

\begin{alltt}
# remember to allow icmpv6 for neighbour discovery	
pass in inet6 proto ipv6-icmp all icmp6-type neighbradv keep state
pass in inet6 proto ipv6-icmp all icmp6-type routeradv keep state
pass in inet6 all
pass out inet6 all
pass in net6 proto tcp from any to 2001:7b8:3e4:72::20 port = www flags S/SA keep state
\end{alltt}

\begin{list1}
\item IPv6 minder meget om IPv4, men ARP er udskiftet med NDP
\item Mit råd er at bruge aliases så een regel i PF.conf rammer flere hosts
\end{list1}

\slide{ IPv6 neighbor discovery protocol (NDP)}

\hlkimage{20cm}{ipv6-arp-ndp.pdf}

\begin{list1}
\item ARP er væk
\item NDP erstatter og udvider ARP, Sammenlign \verb+arp -an+ med \verb+ndp -an+
\item Til dels erstatter ICMPv6 således DHCP i IPv6, DHCPv6 findes dog
\item {\bf NB: bemærk at dette har stor betydning for firewallregler!}
\end{list1}

\slide{ARP vs NDP}

\begin{alltt}
\small
hlk@bigfoot:basic-ipv6-new$ arp -an        
? (10.0.42.1) at{\bf 0:0:24:c8:b2:4c} on en1 [ethernet]
? (10.0.42.2) at 0:c0:b7:6c:19:b on en1 [ethernet]
hlk@bigfoot:basic-ipv6-new$ ndp -an        
Neighbor                      Linklayer Address  Netif Expire    St Flgs Prbs
::1                           (incomplete)         lo0 permanent R      
2001:16d8:ffd2:cf0f:21c:b3ff:fec4:e1b6 0:1c:b3:c4:e1:b6 en1 permanent R      
fe80::1%lo0                   (incomplete)         lo0 permanent R      
fe80::200:24ff:fec8:b24c%en1 {\bf 0:0:24:c8:b2:4c}      en1 8h54m51s  S  R   
fe80::21c:b3ff:fec4:e1b6%en1  0:1c:b3:c4:e1:b6     en1 permanent R      
\end{alltt}


\slide{IPv4 + IPv6 serviceeksempel}

Først tilføjes aliases i /etc/hosts (kan være DNS) og simpel regel til PF konfigurationsfilen
\begin{alltt}
/etc/hosts:
2001:7b8:3e4:72::20  webserver
10.0.72.20 webserver
/etc/pf.conf:
pass in on $ext_if proto tcp to webserver port http
\end{alltt}

giver så endeligt reglerne:
\begin{alltt}
\footnotesize
pass in on vr3 inet6 proto tcp from any to 2001:7b8:3e4:72::20 port = www flags S/SA keep state
pass in on vr3 inet proto tcp from any to 10.0.72.20 port = www flags S/SA keep state
\end{alltt}

\slide{IPv4 + IPv6 serviceeksempel, med tables}

Istedet for DNS aliases og /etc/hosts kan tilføjes table og simpel regel til PF konfigurationsfilen
\begin{alltt}
table <webservers> { 2001:7b8:3e4:72::20 10.0.72.20 }
...
pass in on $ext_if proto tcp to <webserver> port http
\end{alltt}

giver så endeligt reglen:
\begin{alltt}
\footnotesize
pass in on vr3 proto tcp from any to <webserver> port = www flags S/SA keep state
\end{alltt}


\slide{Opsummering afslutning}

\begin{list1}
\item Husk følgende:
\begin{list2}
\item Husk: IT-sikkerhed er ikke kun netværkssikkerhed!
\item Sikkerhed kommer fra langsigtede intiativer\\
 {\bfseries Vi håber I kan genkende de problemer vi har talt om,
    og finde information om nye problemer i netværk som bliver kendt\\
 eksempelvis nye metoder til scanning eller omgåelse af
    firewalls} 
\item Hvad er informationssikkerhed?
\item Data på elektronisk form
\item Data på fysisk form
\item Social engineering er måske overset - \emph{The Art of Deception: 
Controlling the Human Element of Security}
af Kevin D. Mitnick, William L. Simon, Steve Wozniak
\end{list2}
\item Computer Forensics er reaktion på en hændelse
\item {\bfseries Informationssikkerhed er en proces}
\end{list1}

\slide{Anbefalinger generelt}

\begin{list1}
\item Drop legacy kompatibilitet
\item Udryd gamle usikre
\begin{list2}
\item protokoller - som SSH version 1
\item programmer telnet, FTP, R* - password i klartekst
\item services NT LAN manager
\end{list2}
\item {\bfseries VÆK med dem!}
\item Det handler om sikkerhed, det der ikke er
aktivt kan ikke misbruges
\end{list1}

\slide{Anbefalinger til jer}
% oversigt over dem

{\bf \large Oversigt over anbefalinger} 
\begin{list1}
\item {\bf Følg med!} - læs websites, bøger, artikler, mailinglister, ...
\item {\bf Vurder altid sikkerhed} - skal integreres i processer
\item {\bf Hændelseshåndtering} - du vil komme ud for sikkerhedshændelser
\item {\bf Lav en sikkerhedspolitik} - herunder software og e-mail politik 
\end{list1}

{\hlkbig \bfseries Hver måned offentliggøres ca. 100 nye
sårbarheder i produkter - software/hardware }


\slide{Følg med! - mange kilder}
\begin{list1}
\item {\bf websites} prøv at kigge både på officielle/kommercielle websites
  - men også indimellem på \emph{de små gyder} på Internet 
\item {\bf bøger} der er en god liste over \emph{MUST READ} sikkerhedsbøger
  på adressen\\
\href{http://sun.soci.niu.edu/~rslade/mnbksccd.htm}
{http://sun.soci.niu.edu/\~{}rslade/mnbksccd.htm}
\item {\bf artikler} mange steder, men eksempelvis\\ 
\link{http://www.securityfocus.com}
\item {\bf mailinglister} leverandør ejede lister og generelle - som
  bugtraq og full-disclosure
\item {\bf personer} der findes personer på Internet som er værd at
  holde øje med. Eksempelvis: Bruce Schneiers nyhedsbrev crypto-gram\\
  \link{http://www.counterpane.com/crypto-gram.html}
\end{list1}


\slide{Spørgsmål?}


\vskip 4cm

\begin{center}
\hlkbig 

\myname

\myweb
\vskip 2 cm

I er altid velkomne til at sende spørgsmål på e-mail
\end{center}


\slide{Reklamer: kursusafholdelse}

\begin{list1}
\item Følgende kurser afholdes med mig som underviser
\begin{list2}
\item IPv6 workshop - 1 dag\\
 Introduktion til Internetprotokollerne og forberedelse til
  implementering i egne netværk. 
\item Wireless teknologier og sikkerhed workshop - 1-2 dage\\
En dag med fokus på netværksdesign og fornuftig implementation af
trådløse netværk, samt integration med hjemmepc og
wirksomhedsnetværk. 
\item Hacker workshop 2 dage\\
Workshop med detaljeret gennemgang af hackermetoderne angreb over
netværk, exploitprogrammer, portscanning, Nessus m.fl.
\item Forensics workshop 2 dage\\
Med fokus på tilgængelige open source værktøjer gennemgås metoder og
praksis af undersøgelse af diskimages og spor på computer systemer
\item Moderne Firewalls og Internetsikkerhed 2 dage\\
Informere om trusler og aktivitet på Internet, samt give et bud
på hvorledes en avanceret moderne firewall idag kunne konfigureres.
\end{list2}
\end{list1}

Se mere på \link{http://www.security6.net/courses.html}

\slide{Network Security Tools}

\hlkimage{5cm}{images/network-security-tool-ora.jpg}
\begin{list1}
\item \emph{Network Security Tools : Writing, Hacking, and Modifying
    Security Tools} Nitesh Dhanjani, Justin Clarke, O'Reilly 2005, ISBN:
    0596007949 
 \end{list1}

\slide{}

\hlkimage{5cm}{images/freebsd-openbsd-security-tools-ora.jpg}
\begin{list1}
\item \emph{Mastering FreeBSD and OpenBSD Security} Yanek Korff, Paco
  Hope, Bruce Potter, O'Reilly, 2005, ISBN: 0596006268
\end{list1}

\slide{Hackers Challenge}

\begin{center}
\colorbox{white}{
\includegraphics[width=3cm]{images/hackers-challenge.jpg}
\includegraphics[width=33mm]{images/hackers-challenge2.jpg}}
\end{center}

\begin{list1}
%\item Hændelseshåndtering - øvelse som I kigger på i weekenden
%\item Opgaverne er kopieret fra bogen 
\item \emph{Hacker's Challenge : Test Your Incident Response Skills Using 20 Scenarios}
 af Mike Schiffman McGraw-Hill Osborne Media; (October 18, 2001) ISBN:
 0072193840
\item \emph{Hacker's Challenge II : Test Your Network Security and
 Forensics Skills} 
 af Mike Schiffman McGraw-Hill Osborne Media, 2003 ISBN: 0072226307
\item Bogen indeholder scenarier i første halvdel, og løsninger i
  anden halvdel - med fokus på relevante logfiler og sårbarheder  
\item Hackers challenge nr 3 udkommer i 2006
\end{list1}


\slide{Network Security Assessment}

\begin{center}
\colorbox{white}{
\includegraphics[width=6cm]{images/oreilly-networksa.png}}
\end{center}

\begin{list1}
%\item Hændelseshåndtering - øvelse som I kigger på i weekenden
%\item Opgaverne er kopieret fra bogen 
\item \emph{Network Security Assessment 
Know Your Network}
 af Chris McNab, O'Reilly Marts 2004 ISBN: 0-596-00611-X
\item Bogen er anbefalelsesværdig
\item Der kan hentes kapitel 4 som PDF - \emph{IP Network Scanning}
\end{list1}

\slide{Counter Hack}

\hlkimage{6cm}{images/counter-hack.jpg}

\begin{list1}
\item \emph{Counter Hack: A Step-by-Step Guide to Computer Attacks and
Effective Defenses}, Ed Skoudis, Prentice Hall PTR, 1st edition July 2001
\item Bogen er anbefalelsesværdig og er kommet i anden udgave
\item Minder mig om et universitetskursus i opbygningen
\end{list1}

\slide{Hackerværktøjer}
% måske til reference afsnit?

\begin{list2}
\item nmap - \link{http://www.insecure.org} portscanner
\item Nessus - \link{http://www.nessus.org} automatiseret testværktøj
%\item libnet m.fl. - \link{http://www.packetfactory.net} - diverse projekter
%  relateret til pakker og IP netværk
\item l0phtcrack - \link{http://www.atstake.com/research/lc/} - The Password
  Auditing and Recovery Application, kig også på Cain og Abel fra
  \link{http://oxid.it} hvis det skal være gratis
\item Wireshark - \link{http://www.wireshark.org} avanceret netværkssniffer
%\item F.I.R.E -  \link{http://biatchux.dmzs.com/} - en cd-rom der indeholder en 
%  bootable Linux del.
\item OpenBSD - \link{http://www.openbsd.org} operativsystem med fokus
  på sikkerhed 
\item \link{http://www.isecom.org/} - Open Source Security Testing
  Methodology Manual - gennemgang af elementer der bør indgå i en struktureret test 
\item Putty - 
\link{http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html}

terminal emulator med indbygget SSH

\item 
\link{http://www.remote-exploit.org} - Backtrack security collection -
en boot CD med hackerværktøjer
\end{list2}

\slide{Referencer}

\begin{list1}
\item Anbefalede bøger:
\begin{list2}
\item \emph{Computer Forensics: Incident Response Essentials}, Warren
  G. Kruse II og Jay G. Heiser, Addison-Wesley, 2002.
\item \emph{Incident Response}, E. Eugene Schultz og Russel Shumway,
  New Riders, 2002
\item \emph{CISSP All-in-One Certification Exam Guide}, Shon Harris 
McGraw-Hill/Osborne, 2002
\item \emph{Network Intrusion Detection}, Stephen Northcutt og Judy Novak, New
  Riders, 2nd edition, 2001
\item \emph{Intrusion Signatures and Analysis}, Stephen Northcutt et al, New
  Riders, 2001
\item \emph{Practical UNIX and Internet Security}, Simson Garfinkel og
  Gene Spafford, 2nd edition
\item \emph{Firewalls and Internet Security},  Cheswick,
  Bellovin og Rubin, Addison-Wesley, 2nd edition, 2003
\item \emph{Hacking Exposed}, Scambray et al, 4th edition, Osborne, 2003 
  - tror der er en nyere  
  \item \emph{Building Open Source Network Security Tools}, Mike
  D. Schiffman, Wiley 2003 
\item \emph{Gray Hat Hacking : The Ethical Hacker's Handbook} Shon
  Harris, Allen  Harper, Chris  Eagle, Jonathan  Ness,
  Michael Lester, McGraw-Hill Osborne Media 2004, ISBN: 0072257091
\end{list2}
\end{list1}


\slide{Referencer}

\begin{list1}
\item Internet
  \begin{list2}
  \item \link{http://www.project.honeynet.org} - diverse honeynet projekter
  information om pakker og IP netværk. Har flere forensics challenges
  hvor man kan hente images og foretage sin egen analyse
  \item \link{http://www.packetfactory.net} - diverse projekter
  relateret til pakker og IP netværk eksempelvis libnet

\item \link{http://www.isecom.org/} - Open Source Security Testing
  Methodology Manual - Hvordan laver man struktureret test! 

\end{list2}
\item Mailinglists
  \begin{list2}
    \item securityfocus m.fl. - de fleste producenter og væktøjer
    har mailinglister tilknyttet
  \end{list2}
\item Papers - der findes MANGE dokumenter på Internet
\begin{list2}
\item \emph{Security Problems in the TCP/IP Protocol Suite},
  S.M. Bellovin, 1989 og fremefter
\end{list2}
\end{list1}

\slide{Packet factory projects}

\begin{center}
\colorbox{white}{\includegraphics[width=20cm]{images/packetfactory-header.jpg}}
\end{center}

\begin{list2}
\item Projects (udvalgte):
\item firewalk [gateway ACL scanner]
\item firestorm (in development) [next 
  generation scanner]
\item ISIC [IP stack integrity checker]
\item libnet [network packet assembly/injection library]     
\item libradiate [802.11b frame assembly/injection library]     
\item nemesis [command line IP stack]     
\item ngrep [GNU grep for the network]     
\item packit [tool to monitor, and inject customized IPv4 traffic]     
\item Billede og information fra \link{http://www.packetfactory.net}
\end{list2}



\slide{CISSP fra ISC2}

\hlkimage{16cm}{images/cissp-logo.png}

\begin{list1}
\item Primære website: \link{http://www.isc2.org}
\item Vigtigt link \link{http://www.cccure.org/}
\item Den kræver mindst 3 års erfaring indenfor et relevant fagområde
\item Multiple choice 6 timer 250 spørgsmål - kan tages i Danmark
\end{list1}



\slide{GIAC GSEC krav}

\hlkimage{4cm}{images/SANS-logo.png}

\begin{list1}
\item Security Essentials - basal sikkerhed
\item Krav om en \emph{Practical assignment} - mindst 8 sider, 15
  sider i gennemsnit
\item multiple choice eksamen
\item Primære website: \link{http://www.giac.org}
\item Reading room: \link{http://www.sans.org/rr/}
\item Der findes en god oversigt i filen 
\emph{GIAC Certification: Objectives and Curriculum}\\
  \link{http://www.giac.org/overview/brief.pdf}

\end{list1}


\end{document}
