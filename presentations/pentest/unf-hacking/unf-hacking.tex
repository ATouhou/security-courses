\documentclass[20pt,landscape,a4paper]{foils}

% HLK/ security6
%\usepackage{sec6slides}
\usepackage{solido-network-slides}
%\externaldocument{unix-audit-security-oevelser}
\externaldocument{\jobname-exercises}


% nyheder:
% http://portswigger.net/proxy/download.html Burp proxy kan ændre
% requests
% husk 
% mindre tcpdump, mere "øvelse 1" "øvelse 2" osv.
% mine setups med John the ripper fra sylvester, evt kombineret med googlehacking?
% lidt cutenews?
% lidt mindre om dcom
% input fra Grey Hat Hacking bogen metasploit intro? kan måske 
% erstatte/udvide dcom som eksempel?

% Basic things that we need are below
\begin{document}
\selectlanguage{danish}

\mytitlepage
{Basic hacking - black/white hat}



\slide{Formålet med foredraget}
\vskip 2 cm


\hlkimage{5cm}{dont-panic.png}
\centerline{\color{titlecolor}\LARGE Don't Panic!}

\begin{list1}
\item Skabe en forståelse for hackerværktøjer
  samt penetrationstest metoder

\item Design af netværk til minimering af risici.
\end{list1}



\slide{Aftale om test af netværk}

{\bfseries Straffelovens paragraf 263 Stk. 2. Med bøde eller fængsel
  indtil 6 måneder 
straffes den, som uberettiget skaffer sig adgang til en andens
oplysninger eller programmer, der er bestemt til at bruges i et anlæg
til elektronisk databehandling.}

Hacking kan betyde:
\begin{list2}
\item At man skal betale erstatning til personer eller virksomheder
\item At man får konfiskeret sit udstyr af politiet
\item At man, hvis man er over 15 år og bliver dømt for hacking, kan
  få en bøde - eller fængselsstraf i alvorlige tilfælde 
\item At man, hvis man er over 15 år og bliver dømt for hacking, får
en plettet straffeattest. Det kan give problemer, hvis man skal finde
et job eller hvis man skal rejse til visse lande, fx USA og
Australien
\item Frit efter: \link{http://www.stophacking.dk} lavet af Det
  Kriminalpræventive Råd 
\item Frygten for terror har forstærket ovenstående - så lad være!
\end{list2}



\slide{Internet idag}

\hlkimage{14cm}{images/server-client.pdf}

\begin{list1}
\item Klienter og servere
\item Rødder i akademiske miljøer
\item Protokoller der er op til 20 år gamle
\item Meget lidt kryptering, mest på http til brug ved e-handel 
\end{list1}

\slide{Teknisk hvad er hacking}

\hlkimage{17cm}{buffer-overflow-3.pdf}


\slide{Trinity breaking in}

\hlkimage{20cm}{trinity-nmapscreen-hd-cropscale-418x250.jpg}
\link{http://nmap.org/movies.html}\\
Meget realistisk \link{http://www.youtube.com/watch?v=51lGCTgqE_w}



\slide{Hacking er magi}

\hlkimage{7cm}{wizard_in_blue_hat.png}

\vskip 1 cm

\centerline{Hacking ligner indimellem  magi}


\slide{Hacking er ikke magi}

\hlkimage{17cm}{ninjas.png}

\vskip 1 cm
\centerline{Hacking kræver blot lidt ninja-træning}


\slide{Hackerværktøjer}

\begin{list1}
\item \emph{Improving the Security of Your Site by Breaking Into it} af
Dan Farmer og Wietse Venema i 1993 
\item De udgav i 1995 så en softwarepakke med navnet SATAN
\emph{Security Administrator Tool for Analyzing Networks}
\item De forårsagede en del panik og furore, alle kan hacke, verden bryder sammen

\vskip 1cm
\begin{quote}
We realize that SATAN is a two-edged sword - like
many tools, it can be used for good and for evil
purposes. We also realize that intruders (including
wannabees) have much more capable (read intrusive)
tools than offered with SATAN. 
\end{quote}
\end{list1}

\vskip 1cm
Kilde:
\link{http://www.fish2.com/security/admin-guide-to-cracking.html}


\slide{Værktøjer}

\begin{list1}
\item Alle bruger nogenlunde de samme værktøjer
\begin{list2}
\item Portscanner - Fydor Nmap
\item Generel sårbarhedsscanner - OpenVAS/Nessus, Metasploit 
\item Specialscannere, eksempelvis web sårbarhedsscanner - eksempelvis Nikto, Skipfish
\item Specielle scannere - wifi Aircrack-ng, m.fl. 
\item ...
\item Rapportværktøj - manuel eller automatisk, helst så automatiseret
  som muligt   
\item Meget ofte er sikkerhedstest automatiseret på de indledende
  skridt og manuel derefter
\end{list2}
\item og scripting, powershell, unix shell, perl, python, ruby, ...
\end{list1}



\slide{Bøger og resourcer}

\centerline{Konsulentens udstyr - vil du være sikkerhedskonsulent}

\begin{list1}
\item Sikkerhedskonsulenterne bruger typisk Open Source værktøjer på Linux og
enkelte systemer med Windows - jeg bruger helst Windows 7 idag
\item Laptops, gerne flere, men een er nok til at lære!
\begin{list2}
\item \emph{A Hands-On Introduction to Hacking
by Georgia Weidman}, June 2014\\
 \link{http://www.nostarch.com/pentesting}
\item \emph{Metasploit The Penetration Tester's Guide}
by David Kennedy, Jim O'Gorman, Devon Kearns, and Mati Aharoni\\
\link{http://nostarch.com/metasploit}
\item Metasploit Unleashed - gratis kursus i Metasploit\\
\link{http://www.offensive-security.com/metasploit-unleashed/}
\end{list2}
\end{list1}


% slides start
\slide{Forudsætninger}

\begin{list1}
\item Teknisk foredrag og fuldt udbytte kræver at
  deltagerne har mindst 2 års praktisk erfaring som teknikker og/eller
  systemadministrator
%\item Vi gennemgår mange forskellige ting - ofte i detaljer
\item Til penetrationstest og det meste Internet-sikkerhedsarbejde er der
 følgende forudsætninger
\begin{list2}
\item Netværkserfaring
\item TCP/IP principper - ofte i detaljer
\item Programmmeringserfaring er en fordel
\item Linux/UNIX kendskab er ofte en {\bfseries nødvendighed}\\
- fordi de nyeste værktøjer er skrevet til UNIX i form af Linux og BSD
\vskip 3 mm
\item Alle øvelser kan udføres fra en Windows PC eller Mac
\item Øvelserne foregår via virtualiserede systemer
\end{list2}
\end{list1}



\slide{Hackerværktøjer}
% måske til reference afsnit?
\hlkimage{3cm}{hackers_JOLIE+1995.jpg}

\begin{list2}
\item Nmap, Nping - tester porte, godt til firewall admins \link{http://nmap.org}
\item Metasploit Framework gratis på \link{http://www.metasploit.com/}
\item Wireshark avanceret netværkssniffer - \link{http://http://www.wireshark.org/} 
%\item Paros proxy \link{http://www.parosproxy.org}
\item Burpsuite \link{http://portswigger.net/burp/}
\item Skipfish \link{http://code.google.com/p/skipfish/}
\item OpenBSD operativsystem med fokus
  på sikkerhed  \link{http://www.openbsd.org} 
\end{list2}

Kilde: Angelina Jolie fra Hackers 1995


\slide{Hvad skal der ske?}

\begin{list1}
\item Tænk som en hacker
\item Rekognoscering
\begin{list2}
\item ping sweep, port scan
\item OS detection - TCP/IP eller banner grab
\item Servicescan - rpcinfo, netbios, ...
\item telnet/netcat interaktion med services
\end{list2}
\item Udnyttelse/afprøvning: Metasploit, Nikto, exploit programs
\item Oprydning/hærdning vises måske ikke, men I bør i praksis:
\begin{list2}
\item Lav en rapport
\item Ændre, forbedre og hærde systemer
\item Gennemgå rapporten, registrer ændringer
\item Opdater programmer, konfigurationer, arkitektur, osv. 
\end{list2}
\item I skal jo også VISE andre at I gør noget ved sikkerheden.
\end{list1}


\slide{Hackerlab opsætning}

\hlkimage{10cm}{hacklab-1.png}

\begin{list2}
\item Hardware: en moderne laptop med CPU der kan bruge virtualiseting\\
Husk at slå virtualisering til i BIOS
\item Software: dit favoritoperativsystem, Windows, Mac, Linux
\item Virtualiseringssoftware: VMware, Virtual box, vælg selv
\item Hackersoftware: Kali Linux som en virtuel maskine
\item Soft targets: Metasploitable, Windows 2000, Windows Xp, ...
\end{list2}



\slide{OSI og Internet modellerne}

\hlkimage{14cm,angle=90}{images/compare-osi-ip.pdf}


\slide{The Internet Worm 2. nov 1988}

\begin{list1}
\item Udnyttede følgende sårbarheder
\begin{list2}
\item buffer overflow i fingerd - VAX kode
\item  Sendmail - DEBUG
\item Tillid mellem systemer: rsh, rexec, ...
\item dårlige passwords
\end{list2}
\item Avanceret + camouflage!
\begin{list2}
\item Programnavnet sat til 'sh'
\item Brugte fork() til at skifte PID jævnligt
\item password cracking med intern liste med 432 ord og /usr/dict/words
\item Fandt systemer i /etc/hosts.equiv, .rhosts, .forward, netstat ...
\end{list2}
\item Lavet af Robert T. Morris, Jr. 
\item Medførte dannelsen af CERT, \link{http://www.cert.org}
\end{list1}


\slide{Wireshark - grafisk pakkesniffer}

\hlkimage{20cm}{images/wireshark-website.png} 

\centerline{\link{http://www.wireshark.org}}
\centerline{både til Windows og Unix}


\slide{Brug af Wireshark}

\hlkimage{19cm}{images/wireshark-http.png}

\centerline{Læg mærke til filtermulighederne}


\slide{traceroute}

\begin{list1}
  \item traceroute programmet virker ved hjælp af TTL
\item levetiden for en pakke tælles ned i hver router på vejen og ved at sætte denne lavt
  opnår man at pakken \emph{timer ud} - besked fra hver router på vejen
\item default er UDP pakker, men på UNIX systemer er der ofte mulighed
  for at bruge ICMP
\end{list1}

\begin{alltt}
\small{\bfseries $ traceroute 91.102.91.18}
traceroute to 91.102.91.18 (91.102.91.18), 64 hops max
 1  192.168.1.1 (192.168.1.1)  4.212 ms  6.932 ms  3.345 ms
 2  89.150.142.1 (89.150.142.1)  33.975 ms  24.961 ms  26.780 ms
 3  ge0-0-0.dex1.vby.dk.ip.fullrate.dk (90.185.4.17)  25.698 ms  41.764 ms  30.929 ms
 4  te5-1.cosw1.hoer.dk.ip.fullrate.dk (90.185.7.77)  25.540 ms  30.221 ms  33.503 ms
 5  te6-1.alb2nxc7.dk.ip.tdc.net (87.54.42.85)  27.565 ms  42.934 ms  25.277 ms
 6  so-4-0-0.ar1.cph1.gblx.net (64.208.110.21)  31.336 ms  28.399 ms  25.565 ms
 7  ge1-2-10g.ar3.cph1.gblx.net (67.17.105.246)  43.153 ms  33.472 ms  27.527 ms
 8  64.211.195.226 (64.211.195.226)  26.504 ms  36.456 ms  26.321 ms
 9  91.102.91.18 (91.102.91.18)  32.093 ms  29.654 ms  29.368 ms
\end{alltt}


\slide{Network mapping}

\hlkimage{23cm}{images/network-example.pdf}

\begin{list1}
\item Ved brug af traceroute og tilsvarende programmer kan man ofte
  udlede topologien i det netværk man undersøger  
\end{list1}


\slide{Informationsindsamling}

\begin{list1}
\item Det vi har udført er informationsindsamling
\item Indsamlingen kan være aktiv eller passiv indsamling i forhold
  til målet for angrebet
\item passiv kunne være at lytte med på trafik eller søge i databaser
  på Internet
\item aktiv indsamling er eksempelvis at sende netværkspakker og portscanne
\end{list1}


\slide{whois systemet}

\begin{list1}
\item IP adresserne administreres i dagligdagen af et antal Internet
  registries, hvor de største er:
\begin{list2}
\item RIPE (Réseaux IP Européens)  \link{http://ripe.net}
\item ARIN American Registry for Internet Numbers \link{http://www.arin.net}
\item Asia Pacific Network Information Center \link{http://www.apnic.net}
\item LACNIC (Regional Latin-American and Caribbean IP Address
  Registry) - Latin America and some Caribbean Islands
  \link{http://www.lacnic.net} 
\item AfriNIC African Internet Numbers Registry \link{http://www.afrinic.net}
\end{list2}
\item disse fem kaldes for Regional Internet Registries (RIRs) i
  modsætning til Local Internet Registries (LIRs) og National Internet
  Registry (NIR) 
\end{list1}



%\slide{top leveldomæner og DNS}


\slide{DNS systemet}
 
\begin{list1}
\item navneopslag på Internet  
\item tidligere brugte man en {\bfseries hosts} fil\\
  hosts filer bruges stadig lokalt til serveren - IP-adresser
\item UNIX: /etc/hosts
\item Windows \verb+c:\windows\system32\drivers\etc\hosts+
\item består af resource records med en type:
  \begin{list2}
  \item adresser A-records, IPv6 adresser AAAA-records
  \item autoritative navneservere NS-records, post, mail-exchanger MX-records
  \item flere andre: md ,  mf ,  cname ,  soa ,
    mb , mg ,  mr ,  null ,  wks ,  ptr ,
    hinfo ,  minfo ,  mx ....
  \end{list2}
\end{list1}
\begin{alltt}
        IN      MX      10      zfront01.solido.net.
        IN      MX      20      zfront02.solido.net.
www     IN      A       91.102.95.20
www     IN      AAAA    2a02:9d0:10::9
\end{alltt}


\slide{Små DNS tools bind-version - Shell script}

\begin{alltt}\small
#! /bin/sh
# Try to get version info from BIND server
PROGRAM=`basename $0`
. `dirname $0`/functions.sh
if [ $# -ne 1 ]; then
   echo "get name server version, need a target! "
   echo "Usage: $0 target"
   echo "example $0 10.1.2.3"
   exit 0
fi
TARGET=$1
# using dig 
start_time
dig @$1 version.bind chaos txt
echo Authors BIND er i versionerne 9.1 og 9.2 - måske ...
dig @$1 authors.bind chaos txt
stop_time
\end{alltt}
\centerline{\link{http://www.kramse.dk/files/tools/dns/bind-version}}

\slide{Små DNS tools dns-timecheck - Perl script}

\begin{alltt}\small
#!/usr/bin/perl
# modified from original by Henrik Kramshøj, hlk@kramse.dk
# 2004-08-19
#
# Original from: http://www.rfc.se/fpdns/timecheck.html
use Net::DNS;

my $resolver = Net::DNS::Resolver->new;
$resolver->nameservers($ARGV[0]);

my $query = Net::DNS::Packet->new;
$query->sign_tsig("n","test");

my $response = $resolver->send($query);
foreach my $rr ($response->additional) {
  print "localtime vs nameserver $ARGV[0] time difference: ";
  print$rr->time_signed - time() if $rr->type eq "TSIG";
}  
\end{alltt}
\centerline{\link{http://www.kramse.dk/files/tools/dns/dns-timecheck}}


\slide{Hvordan virker ARP?}

\begin{center}
\colorbox{white}{\includegraphics[width=18cm]{images/arp-basic.pdf}}  
\end{center}

%server 00:30:65:22:94:a1\\
%client 00:40:70:12:95:1c\\
%hacker 00:02:03:04:05:06\\

\slide{Hvordan virker ARP? - 2}
\begin{list1}
\item {\bfseries ping 10.0.0.2} udført på server medfører
\item ARP Address Resolution Protocol request/reply:
  \begin{list2}
  \item ARP request i broadcast - Who has 10.0.0.2 Tell 10.0.0.1
  \item ARP reply (fra 10.0.0.2) 10.0.0.2 is at 00:40:70:12:95:1c
  \end{list2}
\item IP ICMP request/reply:
  \begin{list2}
    \item Echo (ping) request fra 10.0.0.1 til 10.0.0.2
\item Echo (ping) reply fra 10.0.0.2 til 10.0.0.1
\item ...
  \end{list2}
\item ARP udføres altid på Ethernet før der kan sendes IP trafik
\item (kan være RARP til udstyr der henter en adresse ved boot)
\end{list1}


\slide{Hvordan virker ARP spoofing?}

\begin{center}
\colorbox{white}{\includegraphics[width=15cm]{images/arp-spoof.pdf}}  
\end{center}

\begin{list1}
\item Hackeren sender forfalskede ARP pakker til de to parter
\item De sender derefter pakkerne ud på Ethernet med hackerens MAC
  adresse som modtager - han får alle pakkerne
\end{list1}



\slide{dsniff}

\begin{list1}
\item en sniffer til mange usikre protokoller
\item inkluderer {\bfseries arpspoof}  
\item Lavet af Dug Song, dugsong@monkey.org
\end{list1}

\begin{alltt}
dsniff  is  a  password sniffer which handles FTP, Telnet,
SMTP, HTTP, POP, poppass, NNTP, IMAP, SNMP, LDAP,  Rlogin,
RIP,  OSPF,  PPTP  MS-CHAP, NFS, VRRP, YP/NIS, SOCKS, X11,
CVS, IRC, AIM, ICQ, Napster,  PostgreSQL,  Meeting  Maker,
Citrix  ICA,  Symantec  pcAnywhere, NAI Sniffer, Microsoft
SMB, Oracle SQL*Net, Sybase and Microsoft SQL protocols.
\end{alltt}

\slide{dsniff forudsætninger}

\begin{list1}
\item Der er visse forudsætninger der skal være opfyldt
  \begin{list2}
\item Man skal have trafikken
\item Det kan gøres gennem arp spoofing eller ved at hacke ind i et
  system/router på netværksvejen
\end{list2}
\end{list1}

\begin{center}
  \colorbox{white}{\includegraphics[width=12cm]{images/arp-spoof.pdf}}  
\end{center}

\slide{Forsvar mod ARP spoofing}

\begin{list1}
\item Hvad kan man gøre? 
\item låse MAC adresser til porte på switche
\item låse MAC adresser til bestemte IP adresser
\item Efterfølgende administration!
\vskip 1 cm
\item {\bfseries arpwatch er et godt bud} - overvåger ARP
\item bruge protokoller som ikke er sårbare overfor opsamling
\end{list1}


\slide{Kommenteret dsniff}

\hlkimage{22cm}{images/dsniff-comments.pdf}


\slide{netværksdesign og sikkerhed}

\hlkimage{12cm}{images/kursus-netvaerk.pdf}

\begin{list1}
  \item Hvad kan man gøre for at få bedre netværkssikkerhed?
    \begin{list2}
    \item bruge switche - der skal ARP spoofes og bedre performance
    \item opdele med firewall til flere DMZ zoner for at holde
      udsatte servere adskilt fra hinanden, det interne netværk og
      Internet
    \item overvåge, læse logs og reagere på hændelser 
    \end{list2}
\end{list1}



% session 1-6
% basal portscanning og intro til cd-rom
\slide{Basal Portscanning}

\begin{list1}
  \item Hvad er portscanning
\item afprøvning af alle porte fra 0/1 og op til 65535
\item målet er at identificere åbne porte - sårbare services
\item typisk TCP og UDP scanning
\item TCP scanning er ofte mere pålidelig end UDP scanning
\end{list1}

{\hlkbig TCP handshake er nemmere at identificere

UDP applikationer svarer forskelligt - hvis overhovedet}

\slide{TCP three way handshake}

\hlkimage{7cm}{images/tcp-three-way.pdf}

\begin{list2}
\item {\bfseries TCP SYN half-open} scans
\item Tidligere loggede systemer kun når der var etableret en fuld TCP
  forbindelse - dette kan/kunne udnyttes til \emph{stealth}-scans
\item Hvis en maskine modtager mange SYN pakker kan dette fylde
  tabellen over connections op - og derved afholde nye forbindelser
  fra at blive oprette - {\bfseries SYN-flooding}
\end{list2}


\slide{Ping og port sweep}

\begin{list1}
\item scanninger på tværs af netværk kaldes for sweeps 
\item Scan et netværk efter aktive systemer med PING
\item Scan et netværk efter systemer med en bestemt port åben
\item Er som regel nemt at opdage:
  \begin{list2}
    \item konfigurer en maskine med to IP-adresser som ikke er i brug
\item hvis der kommer trafik til den ene eller anden er det portscan
\item hvis der kommer trafik til begge IP-adresser er der nok
  foretaget et sweep - bedre hvis de to adresser ligger et stykke fra hinanden
  \end{list2}

\end{list1}


\slide{Portscan med Zenmap GUI}

\hlkimage{17cm}{nmap-zenmap.png}

\centerline{Zenmap følger med i pakken når man henter Nmap \link{http://nmap.org}}

% afslutning dag 1
\slide{Erfaringer hidtil}

\begin{list1}
\item Mange oplysninger
\item kan man stykke oplysningerne sammen kan man sige en hel del om
  netværket 
\item en skabelon til registrering af maskiner er god
  \begin{list2}
    \item svarer på ICMP: $\Box$\  echo, $\Box$\ mask, $\Box$\ time
\item svarer på traceroute: $\Box$\ ICMP, $\Box$\ UDP
\item Åbne porte TCP og UDP: 
\item Operativsystem:
\item ... (banner information m.v.)
  \end{list2}
\vskip 2cm 
\item Mange små pakker kan oversvømme store forbindelser og
  give problemer for netværk
\end{list1}




\slide{brute force}


\begin{alltt}
\small
Hydra v2.5 (c) 2003 by van Hauser / THC <vh@thc.org>
Syntax: hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]] 
[-o FILE] [-t TASKS] [-g TASKS] [-T SERVERS] [-M FILE] [-w TIME] 
[-f] [-e ns] [-s PORT] [-S] [-vV] server service [OPT]

Options:
  -S        connect via SSL
  -s PORT   if the service is on a different default port, define it here
  -l LOGIN  or -L FILE login with LOGIN name, or load several logins from FILE
  -p PASS   or -P FILE try password PASS, or load several passwords from FILE
  -e ns     additional checks, "n" for null password, "s" try login as pass
  -C FILE   colon seperated "login:pass" format, instead of -L/-P option
  -M FILE   file containing server list (parallizes attacks, see -T)
  -o FILE   write found login/password pairs to FILE instead of stdout
...  
\end{alltt}

\link{http://www.thc.org/thc-hydra/}\\
hvad betyder bruteforcing?

\slide{bruteforge}

\begin{quote}
Why another one?
Words are generated in a bruteforce fashion but, when a condition takes place, it skips forward to the next valid word!
User can define charset, maximum number of uses for every char in charset, patterns/repetitions to exclude.
User can trim down number of combinations generated excluding 'invalid' words by setting some criteria.
\end{quote}

\begin{list1}
\item Hvordan laver man rigtigt bruteforce?
\item Skal man teste ALT - A, AA, AAA, AAAA, AAAAA, AAAAAAAAA
\end{list1}

\link{http://masterzorag.blogspot.com/}

\slide{Cracking passwords}

\begin{list2}
\item Hashcat is the world's fastest CPU-based password recovery tool.
\item oclHashcat-plus is a GPGPU-based multi-hash cracker using a brute-force attack (implemented as mask attack), combinator attack, dictionary attack, hybrid attack, mask attack, and rule-based attack.
\item oclHashcat-lite is a GPGPU cracker that is optimized for cracking performance. Therefore, it is limited to only doing single-hash cracking using Markov attack, Brute-Force attack and Mask attack.
\item John the Ripper password cracker old skool men stadig nyttig
\end{list2}

Source:\\
\link{http://hashcat.net/wiki/}\\
\link{http://www.openwall.com/john/}

\slide{Parallella John}

\hlkimage{20cm}{parallella-john.png}

\link{https://twitter.com/solardiz/status/492037995080712192}

Warning: FPGA hacking - not finished part of presentation \smiley

\slide{Stacking Parallella boards}
\hlkimage{16cm}{4BoardStack.jpg}

\link{http://www.parallella.org/power-supply/}


\slide{Real life bruteforce? Found in on real server}
\begin{alltt}
root:admin:87.x.202.63
admin:admin:91.x.104.207
admin:0767390145:x.72.110.84
admin:0767390145:89.xx.163.73
admin:0767390145:89.x.142.153
root:root:186.x.39.228
admin:admin:189.x.160.98
root:dumn3z3u:189.x.216.232
admin:0767390145:189.x.36.247
root:admin:169.x.34.145
root:default:66.x.33.138
root:default:66.x.33.138
root:111111:213.x.89.250
admin:admin:91.x.52.114
admin:0767390145:195.x.246.131
admin:0767390145:195.x.246.131
\end{alltt}




\slide{Overflow - segmentation fault }

\hlkimage{20cm}{buffer-overflow-2.pdf}


\begin{list1}
\item Bad function overwrites return value!
\item Control return address
\item Run shellcode from buffer, or from other place
\end{list1}



\slide{buffer overflows et C problem}

\begin{list1}
\item {\bfseries Et buffer overflow}
er det der sker når man skriver flere data end der er afsat plads til
i en buffer, et dataområde. Typisk vil programmet gå ned, men i visse
tilfælde kan en angriber overskrive returadresser for funktionskald og
overtage kontrollen. 
\item {\bfseries Stack protection} 
er et udtryk for de systemer der ved hjælp af operativsystemer,
programbiblioteker og lign. beskytter stakken med returadresser og
andre variable mod overskrivning gennem buffer overflows. StackGuard
og Propolice er nogle af de mest kendte.
\end{list1}

\slide{Buffer og stacks}

\hlkimage{20cm}{buffer-overflow-1.pdf}

\begin{alltt}
main(int argc, char **argv)
\{      char buf[200];
        strcpy(buf, argv[1]); 
        printf("%s\textbackslash{}n",buf);
\}
\end{alltt}


\slide{Overflow - segmentation fault }

\hlkimage{20cm}{buffer-overflow-2.pdf}


\begin{list1}
\item Bad function overwrites return value!
\item Control return address
\item Run shellcode from buffer, or from other place
\end{list1}


\slide{Exploits - udnyttelse af sårbarheder}

\begin{list1}
\item exploit/exploitprogram er
\begin{list2}
\item udnytter eller demonstrerer en sårbarhed
\item rettet mod et specifikt system.
\item kan være 5 linier eller flere sider
\item Meget ofte Perl eller et C program 
\end{list2}
\end{list1}


\slide{Exploits}

\vskip 1 cm

\begin{alltt}
$buffer = ""; 
$null = "\textbackslash{}x00"; \pause
$nop = "\textbackslash{}x90"; 
$nopsize = 1; \pause
$len = 201; // what is needed to overflow, maybe 201, maybe more!
$the_shell_pointer = 0xdeadbeef; // address where shellcode is 
# Fill buffer
for ($i = 1; $i < $len;$i += $nopsize) \{
    $buffer .= $nop;
\}\pause
$address = pack('l', $the_shell_pointer);
$buffer .= $address;\pause
exec "$program", "$buffer";
\end{alltt}
\vskip 1 cm
\centerline{Demo exploit in Perl}



\slide{Debugging af C med GDB}

\begin{list1}
\item Vi laver sammen en session med GDB
\item Afprøvning med diverse input
\begin{list2}
\item \verb+./demo langstrengsomgiverproblemerforprogrammethvorformon+    
\item \verb+gdb demo+ efterfulgt af run med parametre\\
\verb+run AAAAAAAAAAAAAAAAAAAAAAAAAAAAA+
\end{list2}
\end{list1}

{\bfseries Hjælp:}\\
Kompiler programmet og kald det fra kommandolinien med 
\verb+./demo 123456...7689+ indtil det dør ... derefter prøver I det
samme i GDB

Hvad sker der? Avancerede brugere kan ændre 
\verb+strcpy+ til \verb+strncpy+


\slide{GDB output}

\begin{alltt}
\small
hlk@bigfoot:demo$ gdb demo
GNU gdb 5.3-20030128 (Apple version gdb-330.1) (Fri Jul 16 21:42:28 GMT 2004)
Copyright 2003 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "powerpc-apple-darwin".
Reading symbols for shared libraries .. done
(gdb) {\bf run AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA}
Starting program: /Volumes/userdata/projects/security/exploit/demo/demo AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Reading symbols for shared libraries . done
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Program received signal EXC_BAD_ACCESS, Could not access memory.
{\bf 0x41414140} in ?? ()
(gdb) 
\end{alltt}
%$

\slide{Hvordan finder man buffer overflow, og andre fejl}

\begin{list1}
\item Black box testing
\item Closed source reverse engineering
\item White box testing
\item Open source betyder man kan læse og analysere koden 
\item Source code review - automatisk eller manuelt
\item Fejl kan findes ved at prøve sig frem - fuzzing
\item Exploits virker typisk mod specifikke versioner af software
\end{list1}




\slide{Privilegier least privilege}

\begin{list1}
\item Hvorfor afvikle applikationer med administrationsrettigheder -
  hvis der kun skal læses fra eksempelvis en database?
\item {\bfseries least privilege} 
betyder at man afvikler kode med det mest
restriktive sæt af privileger - kun lige nok til at
opgaven kan udføres
\item Dette praktiseres ikke i webløsninger i Danmark - eller meget få steder
\end{list1}

\slide{Privilegier privilege escalation}
\begin{list1}
\item {\bfseries privilege escalation} er når man på en eller anden vis
opnår højere privileger på et system, eksempelvis som
følge af fejl i programmer der afvikles med højere
privilegier. Derfor HTTPD servere på UNIX afvikles som
nobody - ingen specielle rettigheder.
\item En angriber der kan afvikle vilkårlige kommandoer kan ofte finde
  en sårbarhed som kan udnyttes lokalt - få rettigheder = lille skade
\end{list1}



\slide{local vs. remote exploits}

\begin{list1} 
\item {\bfseries local vs. remote}
angiver om et exploit er rettet mod
en sårbarhed lokalt på maskinen, eksempelvis
opnå højere privilegier, eller beregnet
til at udnytter sårbarheder over netværk
\item {\bfseries remote root exploit} 
- den type man frygter mest, idet
det er et exploit program der når det afvikles giver
angriberen fuld kontrol, root user er administrator
på UNIX, over netværket. 
\item {\bfseries zero-day exploits} dem som ikke offentliggøres - dem
  som hackere holder for sig selv. Dag 0 henviser til at ingen kender
  til dem før de offentliggøres og ofte er der umiddelbart ingen
  rettelser til de sårbarheder
\end{list1}



\slide{Buffer overflows}

\hlkimage{3cm}{images/shellcoders-handbook.jpg}

\begin{list1}
\item Hvis man vil lære at lave buffer overflows og exploit programmer
  er følgende dokumenter et godt sted at starte
\item \emph{Smashing The Stack For Fun And Profit} Aleph One
\item Følgende bog kan ligeledes anbefales:
\emph{The Shellcoder's Handbook : Discovering and Exploiting Security Holes} 
af Jack Koziol, David Litchfield, Dave Aitel, Chris Anley, Sinan
"noir" Eren, Neel Mehta, Riley Hassell, John Wiley \& Sons, 2004 
\end{list1}



\slide{Stack protection}

\begin{list1}
\item Stack protection er mere almindeligt\\
- med i OpenBSD current fra 2. dec 2002

\item Buffer overflows er almindeligt kendte
\begin{list2}    
\item Selv OpenSSH har haft buffer overflows
\item Stack protection prøver at modvirke/fjerne
  muligheden for buffer overflows. arbitrary code execution
  bliver til ude af drift for berørte services
\end{list2}

\item Propolice\\
\link{http://www.openbsd.org}\\
\link{http://www.trl.ibm.com/projects/security/ssp/}

\item StackGuard\\
\link{http://www.immunix.org/stackguard.html}
\end{list1}

\slide{Gode operativsystemer}

\hlkimage{6cm}{MangaRamblo.jpg}

\begin{list1}
\item Nyere versioner af Microsoft Windows, Mac OS X og Linux distributionerne inkluderer:
\begin{list2}
\item Buffer overflow protection
\item Stack protection, non-executable stack
\item Heap protection, non-executable heap
\item \emph{Randomization of parameters} stack gap m.v.
\item ... og hackere forsøger hele tiden at omgå det.
\end{list2}
\item OpenBSD er nok nået længst og et godt eksempel\\ \link{http://www.openbsd.org/papers/}
\end{list1}


% session 3-4 automatiseret sårbarhedsscanning

\slide{Hackerværktøjer - frit tilgængelige}

\begin{list1}
\item Dan Farmer og Wietse Venema skrev i 1993 artiklen\\
\emph{Improving the Security of Your Site by Breaking Into it}
\item Senere i 1995 udgav de så en softwarepakke med navnet SATAN
\emph{Security Administrator Tool for Analyzing Networks}
 Pakken vagte
 en del furore, idet man jo gav alle på internet mulighed for at hacke
\begin{quote}
We realize that SATAN is a two-edged sword - like
many tools, it can be used for good and for evil
purposes. We also realize that intruders (including
wannabees) have much more capable (read intrusive)
tools than offered with SATAN. 
\end{quote}
\item SATAN og ideerne med automatiseret scanning efter sårbarheder
  blev siden ført videre i programmer som Saint, SARA og idag findes
  mange hackerværktøjer og automatiserede scannere: 
\begin{list2}
\item Nessus, ISS scanner, Fyodor Nmap, Typhoon, ORAscan
\end{list2}
\end{list1}
Kilde:
\link{http://www.porcupine.org/satan/demo/docs/admin_guide_to_cracking.html}



\slide{Brug hackerværktøjer!}

\begin{list1}
\item Hackerværktøjer - bruger I dem? - efter dette kursus gør I 
\item portscannere kan afsløre huller i forsvaret
\item webtestværktøjer som crawler igennem et website og finder alle
  forms kan hjælpe
\item I vil kunne finde mange potentielle problemer proaktivt ved
  regelmæssig brug af disse værktøjer - også potentielle driftsproblemer
\item husk dog penetrationstest er ikke en sølvkugle
\item honeypots kan måske være med til at afsløre angreb og
  kompromitterede systemer hurtigere
\end{list1}


\slide{The Exploit Database - dagens buffer overflow}

\hlkimage{20cm}{exploit-db.png}

\centerline{\link{http://www.exploit-db.com/}}


\slide{Heartbleed hacking}

\begin{alltt}\footnotesize
  06b0: 2D 63 61 63 68 65 0D 0A 43 61 63 68 65 2D 43 6F  -cache..Cache-Co
  06c0: 6E 74 72 6F 6C 3A 20 6E 6F 2D 63 61 63 68 65 0D  ntrol: no-cache.
  06d0: 0A 0D 0A 61 63 74 69 6F 6E 3D 67 63 5F 69 6E 73  ...action=gc_ins
  06e0: 65 72 74 5F 6F 72 64 65 72 26 62 69 6C 6C 6E 6F  ert_order&billno
  06f0: 3D 50 5A 4B 31 31 30 31 26 70 61 79 6D 65 6E 74  =PZK1101&payment
  0700: 5F 69 64 3D 31 26 63 61 72 64 5F 6E 75 6D 62 65  _id=1&{\bf card_numbe}
  0710: XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX  {\bf r=4060xxxx413xxx}
  0720: 39 36 26 63 61 72 64 5F 65 78 70 5F 6D 6F 6E 74  {\bf 96&card_exp_mont}
  0730: 68 3D 30 32 26 63 61 72 64 5F 65 78 70 5F 79 65  {\bf h=02&card_exp_ye}
  0740: 61 72 3D 31 37 26 63 61 72 64 5F 63 76 6E 3D 31  {\bf ar=17&card_cvn=1}
  0750: 30 39 F8 6C 1B E5 72 CA 61 4D 06 4E B3 54 BC DA  {\bf 09}.l..r.aM.N.T..
\end{alltt}

\begin{list2}
\item Obtained using Heartbleed proof of concepts - Gave full credit card details
\item "can XXX be exploited" - yes, clearly! PoCs ARE needed\\
without PoCs even Akamai wouldn't have repaired completely!
\item The internet was ALMOST fooled into thinking getting private keys\\
 from Heartbleed was not possible - scary indeed.
\end{list2}




\slide{Metasploit}

\hlkimage{20cm}{metasploit-about.png}

\begin{list1}
\item Idag findes der samlinger af exploits som exploit-db og Metasploit
\item Udviklingsværktøjerne til exploits er idag meget raffinerede!
\item \link{http://www.metasploit.com/}
\item \link{http://www.fastandeasyhacking.com/} Armitage GUI til Metasploit
\item \link{http://www.offensive-security.com/metasploit-unleashed/}
\end{list1}


\slide{Demo: Metasploit Armitage }

\hlkimage{16cm}{armitage-overview.png}

\slide{CTF}

\hlkimage{8cm}{DSCF3910s.jpg}

\begin{list1}
\item Næsten hvert år afholdes en dansk CTF konkurrence 
\item I år bliver det fredag den 28. november 2014 til lørdag
\item Capture the Flag er en mulighed for at afprøve sine hackerskillz
\item Distribueret CTF med hold  Sjovt og lærerigt 
\end{list1}
Kilde: \link{http://prosa-ctf.the-playground.dk/}

\centerline{Get ready! Lær debuggere, perl, java at kende, start på at hacke}



\slide{Opsummering }

\begin{list1}
\item Husk følgende:
\begin{list2}
\item Husk: IT-sikkerhed er ikke kun netværkssikkerhed!
\item God sikkerhed kommer fra langsigtede intiativer
\item Hvad er informationssikkerhed?
\item Data på elektronisk form
\item Data på fysisk form
\item Social engineering er måske overset - \emph{The Art of Deception: 
Controlling the Human Element of Security}
af Kevin D. Mitnick, William L. Simon, Steve Wozniak
\end{list2}
\item Computer Forensics er reaktion på en hændelse
\end{list1}
\vskip 1cm
\centerline{\color{titlecolor}\LARGE Informationssikkerhed er en proces}

\myquestionspage


\slide{CISSP fra ISC2}

\hlkimage{16cm}{images/cissp-logo.png}

\begin{list1}
\item Primære website: \link{http://www.isc2.org}
\item Vigtigt link \link{http://www.cccure.org/}
\item Den kræver mindst 3 års erfaring indenfor et relevant fagområde
\item Multiple choice 6 timer 250 spørgsmål - kan tages i Danmark
\end{list1}
\slide{Hacker - cracker}

{\bfseries Det korte svar - drop diskussionen}

%Det lidt længere svar:\\
Det havde oprindeligt en anden betydning, men medierne har taget
udtrykket til sig - og idag har det begge betydninger. 

{\color{red}\hlkbig Idag er en hacker stadig en der bryder ind i systemer!}

ref. Spafford, Cheswick, Garfinkel, Stoll, ...
- alle kendte navne indenfor sikkerhed

Hvis man vil vide mere kan man starte med:
\begin{list2}
\item \emph{Cuckoo's Egg: Tracking a Spy Through the Maze of Computer
 Espionage},  Clifford Stoll  
\item \emph{Hackers: Heroes of the Computer Revolution},
Steven Levy
\item \emph{Practical Unix and Internet Security},
Simson Garfinkel, Gene Spafford, Alan Schwartz 
\end{list2}


\slide{Definition af hacking, oprindeligt}

\begin{quote}
Eric Raymond, der vedligeholder en ordbog over computer-slang (The Jargon File) har blandt andet følgende forklaringer på ordet hacker:
\begin{list2}
\item En person, der nyder at undersøge detaljer i programmerbare systemer og hvordan man udvider deres anvendelsesmuligheder i modsætning til de fleste brugere, der bare lærer det mest nødvendige
\item En som programmerer lidenskabligt (eller enddog fanatisk) eller en der foretrækker at programmere fremfor at teoretiserer om det
\item En ekspert i et bestemt program eller en der ofter arbejder med eller på det; som i "en Unixhacker".
\end{list2}
\end{quote}

\begin{list1}
\item Kilde: Peter Makholm, \link{http://hacking.dk}
\item Benyttes stadig i visse sammenhænge se \link{http://labitat.dk}
\end{list1}




\end{document}
