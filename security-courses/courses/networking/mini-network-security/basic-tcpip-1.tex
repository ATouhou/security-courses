\slide{Dag 1 Basale begreber og Ethernet}

\hlkimage{22cm}{images/kursus-netvaerk.pdf}


\slide{Netværk til routning}

\hlkimage{27cm}{basic-ipv6-network.pdf}

\vskip 2cm


\slide{Internet idag}


\hlkimage{12cm}{images/server-client.pdf}

\begin{list1}
\item Klienter og servere
\item Rødder i akademiske miljøer
\item Protokoller der er op til 20 år gamle
\item Meget lidt kryptering, mest på http til brug ved e-handel 
\item Kurset omhandler udelukkende netværk baseret på IP protokollerne
\end{list1}


\slide{Hvad er Internet}

\begin{list1}
\item Kommunikation mellem mennesker!
\item Baseret på TCP/IP
\begin{list2}
\item best effort
\item packet switching (IPv6 kalder det packets, ikke datagram)
\item forbindelsesorienteret, \emph{connection-oriented}
\item forbindelsesløs, \emph{connection-less}
\end{list2}
\end{list1}

RFC-1958:
\begin{quote}
 A good analogy for the development of the Internet is that of
 constantly renewing the individual streets and buildings of a city,
 rather than razing the city and rebuilding it. The architectural
 principles therefore aim to provide a framework for creating
 cooperation and standards, as a small "spanning set" of rules that
 generates a large, varied and evolving space of technology.
\end{quote}



\slide{BSD Unix}

\hlkimage{4cm}{implementation_freebsd.jpg}

\begin{list1}
\item På Berkeley Universitetet blev der udviklet en del på Unix og
  det har givet anledning til en hel gren kaldet BSD Unix, BSD står for Berkeley Software Distribution
\item BSD Unix har blandt andet resulteret i virtual memory management
  og en masse TCP/IP relaterede applikationer
\item Specielt har BSD TCP/IP kernefunktionalitet været genbrugt mange steder 
\item Tilsvarende genbruges KAME IPv6 implementationen mange steder
\item \link{http://en.wikipedia.org/wiki/BSD}
\end{list1}

\slide{KAME - en IPv6 reference implementation}

\hlkimage{6cm}{kame-noanime-small.png}

%center
\centerline{\link{http://www.kame.net}}

\begin{list2}
\item Er idag at betragte som en reference implementation\\
- i stil med BSD fra Berkeley var det
\item KAME har været på forkant med implementation af draft dokumenter
\item KAME er inkluderet i OpenBSD, NetBSD, FreeBSD og BSD/OS
- har været det siden version 2.7, 1.5, 4.0 og 4.2

\item Projektet er afsluttet, men nye projekter fortsætter i
WIDE regi \link{http://www.wide.ad.jp/}
\item Der er udkommet to bøger som i detaljer gennemgår IPv6 protokollerne i KAME
\end{list2}


\slide{Hvad er Internet}

\begin{list1}
\item 80'erne IP/TCP starten af 80'erne
\item 90'erne IP version 6 udarbejdes
  \begin{list2}
  \item IPv6 ikke brugt i Europa og US
  \item IPv6 er ekstremt vigtigt i Asien 
  \item historisk få adresser tildelt til 3.verdenslande
  \item Større Universiteter i USA har ofte større allokering end Kina!
  \end{list2}
\item 1991 WWW "opfindes" af Tim Berners-Lee hos CERN
\item E-mail var hovedparten af traffik
  - siden overtog web/http førstepladsen
\end{list1}


% IP-adresser

\slide{Fælles adresserum}

\vskip 2 cm
\hlkimage{17cm}{IP-address.pdf}

\begin{list1}
\item Hvad kendetegner internet idag
\item Der er et fælles adresserum baseret på 32-bit adresser
\item En IP-adresse kunne være 10.0.0.1
\end{list1}

\slide{IPv4 addresser og skrivemåde}

\begin{alltt}
hlk@bigfoot:hlk$ ipconvert.pl 127.0.0.1
Adressen er: 127.0.0.1
Adressen er: 2130706433
hlk@bigfoot:hlk$ ping 2130706433
PING 2130706433 (127.0.0.1): 56 data bytes
64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.135 ms
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.144 ms
\end{alltt}

\begin{list1}
\item IP-adresser skrives typisk som decimaltal adskilt af punktum
\item Kaldes {\bf dot notation}: 10.1.2.3
\item Kan også skrive som oktal eller heksadecimale tal
\end{list1}



\slide{IP-adresser som bits}

\begin{alltt}
IP-adresse: 127.0.0.1
Heltal:	2130706433
Binary:	1111111000000000000000000000001
\end{alltt}

\begin{list1}
\item IP-adresser kan også konverteres til bits
\item Computeren regner binært, vi bruger dot-notationen
\end{list1}

\slide{Internet ABC}

\begin{list1}
\item Tidligere benyttede man klasseinddelingen af IP-adresser: A, B, C, D og E
\item Desværre var denne opdeling ufleksibel:
\begin{list2}
\item A-klasse kunne potentielt indeholde 16 millioner hosts
\item B-klasse kunne potentielt indeholder omkring 65.000 hosts
\item C-klasse kunne indeholde omkring 250 hosts
\end{list2}
\item Derfor bad de fleste om adresser i B-klasser - så de var ved at løbe tør!
\item D-klasse benyttes til multicast
\item E-klasse er blot reserveret
\item Se evt. \link{http://en.wikipedia.org/wiki/Classful_network}
\end{list1}


\slide{CIDR Classless Inter-Domain Routing}

\hlkimage{15cm}{CIDR-aggregation.pdf}

\begin{list1}
\item Subnetmasker var oprindeligt indforstået
\item Dernæst var det noget man brugte til at opdele sit A, B eller C net med
\item Ved at tildele flere C-klasser kunne man spare de resterende B-klasser - men det betød en routing table explosion
\item Idag er subnetmaske en sammenhængende række 1-bit der angiver størrelse på nettet
\item 10.0.0.0/24 betyder netværket 10.0.0.0 med subnetmaske 255.255.255.0
\item Nogle få steder kaldes det tillige supernet, supernetting
\end{list1}


\slide{Subnet calculator, CIDR calculator}

\hlkimage{10cm}{subnet-calculator.png}

\begin{list1}
\item Der findes et væld af programmer som kan hjælpe med at udregne
subnetmasker til IPv4
\item Screenshot fra \link{http://www.subnet-calculator.com/}
\end{list1}


\slide{RFC-1918 private netværk}

\begin{list1}
\item Der findes et antal adresserum som alle må benytte frit:
\begin{list2}
\item 10.0.0.0    -  10.255.255.255  (10/8 prefix)
\item 172.16.0.0  -  172.31.255.255  (172.16/12 prefix)
\item 192.168.0.0 -  192.168.255.255 (192.168/16 prefix)
\end{list2}
\item Address Allocation for Private Internets RFC-1918 adresserne!
\item NB: man må ikke sende pakker ud på internet med disse som afsender, giver ikke mening
\end{list1}

\slide{IPv4 addresser opsummering}

\begin{list2}
\item Altid 32-bit adresser
\item Skrives typisk med 4 decimaltal dot notation 10.1.2.3
\item Netværk angives med CIDR Classless Inter-Domain Routing RFC-1519
\item CIDR notation 10.0.0.0/8 -
  fremfor 10.0.0.0 med subnet maske 255.0.0.0
\item Specielle adresser\\
127.0.0.1 localhost/loopback\\
0.0.0.0  default route
\item RFC-1918 angiver private adresser som alle kan bruge

\end{list2}

\slide{IPv6 addresser og skrivemåde}

\hlkimage{20cm}{ipv6-address-1.pdf}

\begin{list2}
\item 128-bit adresser, subnet prefix næsten altid 64-bit
\item skrives i grupper af 4 hexcifre ad gangen adskilt af kolon :
\item foranstillede 0 i en gruppe kan udelades, en række 0 kan erstattes med ::
\item dvs 0:0:0:0:0:0:0:0 er det samme som \\
0000:0000:0000:0000:0000:0000:0000:0000
\item Dvs min webservers IPv6 adresse kan skrives som: 
2001:16d8:ff00:12f::2
\item Specielle adresser:
::1 localhost/loopback og
::  default route
\item Læs mere i RFC-3513
\end{list2}


\slide{Stop - netværket idag}

\begin{list1}
\item Bemærk hvilket netværk vi bruger idag
\item Primære server fiona har IP-adressen 10.0.45.36
\item Primære router luffe har IP-adressen 10.0.45.2 (og flere andre)
\item Sekundære router idag er Bianca som har IP-adressen 10.0.46.2 (og flere andre)  
\item Hvis du kender til IP i forvejen så udforsk gerne på egen hånd netværket
\item Det er tilladt at logge ind på alle systemer, undtagen Henrik's laptop bigfoot :-)
\item {\bf Det er forbudt at ændre IP-konfiguration og passwords}
\item Nu burde I kunne forbinde jer til netværket fysisk, check med \verb+ping 10.0.45.2+
\item Det er nok at en PC i hver gruppe er på kursusnetværket
\end{list1}

\centerline{Pause for dem hvor det virker, mens vi ordner resten}


\slide{OSI og Internet modellerne}

\hlkimage{14cm,angle=90}{images/compare-osi-ip.pdf}


\slide{Trådløse teknologier}

\hlkimage{10cm}{WCG200v2_med.jpg}

\begin{list1}
\item Et typisk 802.11 Access-Point (AP) der har Wireless og Ethernet stik/switch
\item Første dag bruger vi blot trådløse netværk, på dag 2 gennemgår vi 802.11
\end{list1}

\slide{Broer og routere}

\hlkimage{20cm}{wan-network.pdf}
\centerline{Fysisk er der en begrænsing for hvor lange ledningerne må være}

\slide{Bridges}

\begin{list1}
\item Ethernet er broadcast teknologi, hvor data sendes ud på et delt medie - Æteren
\item Broadcast giver en grænse for udbredningen vs hastighed
\item Ved hjælp af en bro kan man forbinde to netværkssegmenter på layer-2
\item Broen kopierer data mellem de to segmenter
\item Virker som en forstærker på signalet, men mere intelligent
\item Den intelligente bro kender MAC adresserne på hver side
\item Broen kopierer kun hvis afsender og modtager er på hver sin side
\end{list1}

Kilde: For mere information søg efter Aloha-net\\ \link{http://en.wikipedia.org/wiki/ALOHAnet}


\slide{En switch}

\hlkimage{15cm}{switch-1.pdf}

\begin{list1}
\item Ved at fortsætte udviklingen kunne man samle broer til en switch
\item En switch idag kan sende og modtage på flere porte samtidig, og med full-duplex
\item Bemærk performance begrænses af backplane i switchen
\end{list1}

\slide{Topologier og Spanning Tree Protocol}

\hlkimage{18cm}{switch-STP.pdf}

Se mere i bogen af Radia Perlman, \emph{Interconnections: Bridges, Routers, Switches, and Internetworking Protocols}


\slide{Core, Distribution og Access net}

\hlkimage{20cm}{core-dist.pdf}

\centerline{Det er ikke altid man har præcis denne opdeling, men den er ofte brugt}




\slide{Pakker i en datastrøm}

\hlkimage{23cm}{ethernet-frame-1.pdf}
\begin{list1}
\item Ser vi data som en datastrøm er pakkerne blot et mønster lagt henover data 
\item Netværksteknologien definerer start og slut på en frame
\item Fra et lavere niveau modtager vi en pakke, eksempelvis 1500-bytes fra Ethernet driver
\end{list1}


\slide{ARP cache}

\begin{alltt}
\small
hlk@bigfoot:hlk$ arp -an        
? (10.0.42.1) at 0:0:24:c8:b2:4c on en1 [ethernet]
? (10.0.42.2) at 0:c0:b7:6c:19:b on en1 [ethernet]
\end{alltt}

\begin{list1}
\item ARP cache kan vises med kommandoen \verb+arp -an+
\item -a viser alle
\item -n viser kun adresserne, prøver ikke at slå navne op - typisk hurtigere
\item ARP cache er dynamisk og adresser fjernes automatisk efter 5-20 minutter hvis de ikke bruges mere
\item Læs mere med \verb+man 4 arp+
\end{list1}




\slide{Proxy-arp}

\begin{list1}
\item Routere understøtter ofte Proxy ARP
\item Med Proxy ARP svarer de for en adresse bagved routeren
\item Derved kan man få trafik nemt igennem fra internet til adresser
\item Det er smart i visse situationer hvor en subnetting vil spilde for mange adresser
\item Hvis man kun har få adresser er subnetting måske heller ikke muligt
\item \link{http://en.wikipedia.org/wiki/Proxy_ARP}
\end{list1}

\slide{ARP vs NDP}

\begin{alltt}
\small
hlk@bigfoot:basic-ipv6-new$ arp -an        
? (10.0.42.1) at{\bf 0:0:24:c8:b2:4c} on en1 [ethernet]
? (10.0.42.2) at 0:c0:b7:6c:19:b on en1 [ethernet]
hlk@bigfoot:basic-ipv6-new$ ndp -an        
Neighbor                      Linklayer Address  Netif Expire    St Flgs Prbs
::1                           (incomplete)         lo0 permanent R      
2001:16d8:ffd2:cf0f:21c:b3ff:fec4:e1b6 0:1c:b3:c4:e1:b6 en1 permanent R      
fe80::1%lo0                   (incomplete)         lo0 permanent R      
fe80::200:24ff:fec8:b24c%en1 {\bf 0:0:24:c8:b2:4c}      en1 8h54m51s  S  R   
fe80::21c:b3ff:fec4:e1b6%en1  0:1c:b3:c4:e1:b6     en1 permanent R      
\end{alltt}


\slide{Fragmentering og PMTU}

\hlkimage{20cm}{fragments-1.pdf}
\begin{list1}
\item Hidtil har vi antaget at der blev brugt Ethernet med pakkestørrelse på 1500 bytes
\item Pakkestørrelsen kaldes MTU Maximum Transmission Unit 
\item Skal der sendes mere data opdeles i pakker af denne størrelse, fra afsender
\item Men hvad hvis en router på vejen ikke bruger 1500 bytes, men kun 1000
\end{list1}

\slide{ICMP Internet Control Message Protocol}

\begin{list1}
\item Kontrolprotokol og fejlmeldinger
\item Nogle af de mest almindelige beskedtyper
\begin{list2}
\item echo
\item netmask
\item info
\end{list2}
\item Bruges generelt til \emph{signalering}
\item Defineret i RFC-792
\end{list1}

\centerline{\bf NB: nogle firewall-administratorer blokerer alt ICMP - det er forkert!}

\slide{ICMP beskedtyper}

\begin{list1}
\item Type
\begin{list2}
\item 0 = net unreachable;
\item 1 = host unreachable;
\item 2 = protocol unreachable;
\item 3 = port unreachable;
\item 4 = fragmentation needed and DF set;
\item 5 = source route failed.
\end{list2}
\item Ved at fjerne ALT ICMP fra et net fjerner man nødvendig funktionalitet!
\item Tillad ICMP types:
\begin{list2}
\item 3 Destination Unreachable
\item 4 Source Quench Message
\item 11 Time Exceeded
\item 12 Parameter Problem Message
\end{list2}
\end{list1}

% basic ping og traceroute

\slide{Ping}

\begin{list1}
\item ICMP - Internet Control Message Protocol
\item Benyttes til fejlbeskeder og til diagnosticering af forbindelser
\item ping programmet virker ved hjælp af ICMP ECHO request og
  forventer ICMP ECHO reply
\item 
\begin{alltt}
\small {\bfseries 
$ ping 192.168.1.1}
PING 192.168.1.1 (192.168.1.1): 56 data bytes
64 bytes from 192.168.1.1: icmp_seq=0 ttl=150 time=8.849 ms
64 bytes from 192.168.1.1: icmp_seq=1 ttl=150 time=0.588 ms
64 bytes from 192.168.1.1: icmp_seq=2 ttl=150 time=0.553 ms
\end{alltt}
\end{list1}

\slide{Flere små forskelle}

\vskip 1cm 
\centerline{ping eller ping6}

\begin{list1}
\item Nogle systemer vælger at ping kommandoen kan ping'e både IPv4 og Ipv6
\item Andre vælger at \verb+ping+ kun benyttes til IPv4, mens IPv6 ping kaldes for \verb+ping6+
\item Læg også mærke til jargonen \emph{at pinge}
\end{list1}


\slide{traceroute}

\begin{list1}
  \item traceroute programmet virker ved hjælp af TTL
\item levetiden for en pakke tælles ned i hver router på vejen og ved at sætte denne lavt
  opnår man at pakken \emph{timer ud} - besked fra hver router på vejen
\item default er UDP pakker, men på Unix systemer er der ofte mulighed
  for at bruge ICMP
\item 
\begin{alltt}
\small{\bfseries 
$ traceroute 217.157.20.129}
traceroute to 217.157.20.129 (217.157.20.129),
30 hops max, 40 byte packets
 1  safri (10.0.0.11)  3.577 ms  0.565 ms  0.323 ms
 2  router (217.157.20.129)  1.481 ms  1.374 ms  1.261 ms
\end{alltt}
\end{list1}
\vskip 2cm
\centerline{Husk at på Windows hedder kommandoen tracert}





\slide{traceroute - med UDP}

\begin{alltt}
\tiny
# {\bfseries tcpdump -i en0 host 217.157.20.129 or host 10.0.0.11}
tcpdump: listening on en0
23:23:30.426342 10.0.0.200.33849 > router.33435: udp 12 [ttl 1]
23:23:30.426742 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.436069 10.0.0.200.33849 > router.33436: udp 12 [ttl 1]
23:23:30.436357 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.437117 10.0.0.200.33849 > router.33437: udp 12 [ttl 1]
23:23:30.437383 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.437574 10.0.0.200.33849 > router.33438: udp 12
23:23:30.438946 router > 10.0.0.200: icmp: router udp port 33438 unreachable
23:23:30.451319 10.0.0.200.33849 > router.33439: udp 12
23:23:30.452569 router > 10.0.0.200: icmp: router udp port 33439 unreachable
23:23:30.452813 10.0.0.200.33849 > router.33440: udp 12
23:23:30.454023 router > 10.0.0.200: icmp: router udp port 33440 unreachable
23:23:31.379102 10.0.0.200.49214 > safri.domain:  6646+ PTR? \\
200.0.0.10.in-addr.arpa. (41)
23:23:31.380410 safri.domain > 10.0.0.200.49214:  6646 NXDomain* 0/1/0 (93)
14 packets received by filter
0 packets dropped by kernel
\end{alltt}

\slide{Værdien af traceroute}

\begin{list1}
\item Diagnosticering af netværksproblemer - formålet med traceroute
\item Indblik i netværkets opbygning!
\item Svar fra hosts - en modtaget pakke fremfor et \emph{sort hul}

\item Traceroute er ikke et angreb - det er også vigtigt at kunne
  genkende normal trafik!
\end{list1}

\slide{Network mapping}

\hlkimage{23cm}{images/network-example.pdf}

\begin{list1}
\item Ved brug af traceroute og tilsvarende programmer kan man ofte
  udlede topologien i det netværk man undersøger  
\end{list1}


\slide{Flere traceprogrammer}

\begin{list1}
\item mtr My traceroute - grafisk \link{http://www.bitwizard.nl/mtr/}
\item lft - \emph{layer four trace} benytter TCP SYN og FIN prober
\item trace ved hjælp af TCP og andre protokoller findes
\item paratrace - \emph{Parasitic Traceroute via Established TCP Flows
    and IPID Hopcount} 
\item Der findes webservices hvor man kan trace fra, eksempelvis: \link{http://www.samspade.org}
\end{list1}


\slide{Stop - vi gennemgår og tester vores setup}

\begin{list1}
\item Vi gennemgår hvordan vores setup ser ud
\item Vi laver traceroute før og efter:
\item Vi fjerner en ledning \emph{link down}
\item Vi stopper en router og ser de annoncerede netværk forsvinder
\item Vi booter en router og ser de annoncerede netværk igen
\end{list1}

\slide{Stop - vi ser i fællesskab på admin interfaces}

\begin{list1}
\item Vi prøver lige at se på diverse interfaces sammen
\item hvis alle prøver samtidig bliver det lidt kaos :-)
\item Husk:
\begin{list2}
\item Linksys SRW-2008 switch
\item Linksys WRV-200 router, access-point og switch
\item Airport Extreme access-point
\item Juniper SSG5 firewall
\end{list2}
\end{list1}


\slide{Kommandolinien på Unix}

\begin{list1}
\item Shells kommandofortolkere:
  \begin{list2}
    \item sh - Bourne Shell
\item bash - Bourne Again Shell
\item ksh - Korn shell, lavet af David Korn
\item csh - C shell, syntaks der minder om C sproget
\item flere andre, zsh, tcsh 
  \end{list2}
\item Svarer til command.com og cmd.exe på Windows
\item Kan bruges som komplette programmeringssprog
\end{list1}

\slide{Kommandoprompten}


\begin{alltt}    
\small
[hlk@fischer hlk]$ id
uid=6000(hlk) gid=20(staff) groups=20(staff), 
0(wheel), 80(admin), 160(cvs) 
[hlk@fischer hlk]$ 

[root@fischer hlk]# id
uid=0(root) gid=0(wheel) groups=0(wheel), 1(daemon),
2(kmem), 3(sys), 4(tty), 5(operator), 20(staff), 
31(guest), 80(admin) 
[root@fischer hlk]#
\end{alltt}

\begin{list1}  
\item typisk viser et dollartegn at man er logget ind som almindelig bruge
\item mens en havelåge at man er root - superbruger
\end{list1}

\slide{Kommandoliniens opbygning}


\begin{alltt}
echo [-n] [string ...]  
\end{alltt}

\begin{list1}
\item Kommandoerne der skrives på kommandolinien skrives sådan:
\begin{list2}
\item Starter altid med kommandoen, man kan ikke skrive \verb+henrik echo+
\item Options skrives typisk med bindestreg foran, eksempelvis \verb+-n+
\item Flere options kan sættes sammen, \verb+tar -cvf+ eller \verb+tar cvf+
\item I manualsystemet kan man se valgfrie options i firkantede
  klammer \verb+[]+
\item Argumenterne til kommandoen skrives typisk til sidst (eller der
  bruges redirection)
\end{list2}
\end{list1}

\slide{Manualsystemet}

\begin{quote}
 It is a book about a Spanish guy called Manual. You should read it.
       -- Dilbert
\end{quote}

\begin{list1}
\item Manualsystemet i Unix er utroligt stærkt!
\item Det SKAL altid installeres sammen med værktøjerne!
\item Det er næsten identisk på diverse Unix varianter!  
\item \verb+man -k+ søger efter keyword, se også \verb+apropos+
\end{list1}

Prøv \verb+man crontab+ og \verb+man 5 crontab+

\hlkimage{10cm}{images/unix-command-1.pdf}

\slide{En manualside}

\begin{alltt}
\small
CAL(1)                BSD General Commands Manual                CAL(1)
NAME
     cal - displays a calendar
SYNOPSIS
     cal [-jy] [[month]  year]
DESCRIPTION
   cal displays a simple calendar.  If arguments are not specified, the cur-
   rent month is displayed.  The options are as follows:
   -j      Display julian dates (days one-based, numbered from January 1).
   -y      Display a calendar for the current year.

The Gregorian Reformation is assumed to have occurred in 1752 on the 3rd
of September.  By this time, most countries had recognized the reforma-
tion (although a few did not recognize it until the early 1900's.)  Ten
days following that date were eliminated by the reformation, so the cal-
endar for that month is a bit unusual.

HISTORY
     A cal command appeared in Version 6 AT&T Unix.  
\end{alltt}


\slide{Adgang til Unix}

\begin{center}
\includegraphics[width=4cm]{images/kde.png}
\includegraphics[width=4cm]{images/gnome-logo-large.png}
\end{center}

\begin{list1}
%\item Systemer der minder om Unix kan idag nemt skaffes
\item Adgang til Unix kan ske via grafiske brugergrænseflader
  \begin{list2}
%  \item X11 \link{http://www.x.org}
  \item KDE \link{http://www.kde.org}
  \item GNOME \link{http://www.gnome.org}
  \end{list2}
\item eller kommandolinien
\end{list1}
\centerline{\includegraphics[width=17cm]{images/unix-cmdline.pdf}}


\exercise{ex:putty-install}



\exercise{ex:winscp-install}

\exercise{ex:unix-login}

\exercise{ex:unix-cal}

\exercise{ex:sudo}



\exercise{ex:unix-boot-cd}

\slide{TCP/IP basiskonfiguration}

\begin{alltt}
ifconfig en0 10.0.42.1 netmask 255.255.255.0
route add default gw 10.0.42.1 
\end{alltt}

\begin{list1}
\item konfiguration af interfaces og netværk på Unix foregår med:
\item \verb+ifconfig+, \verb+route+ og \verb+netstat+  
\item - ofte pakket ind i konfigurationsmenuer m.v.
\item fejlsøgning foregår typisk med \verb+ping+ og \verb+traceroute+
\item På Microsoft Windows benyttes ikke \verb+ifconfig+\\
men kommandoerne \verb+ipconfig+ og \verb+ipv6+
\end{list1}





\slide{OpenBSD}

Netværkskonfiguration på OpenBSD:
\begin{alltt}
# cat /etc/hostname.sk0
inet 10.0.0.23 0xffffff00 NONE
# cat /etc/mygate
10.0.0.1
# cat /etc/resolv.conf    
domain security6.net
lookup file bind
nameserver 212.242.40.3
nameserver 212.242.40.51
\end{alltt}


\slide{GUI værktøjer - autoconfiguration}

\hlkimage{20cm}{osx-network-automatic.png}

\slide{GUI værktøjer - manuel konfiguration}

\hlkimage{20cm}{osx-network-manual.png}

\slide{ifconfig output}

\begin{alltt}\small
hlk@bigfoot:hlk$ ifconfig -a
lo0: flags=8049<UP,LOOPBACK,RUNNING,MULTICAST> mtu 16384
        inet 127.0.0.1 netmask 0xff000000 
        inet6 ::1 prefixlen 128 
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 
gif0: flags=8010<POINTOPOINT,MULTICAST> mtu 1280
stf0: flags=0<> mtu 1280
en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500
        ether 00:0a:95:db:c8:b0 
        media: autoselect (none) status: inactive
        supported media: none autoselect 10baseT/UTP <half-duplex> 10baseT/UTP <full-duplex> 10baseT/UTP <full-duplex,hw-loopback> 100baseTX <half-duplex> 100baseTX <full-duplex> 100baseTX <full-duplex,hw-loopback> 1000baseT <full-duplex> 1000baseT <full-duplex,hw-loopback> 1000baseT <full-duplex,flow-control> 1000baseT <full-duplex,flow-control,hw-loopback>
en1: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500
        ether 00:0d:93:86:7c:3f 
        media: autoselect (<unknown type>) status: inactive
        supported media: autoselect
\end{alltt}
%$
\vskip 1 cm
\centerline{ifconfig output er næsten ens på tværs af Unix}




\slide{Vigtigste protokoller}


\begin{list1}
\item ARP Address Resolution Protocol
\item IP og ICMP Internet Control Message Protocol
\item UDP User Datagram Protocol
\item TCP Transmission Control Protocol
\item DHCP Dynamic Host Configuration Protocol 
\item DNS Domain Name System
\end{list1}
\vskip 1cm
\centerline{Ovenstående er omtrent minimumskrav for at komme på internet}

% allerede gennemgået ovenfor
%\slide{ICMP}

%\begin{list1}
%\item 	Internet Control Message Protocol 
%	Defineret i RFC-792

%\end{list1}


\slide{UDP User Datagram Protocol}
\hlkimage{20cm}{udp-1.pdf}
\begin{list1}
\item Forbindelsesløs RFC-768, \emph{connection-less} - der kan tabes pakker
\item Kan benyttes til multicast/broadcast - flere modtagere
\end{list1}



\slide{TCP Transmission Control Protocol}
\hlkimage{20cm}{tcp-1.pdf}

\begin{list1}
\item Forbindelsesorienteret RFC-791 September 1981, \emph{connection-oriented}
\item Enten overføres data eller man får fejlmeddelelse
\end{list1}




\slide{TCP three way handshake}

\hlkimage{7cm}{images/tcp-three-way.pdf}

\begin{list2}
\item {\bfseries TCP SYN half-open} scans
\item Tidligere loggede systemer kun når der var etableret en fuld TCP
  forbindelse - dette kan/kunne udnyttes til \emph{stealth}-scans
\item Hvis en maskine modtager mange SYN pakker kan dette fylde
  tabellen over connections op - og derved afholde nye forbindelser
  fra at blive oprette - {\bfseries SYN-flooding}
\end{list2}

\slide{Well-known port numbers}

\hlkimage{10cm}{iana1.jpg}

\begin{list1}
\item IANA vedligeholder en liste over magiske konstanter i IP
\item De har lister med hvilke protokoller har hvilke protokol ID m.v.
\item En liste af interesse er port numre, hvor et par eksempler er:
\begin{list2}
\item Port 25 SMTP Simple Mail Transfer Protocol
\item Port 53 DNS Domain Name System
\item Port 80 HTTP Hyper Text Transfer Protocol over TLS/SSL
\item Port 443 HTTP over TLS/SSL
\end{list2}
\item Se flere på \link{http://www.iana.org}
\end{list1}

\slide{Hierarkisk routing}

\hlkimage{18cm}{routing-1.pdf}
Hvordan kommer pakkerne frem til modtageren

\slide{IP default gateway}

\hlkimage{13cm}{routing-2.pdf}

\begin{list1}
\item IP routing er nemt
\item En host kender en default gateway i nærheden
\item En router har en eller flere upstream routere, få adresser den sender videre til
\item Core internet har default free zone, kender \emph{alle netværk} 
\end{list1}



\slide{DHCP Dynamic Host Configuration Protocol}

\hlkimage{13cm}{dhcp-1.pdf}

\begin{list1}
\item Hvordan får man information om default gateway
\item Man sender et DHCP request og modtager et svar fra en DHCP server
\item Dynamisk konfiguration af klienter fra en centralt konfigureret server
\item Bruges til IP adresser og meget mere
\end{list1}

\slide{IPv6 router advertisement daemon}

\begin{alltt}
/etc/rtadvd.conf:
en0:
      :addrs#1:addr="2001:1448:81:b00f::":prefixlen#64:
en1:
      :addrs#1:addr="2001:1448:81:beef::":prefixlen#64:

root# /usr/sbin/rtadvd -Df en0 en1
root# sysctl -w net.inet6.ip6.forwarding=1
net.inet6.ip6.forwarding: 0 -> 1
\end{alltt}

\begin{list1}
\item Stateless autoconfiguration er en stor ting i IPv6
\item Kommandoen starter den i debug-mode og i forgrunden\\
- normalt vil man starte den fra et script 
\item Typisk skal forwarding aktiveres, som vist med BSD sysctl kommando
\end{list1}



\slide{Routing}


\begin{list1}
  \item routing table - tabel over netværkskort og tilhørende adresser
\item default gateway - den adresse hvortil man sender
  \emph{non-local} pakker\\kaldes også default route, gateway of last
  resort
\item routing styres enten manuelt - opdatering af route tabellen,
  eller konfiguration af adresser og subnet maske på netkort
\item eller automatisk ved brug af routing protocols - interne og
  eksterne route protokoller
\item de lidt ældre routing protokoller har ingen sikkerhedsmekanismer
\item {\bf IP benytter longest match i routing tabeller!}
\item Den mest specifikke route gælder for forward af en pakke!
\end{list1}


\slide{Routing forståelse}

\begin{alltt}
\small
$ netstat -rn
Routing tables

Internet:
Destination    Gateway         Flags  Refs      Use  Netif 
default        10.0.0.1        UGSc    23        7    en0
10/24          link#4          UCS      1        0    en0
10.0.0.1       0:0:24:c1:58:ac UHLW    24       18    en0  
10.0.0.33      127.0.0.1       UHS      0        1    lo0
10.0.0.63      127.0.0.1       UHS      0        0    lo0
127            127.0.0.1       UCS      0        0    lo0
127.0.0.1      127.0.0.1       UH       4     7581    lo0
169.254        link#4          UCS      0        0    en0  
\end{alltt}

\vskip 1 cm
\centerline{Start med kun at se på Destination, Gateway og Netinterface}


\exercise{ex:network-ifconfig}
\exercise{ex:network-netstat}

\exercise{ex:ping}
\exercise{ex:ping6}


\slide{TCPDUMP - protokolanalyse pakkesniffer}

\hlkimage{14cm}{images/tcpdump-manual.pdf}


\centerline{\link{http://www.tcpdump.org}
- både til Windows og Unix}
\slide{tcpdump - normal brug}

\begin{list2}
  \item tekstmode
\item kan gemme netværkspakker i filer
\item kan læse netværkspakker fra filer
\item er de-facto standarden for at gemme netværksdata i filer
\end{list2}

\begin{alltt}
\tiny [root@otto hlk]# tcpdump -i en0
tcpdump: listening on en0
13:29:39.947037 fe80::210:a7ff:fe0b:8a5c > ff02::1: icmp6: router advertisement
13:29:40.442920 10.0.0.200.49165 > dns1.cybercity.dk.domain:  1189+[|domain]
13:29:40.487150 dns1.cybercity.dk.domain > 10.0.0.200.49165:  1189 NXDomain*[|domain]
13:29:40.514494 10.0.0.200.49165 > dns1.cybercity.dk.domain:  24765+[|domain]
13:29:40.563788 dns1.cybercity.dk.domain > 10.0.0.200.49165:  24765 NXDomain*[|domain]
13:29:40.602892 10.0.0.200.49165 > dns1.cybercity.dk.domain:  36485+[|domain]
13:29:40.648288 dns1.cybercity.dk.domain > 10.0.0.200.49165:  36485 NXDomain*[|domain]
13:29:40.650596 10.0.0.200.49165 > dns1.cybercity.dk.domain:  4101+[|domain]
13:29:40.694868 dns1.cybercity.dk.domain > 10.0.0.200.49165:  4101 NXDomain*[|domain]
13:29:40.805160 10.0.0.200 > mail: icmp: echo request
13:29:40.805670 mail > 10.0.0.200: icmp: echo reply
...
\end{alltt}

\slide{TCPDUMP syntaks - udtryk}

\begin{list1}
\item filtre til husbehov
  \begin{list2}
\item type - host, net og port
\item src pakker med afsender IP eller afsender port
\item dst pakker med modtager IP eller modtager port
\item host - afsender eller modtager 
\item proto - protokol: ether, fddi, tr, ip, ip6, arp,  rarp,  decnet,
tcp og udp
\end{list2}
\item IP adresser kan angives som dotted-decimal eller navne
\item porte kan angives med numre eller navne
\item komplekse udtryk opbygges med logisk and,  or,  not
\end{list1}

\slide{tcpdump udtryk eksempler}

\begin{list1}
  \item Host 10.1.2.3\\
Alle pakker hvor afsender eller modtager er 10.1.2.3
\item host 10.2.3.4 and not host 10.3.4.5\\
Alle pakker til/fra 10.2.3.4 undtagen dem til/fra 10.3.4.5\\
- meget praktisk hvis man er logget ind på 10.2.3.4 via netværk fra 10.3.4.5
\item host foo and not port ftp  and not  port  ftp-data\\
trafik til/fra maskine \emph{foo} undtagen hvis det er FTP trafik
\end{list1}

\slide{Wireshark - grafisk pakkesniffer}

\hlkimage{20cm}{images/wireshark-website.png} 

\centerline{\link{http://www.wireshark.org}}
\centerline{både til Windows og Unix, tidligere kendt som Ethereal}



\slide{Brug af Wireshark}

\hlkimage{13cm}{images/ethereal-capture-options.png}

\centerline{Man starter med Capture - Options}

\slide{Brug af Wireshark}

\hlkimage{24cm}{images/ethereal-main-window.png}

\centerline{Læg mærke til filtermulighederne}

\exercise{ex:wireshark}

\slide{dsniff}

\begin{list1}
\item en sniffer til mange usikre protokoller
\item inkluderer {\bfseries arpspoof}  
\item Lavet af Dug Song, dugsong@monkey.org
\end{list1}

\begin{alltt}
dsniff  is  a  password sniffer which handles FTP, Telnet,
SMTP, HTTP, POP, poppass, NNTP, IMAP, SNMP, LDAP,  Rlogin,
RIP,  OSPF,  PPTP  MS-CHAP, NFS, VRRP, YP/NIS, SOCKS, X11,
CVS, IRC, AIM, ICQ, Napster,  PostgreSQL,  Meeting  Maker,
Citrix  ICA,  Symantec  pcAnywhere, NAI Sniffer, Microsoft
SMB, Oracle SQL*Net, Sybase and Microsoft SQL protocols.
\end{alltt}

\slide{Kommenteret dsniff}

\hlkimage{22cm}{images/dsniff-comments.pdf}

\slide{Chaosreader}

\hlkimage{10cm}{chaosreader1.jpg}
\hlkimage{20cm}{chaosreader2.png}
\begin{list1}
\item Med adgang til et netværksdump kan man læse det med chaosreader
\item Output er HTML med oversigter over sessioner, billeder fra datastrømmen osv.
\item \link{http://chaosreader.sourceforge.net/}

\end{list1}


% SSL her

\slide{Kryptering i praksis}

\begin{list1}
\item Kryptering af e-mail
\begin{list2}
\item Pretty Good Privacy - Phil Zimmermann
\item GNU Privacy Guard - Open Source implementation af OpenPGP
\item OpenPGP = mail sikkerhed, OpenPGP RFC-2440, PGP/MIME RFC 3156)
\end{list2}
\item Kryptering af sessioner SSL/TLS
\begin{list2}
\item Secure Sockets Layer SSL / Transport Layer Services TLS
\item krypterer data der sendes mellem webservere og klienter
\item SSL kan bruges generelt til mange typer sessioner, eksempelvis
  POP3S, IMAPS, SSH m.fl.
\end{list2}
\item Kryptering af netværkstrafik - Virtual Private Networks VPN
\begin{list2}
\item {\color{green}IPsec IP Security Framework, se også L2TP}
\item {\color{red} PPTP Point to Point Tunneling Protocol - dårlig og usikker, brug den ikke mere!}
\item OpenVPN m.fl.
\end{list2}
\end{list1}


\slide{SSL og TLS}

\hlkimage{18cm}{ehandel-https.pdf}

\begin{list1}
\item Oprindeligt udviklet af Netscape Communications Inc.
\item Secure Sockets Layer SSL er idag blevet adopteret af IETF og kaldes
derfor også for Transport Layer Security TLS
TLS er baseret på SSL Version 3.0
\item RFC-2246 The TLS Protocol Version 1.0 fra Januar 1999
\end{list1}

\slide{SSL/TLS udgaver af protokoller}
\hlkimage{16cm}{imap-ssl.png}

\begin{list1}
\item Mange protokoller findes i udgaver hvor der benyttes SSL
\item HTTPS vs HTTP
\item IMAPS, POP3S, osv.
\item Bemærk: nogle protokoller benytter to porte IMAP 143/tcp vs IMAPS 993/tcp
\item Andre benytter den samme port men en kommando som starter:
\item SMTP STARTTLS RFC-3207
\end{list1}

\slide{Secure Shell - SSH og SCP}

%\begin{center}
%\colorbox{white}{\includegraphics[width=12cm]{images/tshirt-9b.jpg}}  
%\end{center}

\hlkimage{16cm}{images/openssh-banner.png}

\begin{list1}
\item Hvad er Secure Shell SSH?  
\item Oprindeligt udviklet af Tatu Ylönen i Finland,\\
se \link{http://www.ssh.com}
\item SSH afløser en række protokoller som er usikre:
  \begin{list2}
  \item Telnet til terminal adgang
  \item r* programmerne, rsh, rcp, rlogin, ...
  \item FTP med brugerid/password
  \end{list2}
\end{list1}


\slide{SSH - de nye kommandoer er}
\begin{list1}
\item kommandoerne er:
\begin{list2}
  \item ssh - Secure Shell
  \item scp - Secure Copy
  \item sftp - secure FTP 
  \end{list2}
\item Husk: SSH er både navnet på protokollerne - version 1 og 2 samt
  programmet \verb+ssh+ til at logge ind på andre systemer
\item SSH tillader også port-forward, tunnel til usikre protokoller,
  eksempelvis X protokollen til Unix grafiske vinduer
\item {\bfseries NB: Man bør idag bruge SSH protokol version 2!}
\end{list1}

%VLAN


% 802.1q
\slide{VLAN Virtual LAN}

\hlkimage{10cm}{vlan-portbased.pdf}

\begin{list1}
\item Nogle switche tillader at man opdeler portene
\item Denne opdeling kaldes VLAN og portbaseret er det mest simple
\item Port 1-4 er et LAN
\item De resterende er et andet LAN
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\end{list1}

\slide{IEEE 802.1q}

\hlkimage{19cm}{vlan-8021q.pdf}

\begin{list1}
\item Nogle switche tillader konfiguration med 802.1q VLAN tagging på Ethernet niveau
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\item VLAN trunking giver mulighed for at dele VLANs ud på flere switches
\item Der findes administrationsværktøjer der letter dette arbejde: OpenNAC FreeNAC, Cisco VMPS
\end{list1}

\exercise{ex:vlan}

%DNS
\slide{Domain Name System}

\hlkimage{12cm}{dns-1.pdf}

\begin{list1}
\item Gennem DHCP får man typisk også information om DNS servere
\item En DNS server kan slå navne, domæner og adresser op
\item Foregår via query og response med datatyper kaldet resource records
\item DNS er en distribueret database, så opslag kan resultere i flere opslag
\end{list1}

\slide{Mere end navneopslag}

\begin{list1}
  \item består af resource records med en type:
    \begin{list2}
\item adresser A-records
\item IPv6 adresser AAAA-records
\item autoritative navneservere NS-records
\item post, mail-exchanger MX-records
\item flere andre: md ,  mf ,  cname ,  soa ,
                  mb , mg ,  mr ,  null ,  wks ,  ptr ,
                  hinfo ,  minfo ,  mx ....
\end{list2}
\end{list1}
\begin{alltt}
ns1     IN      A       217.157.20.130
        IN      AAAA    2001:618:433::1
www     IN      A       217.157.20.131
        IN      AAAA    2001:618:433::14
        IN      MX      10      mail.security6.net.
        IN      MX      20      mail2.security6.net.
\end{alltt}

\slide{Basal DNS opsætning på klienter}

\begin{list1}    
\item \verb+/etc/resolv.conf+
\item NB: denne fil kan hedde noget andet på Unix varianter!
\item eksempelvis \verb+/etc/netsvc.conf+
\item typisk indhold er domænenavn og IP-adresser for navneservere
\end{list1}

\begin{alltt}
domain security6.net
nameserver 212.242.40.3
nameserver 212.242.40.51
\end{alltt}

\slide{BIND DNS server}

\begin{list1}
\item Berkeley Internet Name Daemon server
\item Mange bruger BIND fra Internet Systems Consortium
   - altså Open Source
\item konfigureres gennem \verb+named.conf+
\item det anbefales at bruge BIND version 9
\end{list1}

\begin{list2}
\item \emph{DNS and BIND}, Paul Albitz \& Cricket Liu, O'Reilly, 4th
  edition Maj 2001 
\item \emph{DNS and BIND cookbook}, Cricket Liu, O'Reilly, 4th
  edition Oktober 2002 
\end{list2}

Kilde: \link{http://www.isc.org}

\slide{BIND konfiguration - et udgangspunkt}

\begin{alltt}
\small 
acl internals \{ 127.0.0.1; ::1; 10.0.0.0/24; \};
options \{
        // the random device depends on the OS !
        random-device "/dev/random"; directory "/namedb";
        {\bf listen-on-v6 { any; };}
        port 53; version "Dont know"; allow-query \{ any; \};
\};
view "internal" \{
   match-clients \{ internals; \}; recursion yes;
   zone "." \{
       type hint;   file "root.cache"; \};
   // localhost forward lookup
   zone "localhost." \{
        type master; file "internal/db.localhost";   \};
   // localhost reverse lookup from IPv4 address
   zone "0.0.127.in-addr.arpa" \{
        type master; file "internal/db.127.0.0"; notify no;   \};
...
\}
\end{alltt}


\exercise{ex:basic-dns-lookup}
\exercise{ex:basic-dns-lookup6}




\slide{Navngivning af servere}

\begin{list1}
  \item Hvordan skal vi kunne huske og administrere servere?
\item Det er ikke nemt at navngive hverken brugere eller servere!
\item Selvom det lyder smart med A01S13, som forkortelse af Afdeling
  01's Server nr 13, er det umuligt at huske
\item ... men måske nødvendigt i de største netværk
  \begin{list2}
  
\item Windows serveren er domænecontroller - skal hedde:
\item Linux server som er terminalserver - skal hedde:
\item PC-system med NetBSD skal måske være vores ene server - skal hedde: ?
\item PC-system 1 med en Linux server - skal hedde: 
\item PC-system 2 med en Linux server - skal hedde:
  \end{list2}
\end{list1}

\slide{At være på internet}

\begin{list1}
\item RFC-2142 Mailbox Names for Common Services, Roles and Functions
\item Du BØR konfigurere dit domæne til at modtage post for følgende adresser:
\begin{list2}
\item postmaster@domæne.dk
\item abuse@domæne.dk
\item webmaster@domæne.dk, evt. www@domæne.dk
\end{list2}
\item Du gør det nemmere at rapportere problemer med dit netværk og services
\end{list1}

\slide{E-mail best current practice}

\begin{alltt}\small
MAILBOX       AREA                USAGE
-----------   ----------------    ---------------------------
ABUSE         Customer Relations  Inappropriate public behaviour
NOC           Network Operations  Network infrastructure
SECURITY      Network Security    Security bulletins or queries  
...
MAILBOX       SERVICE             SPECIFICATIONS
-----------   ----------------    ---------------------------
POSTMASTER    SMTP                [RFC821], [RFC822]
HOSTMASTER    DNS                 [RFC1033-RFC1035]
USENET        NNTP                [RFC977]
NEWS          NNTP                Synonym for USENET
WEBMASTER     HTTP                [RFC 2068]
WWW           HTTP                Synonym for WEBMASTER
UUCP          UUCP                [RFC976]
FTP           FTP                 [RFC959]
\end{alltt}

Kilde: 
RFC-2142 Mailbox Names for Common Services, Roles and Functions. D.
Crocker. May 1997

\slide{whois systemet}

\begin{list1}
\item IP adresserne administreres i dagligdagen af et antal Internet
  registries, hvor de største er:
\begin{list2}
\item RIPE (Réseaux IP Européens)  \link{http://ripe.net}
\item ARIN American Registry for Internet Numbers \link{http://www.arin.net}
\item Asia Pacific Network Information Center \link{http://www.apnic.net}
\item LACNIC (Regional Latin-American and Caribbean IP Address Registry) - Latin America and some Caribbean Islands
\end{list2}
\item disse fire kaldes for Regional Internet Registries (RIRs) i
  modsætning til Local Internet Registries (LIRs) og National Internet
  Registry (NIR) 
\end{list1}



\slide{NTP Network Time Protocol}

\begin{list1}
\item NTP opsætning
\item foregår typisk i \verb+/etc/ntp.conf+ eller \verb+/etc/ntpd.conf+   
\item det vigtigste er navnet på den server man vil bruge som tidskilde
\item Brug enten en NTP server hos din udbyder eller en fra \link{http://www.pool.ntp.org/}
\item Eksempelvis:
\end{list1}

\begin{alltt}
server ntp.cybercity.dk

server 0.dk.pool.ntp.org
server 0.europe.pool.ntp.org
server 3.europe.pool.ntp.org

\end{alltt}

\slide{What time is it?}

\hlkimage{8cm}{images/xclock.pdf}

\begin{list1}
\item Hvad er klokken?
\item Hvad betydning har det for sikkerheden?
\item Brug NTP Network Time Protocol på produktionssystemer
\end{list1}


\slide{What time is it? - spørg ICMP}

\vskip 1 cm

\begin{list1}
  \item ICMP timestamp option - request/reply
\item hvad er klokken på en server
\item Slayer icmpush - er installeret på server
\item viser tidstempel
\end{list1}

\begin{alltt}
# {\bfseries icmpush -v -tstamp 10.0.0.12}
ICMP Timestamp Request packet sent to 10.0.0.12 (10.0.0.12)

Receiving ICMP replies ...
fischer         -> 21:27:17
icmpush: Program finished OK
\end{alltt}

\slide{Stop - NTP Konfigurationseksempler}

\hlkimage{12cm}{osx-ntp.png}

\begin{list1}
\item Vi har en masse udstyr, de meste kan NTP, men hvordan
\item Vi gennemgår, eller I undersøger selv:
\begin{list2}
\item Airport
\item Switche (managed)
\item Mac OS X
\item OpenBSD - check \verb+man rdate+ og \verb+man ntpd+
\end{list2}
\end{list1}


\exercise{ex:whois}

\exercise{ex:icmpush}




% iperf her!
\slide{IP netværkstuning}

\hlkimage{8cm}{712a.png}

\begin{list1}
\item IP har eksisteret mange år
\item Vi har udskiftet langsommme forbindelser med hurtige forbindelser
\item Vi har udskiftet langsomme MHz maskiner med Quad-core GHz maskiner
\item IP var tidligere meget konservativt, for ikke at overbelaste modtageren
\item Billedet er en HP arbejdsstation med 19" skærm og en 60MHz HP PA-RISC processor
\end{list1}

\slide{Anbefalet netværkstuning - hvad skal tunes}

\begin{list1}
\item Der er visse indstillinger som tidligere var standard, de bør idag slås fra
\item En del er allerede tunet i nyere versioner af IP-stakkene, men check lige
\item Ideer til ting som skal slås fra:
\begin{list2}
\item broadcast ICMP, undgå smurfing
\item Source routing, kan måske omgå firewalls og filtre    
\end{list2}
\item Ideer til ting som skal slås til/ændres:
\begin{list2}
\item Bufferstørrelser - hvorfor have en buffer på 65535 bytes på en maskine med 32GB ram?
\item Nye funktioner som RFC-1323 TCP Extensions for High Performance
\end{list2}
\item Det anbefales at finde leverandørens vejledning til hvad der kan tunes
\end{list1}

\slide{Netværkskonfiguration med sysctl}

\begin{alltt}\small
	# tuning
	net.inet.tcp.recvspace=65535
	net.inet.tcp.sendspace=65535
	net.inet.udp.recvspace=65535
	net.inet.udp.sendspace=32768
	# postgresql tuning
	kern.seminfo.semmni=256
	kern.seminfo.semmns=2048
	kern.shminfo.shmmax=50331648\end{alltt}
\begin{list1}
\item På mange Unix varianter findes et specielt tuningsprogram,
  sysctl
\item Findes blandt andet på alle BSD'erne: FreeBSD, OpenBSD, NetBSD
  og Darwin/OSX 
\item Ændringerne skrives ind i filen \verb+/etc/sysctl.conf+
\item På Linux erstatter det til dels konfiguration med echo \\
\verb+echo 1 > /proc/net/ip/forwarding+   
\item På AIX benyttes kommandoen network options \verb+no+ 
\end{list1}

\slide{Tuning}

\begin{list1}
\item Hvad er flaskehalsen for programmet?
\item I/O bundet - en enkelt disk eller flere
\item CPU bundet - regnekraften
\item Netværket - 10Mbit half-duplex adapter
\item Memory - begynder systemet at \emph{swappe} eller \emph{thrashe}
\item brug top og andre statistikprogrammer til at se disse data
\end{list1}


\slide{Måling af througput}

\begin{list1}
\item Når der skal tunes er det altid nødvendigt med en baseline
\item Man kan ikke begynde at tune ud fra subjektive målinger 
\item \emph{Det kører langsomt}, \emph{Svartiden er for høj}
\item Målinger der giver præcise tal er nødvendige, før og efter målinger!
\item Der findes et antal værktøjer til, blandt andet Iperf
\end{list1}

\slide{Målinger med Iperf}

\begin{alltt}\small
hlk@fluffy:hlk$ iperf -s
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 64.0 KByte (default)
------------------------------------------------------------
[  4] local 10.0.42.23 port 5001 connected with 10.0.42.67 port 51148
[  4]  0.0-10.2 sec  6.95 MBytes  5.71 Mbits/sec
[  4] local 10.0.42.23 port 5001 connected with 10.0.42.67 port 51149
[  4]  0.0-10.2 sec  7.02 MBytes  5.76 Mbits/sec
\end{alltt}

Ovenstående er set fra server, client kaldes med \verb+iperf -c fluffy+

\slide{Stop - vi prøver i fællesskab Iperf}

\begin{list1}
\item Vi prøver lige Iperf sammen
\item hvis alle prøver samtidig giver det stor variation i resultaterne
\end{list1}



\slide{Antal pakker per sekund} 

\begin{list1}
\item Til tider er det ikke båndbredden som sådan man vil måle
\item Specielt for routere er det vigtigt at de kan behandle mange pakker per sekund, pps
\item Til dette kan man lege med det indbyggede Ping program i flooding mode
\item Når programmet kaldes (som systemadministrator) med \verb+ping -f server+ vil den sende ping pakker så hurtigt som netkortet tillader
\item Programmer der kan teste pakker per sekund kaldes generelt for blaster tools
\end{list1}



\slide{Apache benchmark og andre programmer}

\begin{alltt}
\footnotesize
hlk@bigfoot:hlk$ ab -n 100 http://www.kramse.dk/
This is ApacheBench, Version 2.0.41-dev <$Revision: 1.121.2.12 $> apache-2.0
Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Copyright (c) 2006 The Apache Software Foundation, http://www.apache.org/

Benchmarking www.kramse.dk (be patient)...
...
\end{alltt}

\begin{list1}
\item Der findes specialiserede værktøjer til mange protokoller
\item Eksempelvis følger der et apache benchmark med Apache HTTPD serveren
\item Mange andre værktøjer til at simulere flere samtidige brugere
\end{list1}

\slide{Apache Benchmark output - 1 }

\begin{alltt}
\footnotesize
Server Software:        Apache
Server Hostname:        www.kramse.dk
Server Port:            80

Document Path:          /
Document Length:        7547 bytes

Concurrency Level:      1
Time taken for tests:   13.84924 seconds
Complete requests:      100
Failed requests:        0
Write errors:           0
Total transferred:      778900 bytes
HTML transferred:       754700 bytes
Requests per second:    7.64 #/sec (mean)
Time per request:       130.849 ms (mean)
Time per request:       130.849 ms (mean, across all concurrent requests)
Transfer rate:          58.08 Kbytes/sec received
\end{alltt}

\slide{Apache Benchmark output - 3}

\begin{alltt}
\footnotesize
Connection Times (ms)
              min  mean+/-sd median   max
Connect:       22   24   4.0     24      58
Processing:    96  105  33.0     99     421
Waiting:       63   71  32.7     65     386
Total:        119  130  33.5    124     446

Percentage of the requests served within a certain time (ms)
  50%    124
  66%    126
  75%    128
  80%    130
  90%    143
  95%    153
  98%    189
  99%    446
 100%    446 (longest request)
\end{alltt}



\exercise{ex:sysctl}
\exercise{ex:iperf}
\exercise{ex:apache-benchmark}





\slide{Opsamling på dagens arbejde}

\begin{list1}
\item Hvad har vi lært?
\item Fri leg på udstyret
\end{list1}



