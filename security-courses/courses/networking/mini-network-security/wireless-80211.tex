\slide{Trådløse teknologier 802.11}

\begin{list1}
\item 802.11 er arbejdsgruppen under IEEE 
\item De mest kendte standarder idag indenfor trådløse teknologier:
\begin{list2}
\item 802.11b 11Mbps versionen
\item 802.11g 54Mbps versionen
\item 802.11n endnu hurtigere, og draft
\item 802.11i Security enhancements
\end{list2}
\item Der er proprietære versioner 22Mbps og den slags\\
- det anbefales IKKE at benytte disse da det giver vendor lock-in -
man bliver låst fast
\end{list1}

Kilde: \link{http://grouper.ieee.org/groups/802/11/index.html}

\slide{802.11 modes og frekvenser}

\begin{list1}
\item Access point kører typisk i \emph{access point mode} også kaldet
  infrastructure mode - al trafik går via AP
\item Alternativt kan wireless kort oprette ad-hoc netværk - hvor
  trafikken går direkte mellem netkort
\item Frekvenser op til kanal 11 og 12+13 i DK/EU
\item Helst 2 kanaler spring for 802.11b AP der placeres indenfor rækkevidde
\item Helst 4 kanaler spring for 802.11g AP der placeres indenfor rækkevidde
\end{list1}

\slide{Eksempel på netværk med flere AP'er}

\hlkimage{20cm}{images/wireless-multi-ap.pdf}

\slide{Eksempel på netværk med flere AP'er}

\hlkimage{20cm}{images/wireless-multi-ap-2.pdf}


\slide{Wireless Distribution System WDS}

\hlkimage{18cm}{images/wireless-multi-ap-wds.pdf}

\begin{list1}
\item Se også:
\link{http://en.wikipedia.org/wiki/Wireless_Distribution_System}
\end{list1}


\slide{\hskip 1 cm Er trådløse netværk interessante?}

\begin{list1}
\item Sikkerhedsproblemer i de trådløse netværk er mange
  \begin{list2}
  \item Fra lavt niveau - eksempelvis ARP, 802.11
  \item dårlige sikringsmekanismer - WEP
  \item dårligt udstyr - mange fejl
  \item usikkkerhed om implementering og overvågning
  \end{list2}
\item Trådløst udstyr er blevet meget billigt!
\item Det er et krav fra brugerne - trådløst er lækkert
\end{list1}


\slide{Konsekvenserne}

\hlkimage{10cm}{images/wireless-daekning.pdf}

\begin{list2}
\item Værre end Internetangreb - anonymt
\item Kræver ikke fysisk adgang til lokationer
%\emph{spioneres imod}
\item Konsekvenserne ved sikkerhedsbrud er generelt større
\item Typisk får man direkte LAN eller Internet adgang!
\end{list2}

\slide{Værktøjer}

\begin{list1}
\item Alle bruger nogenlunde de samme værktøjer, måske forskellige
  mærker
\begin{list2}
\item Wirelessscanner - Kismet og netstumbler
\item Wireless Injection - typisk på Linux
\item ...
\item Aircrack-ng
\end{list2}
\item Jeg anbefaler Auditor Security Collection og BackTrack boot CD'erne
\end{list1}


\slide{Konsulentens udstyr wireless}

\begin{list1}
\item Laptop med PC-CARD slot
\item Trådløse kort Atheros, de indbyggede er ofte ringe ;-)
\item Access Points - jeg anbefaler Airport Express
\item Antenner hvis man har lyst
\item Bøger: 
\begin{list2}
\item \emph{Real 802.11 security}
\item Se oversigter over bøger og værktøjer igennem præsentationen:
\end{list2}
\item Internetressourcer:
\begin{list2}
\item BackTrack - CD image med Linux+værktøjer    
\item Packetstorm wireless tools
\link{http://packetstormsecurity.org/wireless/}
\item \emph{Beginner's Guide to Wireless Auditing}
David Maynor 
\link{http://www.securityfocus.com/infocus/1877?ref=rss}
\end{list2}
\end{list1}


\slide{Typisk brug af 802.11 udstyr}

\begin{center}
\colorbox{white}{\includegraphics[width=20cm]{images/wlan-accesspoint-1.pdf}}
\end{center}

\centerline{\hlkbig et access point - forbindes til netværket}

\slide{Basal konfiguration}

\begin{list1}
\item Når man tager fat på udstyr til trådløse netværk opdager man:
\item SSID - nettet skal have et navn
\item frekvens / kanal - man skal vælge en kanal, eller udstyret
  vælger en automatisk
\item der er nogle forskellige metoder til sikkerhed  
\end{list1}

\slide{Trådløs sikkerhed}

\hlkimage{14cm}{images/apple-wireless-security.png}

\begin{list2}
\item Trådløs sikkerhed - WPA og WPA2
\item Nem konfiguration
\item Nem konfiguration af Access Point  
\end{list2}

\slide{Wireless networking sikkerhed i 802.11b}

\hlkimage{10cm}{images/wlan-accesspoint-1.pdf}

\begin{list1}
\item Sikkerheden er baseret på nogle få forudsætninger 
  \begin{list2}
  \item SSID - netnavnet
  \item WEP \emph{kryptering} - Wired Equivalent Privacy
  \item måske MAC flitrering, kun bestemte kort må tilgå accesspoint 
  \end{list2}
\item Til gengæld er disse forudsætninger ofte ikke tilstrækkelige ... 
%\item Hvorfor hader du WEP?
  \begin{list2}
  \item WEP er måske \emph{ok} til visse små hjemmenetværk
  \item WEP er baseret på en DELT hemmelighed som alle stationer kender
  \item nøglen ændres sjældent, og det er svært at distribuere en ny
  \end{list2}
  
\end{list1}


\slide{Forudsætninger}

\begin{list1}
\item Til gengæld er disse forudsætninger ofte ikke tilstrækkelige ... 
\item Hvad skal man beskytte?
\item Hvordan kan sikkerheden omgås?
\item Mange firmaer og virksomheder stille forskellige krav til
  sikkerheden - der er ikke en sikkerhedsmekanisme der passer til alle
\end{list1}

\slide{SSID - netnavnet}

\begin{list1}
\item Service Set Identifier (SSID) - netnavnet
\item 32 ASCII tegn eller 64 hexadecimale cifre
\item Udstyr leveres typisk med et standard netnavn
\begin{list2}
\item Cisco - tsunami
\item Linksys udstyr - linksys
\item Apple Airport, 3Com m.fl. - det er nemt at genkende dem  
\end{list2}
\item SSID kaldes også for NWID - network id
\item SSID broadcast - udstyr leveres oftest med broadcast af SSID
\end{list1}


%wardriving her
\slide{Demo: wardriving med stumbler programmer}

\hlkimage{17cm}{images/macstumbler.png}  

\begin{list1}
\item man tager et trådløst netkort og en bærbar computer og noget software:
\begin{list2}
\item Netstumbler - Windows \link{http://www.netstumbler.com}
\item dstumbler - UNIX \link{http://www.dachb0den.com/projects/dstumbler.html}
\item iStumbler - Mac \link{http://www.istumbler.net/}
\item Kismet ... mange andre
  \end{list2}
\end{list1}

\slide{Start på demo - wardriving}

\hlkimage{15cm}{images/server-client-wlan.pdf}

\begin{list2}
\item Almindelige laptops bruges til demo
\item Der startes et \emph{access point}
\end{list2}

\slide{MAC filtrering}

\begin{list1}
\item De fleste netkort tillader at man udskifter sin MAC adresse
\item MAC adressen på kortene er med i alle pakker der sendes
\item MAC adressen er aldrig krypteret, for hvordan skulle pakken så
  nå frem?
\item MAC adressen kan derfor overtages, når en af de tilladte
  stationer forlader området ...
\end{list1}

\slide{Resultater af wardriving}

\begin{list1}
\item Hvad opdager man ved wardriving?
\begin{list2}
\item at WEP IKKE krypterer hele pakken
\item at alle pakker indeholder MAC adressen
\item WEP nøglen skifter sjældent
\item ca. 2/3 af de netværk man finder har ikke WEP slået til - og der
  er fri og uhindret adgang til Internet
\end{list2}
\item {\color{red}
Man kan altså lytte med på et netværk med WEP, genbruge en anden
maskines MAC adresse - og måske endda bryde WEP krypteringen.}
\item 
Medmindre man kender virksomheden og WEP nøglen ikke er skiftet ...
det er besværligt at skifte den, idet alle stationer skal opdateres.
\end{list1}

\slide{Storkøbenhavn}

\begin{center}
\colorbox{white}{\includegraphics[width=20cm]{images/20030830-kbh.png}}  
\end{center}



\slide{Informationsindsamling}

\begin{list1}
\item Det vi har udført er informationsindsamling
\item Indsamlingen kan være aktiv eller passiv indsamling i forhold
  til målet for angrebet
\item passiv kunne være at lytte med på trafik eller søge i databaser
  på Internet
\item aktiv indsamling er eksempelvis at sende ICMP pakker og
  registrere hvad man får af svar
\end{list1}

\slide{WEP kryptering} 

%\begin{center}
%\colorbox{white}{\includegraphics[width=12cm]{images/airsnort.pdf}}  
%\end{center}
\begin{list1}
\item WEP \emph{kryptering} - med nøgler der specificeres som tekst
  eller hexadecimale cifre
\item typisk 40-bit, svarende til 5 ASCII tegn eller 10 hexadecimale
  cifre eller 104-bit 13 ASCII tegn eller 26 hexadecimale cifre
\item WEP er baseret på RC4 algoritmen der er en \emph{stream cipher}
  lavet af Ron Rivest for RSA Data Security
\end{list1}


\slide{De første fejl ved WEP}
\begin{list1}
\item Oprindeligt en dårlig implementation i mange Access Points
\item Fejl i krypteringen - rettet i nyere firmware
\item WEP er baseret på en DELT hemmelighed som alle stationer kender
\item Nøglen ændres sjældent, og det er svært at distribuere en ny
\end{list1}

\slide{WEP som sikkerhed}

\hlkimage{6cm}{images/no-wep.pdf}
\begin{list1}
\item WEP er \emph{ok} til et privat hjemmenetværk
\item WEP er for simpel til et større netværk - eksempelvis 20 brugere
\item Firmaer bør efter min mening bruge andre
  sikkerhedsforanstaltninger 
\item Hvordan udelukker man en bestemt bruger?
\end{list1}

\slide{WEP sikkerhed}

\hlkimage{12cm}{images/airsnort.pdf}  

\begin{quote}
AirSnort is a wireless LAN (WLAN) tool which recovers encryption
keys. AirSnort operates by passively monitoring transmissions,
computing the encryption key when enough packets have been gathered.  

802.11b, using the Wired Equivalent Protocol (WEP), is crippled with
numerous security flaws. Most damning of these is the weakness
described in " Weaknesses in the Key Scheduling Algorithm of RC4 "
by Scott Fluhrer, Itsik Mantin and Adi Shamir. Adam Stubblefield
was the first to implement this attack, but he has not made his
software public. AirSnort, along with WEPCrack, which was released
about the same time as AirSnort, are the first publicly available
implementaions of this attack.  \link{http://airsnort.shmoo.com/}
\end{quote}

%\begin{list1}
%\item i dag er firmware opdateret hos de fleste producenter
%\item men sikkerheden baseres stadig på een delt hemmelighed
%\end{list1}

\slide{major cryptographic errors}

\begin{list1}
\item weak keying - 24 bit er allerede kendt - 128-bit = 104 bit i praksis
\item small IV - med kun 24 bit vil hver IV blive genbrugt oftere
\item CRC-32 som intergritetscheck er ikke \emph{stærkt} nok
  kryptografisk set
\item Authentication gives pad - giver fuld adgang - hvis der bare
  opdages \emph{encryption pad} for en bestemt IV. Denne IV kan så
  bruges til al fremtidig kommunikation
\end{list1}

{\hlkbig Konklusion: Kryptografi er svært}

\slide{WEP cracking - airodump og aircrack}

\hlkimage{3cm}{images/no-wep.pdf}

\begin{list1}
\item airodump - opsamling af krypterede pakker
\item aircrack - statistisk analyse og forsøg på at finde WEP nøglen
\item Med disse værktøjer er det muligt at knække \emph{128-bit nøgler}!
\item Blandt andet fordi det reelt er 104-bit nøgler \smiley
\item tommelfingerregel - der skal opsamles mange pakker ca. 500.000
  er godt
\item Links:\\
\link{http://www.cr0.net:8040/code/network/aircrack/} aircrack\\
\link{http://www.securityfocus.com/infocus/1814} WEP: Dead Again
\end{list1}

\slide{airodump afvikling}

\begin{list1}
\item Når airodump kører opsamles pakkerne
\item samtidig vises antal initialisationsvektorer IV's:
\end{list1}

\vskip 1 cm

\begin{alltt}
\hlktiny
   BSSID              CH  MB  ENC  PWR  Packets   LAN IP / # IVs   ESSID

   00:03:93:ED:DD:8D   6  11       209   {\bf 801963                  540180}   wanlan    
\end{alltt}

\vskip 2 cm

\begin{list1}
\item NB: dataopsamlingen er foretaget på 100\% opdateret Mac udstyr
\end{list1}


\slide{aircrack - WEP cracker}

\begin{alltt}
\hlktiny
   $ aircrack -n 128 -f 2 aftendump-128.cap
                                 aircrack 2.1
   * Got  540196! unique IVs | fudge factor = 2
   * Elapsed time [00:00:22] | tried 12 keys at 32 k/m
   KB    depth   votes
    0    0/  1   CE(  45) A1(  20) 7E(  15) 98(  15) 72(  12) 82(  12) 
    1    0/  2   62(  43) 1D(  24) 29(  15) 67(  13) 94(  13) F7(  13) 
    2    0/  1   B6( 499) E7(  18) 8F(  15) 14(  13) 1D(  12) E5(  10) 
    3    0/  1   4E( 157) EE(  40) 29(  39) 15(  30) 7D(  28) 61(  20) 
    4    0/  1   93( 136) B1(  28) 0C(  15) 28(  15) 76(  15) D6(  15) 
    5    0/  2   E1(  75) CC(  45) 39(  31) 3B(  30) 4F(  16) 49(  13) 
    6    0/  2   3B(  65) 51(  42) 2D(  24) 14(  21) 5E(  15) FC(  15) 
    7    0/  2   6A( 144) 0C(  96) CF(  34) 14(  33) 16(  33) 18(  27) 
    8    0/  1   3A( 152) 73(  41) 97(  35) 57(  28) 5A(  27) 9D(  27) 
    9    0/  1   F1(  93) 2D(  45) 51(  29) 57(  27) 59(  27) 16(  26) 
   10    2/  3   5B(  40) 53(  30) 59(  24) 2D(  15) 67(  15) 71(  12) 
   11    0/  2   F5(  53) C6(  51) F0(  21) FB(  21) 17(  15) 77(  15) 
   12    0/  2   E6(  88) F7(  81) D3(  36) E2(  32) E1(  29) D8(  27) 
         {\color{red}\bf KEY FOUND! [ CE62B64E93E13B6A3AF15BF5E6 ]}
\end{alltt}
%$


\slide{Hvor lang tid tager det?}

\begin{list1}
\item Opsamling a data - ca. en halv time på 802.11b ved optimale forhold
\item Tiden for kørsel af aircrack fra auditor CD 
på en Dell CPi 366MHz Pentium II laptop:
\end{list1}
\begin{alltt}

   $ time aircrack -n 128 -f 2 aftendump-128.cap
   ...
   real    5m44.180s   user  0m5.902s     sys  1m42.745s
   \end{alltt}
   %$

\pause
\begin{list1}
\item Tiden for kørsel af aircrack på en moderne 1.6GHz CPU med
  almindelig laptop disk tager typisk mindre end 60 sekunder
\end{list1}

\slide{Erstatning for WEP- WPA}

\begin{list1}
\item Det anbefales at bruge:
%\begin{list2}
\item Kendte VPN teknologier eller WPA
\item baseret på troværdige algoritmer
\item implementeret i professionelt udstyr
\item fra troværdige leverandører
\item udstyr der vedligeholdes og opdateres
%\end{list2}
\item Man kan måske endda bruge de eksisterende løsninger - fra
  hjemmepc adgang, mobil adgang m.v.
\end{list1}


\slide{RADIUS}
\begin{list1}
\item RADIUS er en protokol til autentificering af brugere op mod en
  fælles server 
\item Remote Authentication Dial In User Service (RADIUS)
\item RADIUS er beskrevet i RFC-2865
\item RADIUS kan være en fordel i større netværk med 
\begin{list2}
\item dial-in
\item administration af netværksudstyr
\item trådløse netværk
\item andre RADIUS kompatible applikationer
\end{list2}
\end{list1}


\slide{Erstatninger for WEP}
\begin{list1}
\item Der findes idag andre metoder til sikring af trådløse netværk
\item 802.1x Port Based Network Access Control 
\item WPA - Wi-Fi Protected Access)\\
WPA = 802.1X + EAP + TKIP + MIC
\item nu WPA2
\begin{quote}
WPA2 is based on the final IEEE 802.11i amendment to the 802.11
standard and is eligible for FIPS 140-2 compliance.
\end{quote}
\item Kilde: 
\href{http://www.wifialliance.org/OpenSection/protected_access.asp}
{http://www.wifialliance.org/OpenSection/protected\_access.asp}
\end{list1}

\slide{WPA eller WPA2?}

\begin{quote}
WPA2 is based upon the Institute for Electrical and Electronics
Engineers (IEEE) 802.11i amendment to the 802.11 standard, which was
ratified on July 29, 2004.  
\end{quote}

\begin{quote}
Q: How are WPA and WPA2 similar?\\
A: Both WPA and WPA2 offer a high level of assurance for end-users and network
administrators that their data will remain private and access to their
network restricted to authorized users.
Both utilize 802.1X and Extensible Authentication Protocol (EAP) for
authentication. Both have Personal and Enterprise modes of operation
that meet the distinct needs of the two different consumer and
enterprise market segments. 

Q: How are WPA and WPA2 different?\\
A: WPA2 provides a {\bf stronger encryption mechanism} through {\bf
  Advanced Encryption Standard (AES)}, which is a requirement for some
corporate and government users. 
\end{quote}

\centerline{Kilde: http://www.wifialliance.org WPA2 Q and A}

\slide{WPA Personal eller Enterprise}

\begin{list1}
\item Personal - en delt hemmelighed, preshared key
\item Enterprise - brugere valideres op mod fælles server
\item Hvorfor er det bedre?
\begin{list2}
\item Flere valgmuligheder - passer til store og små
\item WPA skifter den faktiske krypteringsnøgle jævnligt - TKIP 
\item Initialisationsvektoren (IV) fordobles 24 til 48 bit   
\item Imødekommer alle kendte problemer med WEP!
\item Integrerer godt med andre teknologier - RADIUS

\vskip 1 cm
\item EAP - Extensible Authentication Protocol - individuel autentifikation
\item TKIP - Temporal Key Integrity Protocol - nøgleskift og integritet
\item MIC - Message Integrity Code - Michael, ny algoritme til integritet
\end{list2}

\end{list1}


\slide{WPA cracking}

\begin{list1}
\item Nu skifter vi så til WPA og alt er vel så godt?  
\pause
\item Desværre ikke!
\item Du skal vælge en laaaaang passphrase, ellers kan man sniffe WPA
  handshake når en computer går ind på netværket!
\item Med et handshake kan man med aircrack igen lave off-line
  bruteforce angreb!
\end{list1}

\slide{WPA cracking demo}

\begin{list1}
\item Vi konfigurerer AP med Henrik42 som WPA-PSK/passhrase  
\item Vi finder netværk kismet eller airodump
\item Vi starter airodump mod specifik kanal
\item Vi spoofer deauth og opsamler WPA handshake
\item Vi knækker WPA :-)
\end{list1}

\centerline{Brug manualsiderne for programmerne i aircrack-ng pakken!}

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
slax ~ # aircrack-ng -w dict wlan-test.cap
Opening wlan-test.cap
Read 1082 packets.

#  BSSID              ESSID           Encryption

1  00:11:24:0C:DF:97  wlan            WPA (1 handshake)
2  00:13:5F:26:68:D0  Noea            No data - WEP or WPA
3  00:13:5F:26:64:80  Noea            No data - WEP or WPA
4  00:00:00:00:00:00                  Unknown

Index number of target network ? {\bf 1}
\end{alltt}

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
          [00:00:00] 0 keys tested (0.00 k/s)

                    KEY FOUND! [ Henrik42 ]

Master Key     : 8E 61 AB A2 C5 25 4D 3F 4B 33 E6 AD 2D 55 6F 76
                 6E 88 AC DA EF A3 DE 30 AF D8 99 DB F5 8F 4D BD
Transcient Key : C5 BB 27 DE EA 34 8F E4 81 E7 AA 52 C7 B4 F4 56
                 F2 FC 30 B4 66 99 26 35 08 52 98 26 AE 49 5E D7
                 9F 28 98 AF 02 CA 29 8A 53 11 EB 24 0C B0 1A 0D
                 64 75 72 BF 8D AA 17 8B 9D 94 A9 31 DC FB 0C ED

EAPOL HMAC     : 27 4E 6D 90 55 8F 0C EB E1 AE C8 93 E6 AC A5 1F

\end{alltt}

\vskip 1 cm

\centerline{Min Thinkpad X31 med 1.6GHz Pentium M knækker ca. 150 Keys/sekund}

\slide{Tools man bør kende}

\begin{list2}
\item BSD Airtools \link{http://www.dachb0den.com/projects/bsd-airtools.html}
\item Kismet \link{http://www.kismetwireless.net/}
\item Airsnort \link{http://airsnort.shmoo.com/} læs pakkerne med WEP
  kryptering  
\item wepcrack \link{http://wepcrack.sourceforge.net/} - knæk
  krypteringen i WEP
\item Airsnarf \link{http://airsnarf.shmoo.com/} - lav dit eget AP
  parallelt med det rigtige og snif hemmeligheder
\item Wireless Scanner \link{http://www.iss.net/} - kommercielt 
\item Dette er et lille uddrag af programmer\\
Se også \link{http://packetstormsecurity.org/wireless/}
\end{list2}

\slide{Når adgangen er skabt}

\begin{list1}
\item Så går man igang med de almindelige værktøjer
\item Fyodor Top 100 Network Security Tools \link{http://www.sectools.org}  
\end{list1}
\vskip 2 cm

\centerline{\hlkbig Forsvaret er som altid - flere lag af sikkerhed! }

\slide{Infrastrukturændringer}

\begin{center}
\colorbox{white}{\includegraphics[height=11cm]{images/wlan-accesspoint-2.pdf}}
\end{center}

\centerline{\hlkbig Sådan bør et access point forbindes til netværket}


\slide{Anbefalinger mht. trådløse netværk}

\begin{minipage}{10cm}
\includegraphics[width=10cm]{images/wlan-accesspoint-2.pdf}
\end{minipage}
\begin{minipage}{\linewidth-10cm}
\begin{list2}
\item Brug noget tilfældigt som SSID - netnavnet
\item Brug ikke WEP til virksomhedens netværk\\
- men istedet en VPN løsning med individuel
  autentificering eller WPA
\item NB: WPA Personal/PSK kræver passphrase på +40 tegn!
\item Placer de trådløse adgangspunkter hensigtsmæssigt i netværket -
  så de kan overvåges
\item Lav et sæt regler for brugen af trådløse netværk - hvor må 
  medarbejdere bruge det?
\item Se eventuelt pjecerne \emph{Beskyt dit trådløse Netværk} fra
Ministeriet for Videnskab, Teknologi og Udvikling \\
\link{http://www.videnskabsministeriet.dk/}
\end{list2}
\end{minipage} 


\slide{Hjemmenetværk for nørder}

\begin{list1}
\item Lad være med at bruge et wireless-kort i en PC til at lave AP, brug et AP
\item Husk et AP kan være en router, men den kan ofte også blot være en bro
\item Brug WPA og overvej at lave en decideret DMZ til WLAN
\item Placer AP hensigtsmæddigt og gerne højt, oppe på et skab eller lignende
\end{list1}

%\exercise{ex:AirPort-AP}

%\exercise{ex:wardriving-windows}
%\exercise{ex:wardriving-kismet}
%\exercise{ex:aircrack-ng}