\documentclass[18pt,landscape,a4paper]{foils}

% HLK/ security6
\usepackage{sec6slides}

% 
% Arrangement:	Penetration testing I - basal pentest metoder og introduktion
% Mål:	Introduktion til penetrationstest.
% Forudsætninger:	Der forventes kendskab til TCP/IP på brugerniveau.
% Beskrivelse:	Denne foredragsrække består af tre uafhængige dele.

% Denne del introducerer emnet penetrationstest, hvad er det og hvad
% er værdien for dig. Emner der gennemgås er blandt andet: 

% * Regler og etik for penetrationstest (ISC)² Code of Ethics
% * Informationsindsamling - aktiv og passiv
% * Portscan med nmap - TCP og UDP portscanning
% * Servicescanning - identifikation af porte og protokoller
% * Sårbarheder CVE og OSVDB
% * Exploits og introduktion til buffer overflows
% * Bruteforcing med Hydra
% * Opsamling og præsentation af data

% Der vil være demonstrationer af sårbarheder på alle foredragene -
% typisk med open source programmer, således at deltagerne kan afprøve
% de selvsamme demoer hjemme. 

% Note: der tages udgangspunkt i open source og UNIX, men resultater og principper kan overføres til ASP og .NET teknologierne.

\begin{document}

%\slide{}

%{Penetration testing II\\\normalsize webbaserede angreb}

\mytitlepage
{Penetration testing II\\ webbaserede angreb}
{Oktober 2006}

%\begin{alltt}
%\tiny 
%\centerline{$Id:$}
%\end{alltt}

\LogoOn

%\dagsplan

\slide{Formålet idag}
\vskip 2 cm

%{\hlkbig En 3 dages workshop, hvor du lærer at angribe dit netværk!}

\begin{list1}
\item Introducere basale penetrationstestmetoder mod webservere og web
  applikationer 
\item At forklare de problemer man støder på under udførelse af
  sikkerhedstest mod webservere
\item Gøre deltagerne istand til at udforske området ved at henvise
  til gode kilder
\end{list1}


\slide{Aftale om test af netværk}

{\bfseries Straffelovens paragraf 263 Stk. 2. Med bøde eller fængsel
  indtil 6 måneder 
straffes den, som uberettiget skaffer sig adgang til en andens
oplysninger eller programmer, der er bestemt til at bruges i et anlæg
til elektronisk databehandling.}

Hacking kan betyde:
\begin{list2}
\item At man skal betale erstatning til personer eller virksomheder
\item At man får konfiskeret sit udstyr af politiet
\item At man, hvis man er over 15 år og bliver dømt for hacking, kan
  få en bøde - eller fængselsstraf i alvorlige tilfælde 
\item At man, hvis man er over 15 år og bliver dømt for hacking, får
en plettet straffeattest. Det kan give problemer, hvis man skal finde
et job eller hvis man skal rejse til visse lande, fx USA og
Australien
\item Frit efter: \link{http://www.stophacking.dk} lavet af Det
  Kriminalpræventive Råd 
\item Frygten for terror har forstærket ovenstående - så lad være!
\end{list2}

\slide{ISC2 code of ethics}

\hlkimage{20cm}{isc2-code-of-ethics.png}

\link{https://www.isc2.org/cgi/content.cgi?category=12}


\slide{Er sikkerhedstest af webservere interessant?}

\hlkimage{14cm}{web-dynamic.png}

\begin{list1}
\item Sikkerhedsproblemer i netværk er mange
\item Kan være et krav fra eksterne - eksempelvis VISA PCI krav
\end{list1}


\slide{Emneområder}

\begin{list2}
\item Introduktion - begreber og teknologierne
\item Hvad er sikkerhedstest
\item Fordele ved at få udført planlagt sikkerhedstest
\item Planlægning af sikkerhedstest
\item Før testen - forberedelse
\item  Udvælgelse af systemer til test
\item  Godkendelse og tilladelse fra systemejere m.fl.
\item  Oprydning og afrapportering - resultater
\item  Konsulentens udstyr - vil du være sikkerhedskonsulent
\item  Selve testens udførelse 
\end{list2}


\slide{ Introduktion - begreber og teknologierne}

\begin{list1}
\item Sikkerhedstest / penetrationstest\\
Afprøvning af sikkerhedsforanstaltninger og evaluering af
sikkerhedsniveau ved hjælp af IT systemer og \emph{hackerværktøjer}  
\item Kaldes tillige sårbarhedstest, sårbarhedsanalyse m.v.
\item Ekstern - udføres fra internet typisk over WAN
\item Intern, inside, on-site - udføres hos kunden typisk over LAN og
  bag firewall
\end{list1}

\link{http://www.google.com/search?q=sikkerhedstest}

\slide{Blackbox, greybox og whitebox}

\begin{list1}
\item Forudsætninger og forudgående kendskab til miljøet
\item 
Afhængig af de informationer der er tilgængelige om opbygningen af det
scannede netværk forud for NetSikkerhedsanalysen taler man om
henholdsvis White, Grey og Black Box testning. 
\begin{list2}
\item Black Box testen involverer en sikkerhedstestning af et netværk uden
nogen form for insider viden om systemet udover den IP-adresse, der
ønskes testet. Dette svarer til den situation en fjendtlig hacker vil
stå i og giver derfor det mest realistiske billede af netværkets
sårbarhed overfor angreb udefra. Men er dårlig ressourceudnyttelse.  

\item I den anden ende  af skalaen har vi White Box testen. I dette tilfælde
har sikkerhedsspecialisten både før og under testen fuld adgang til
alle informationer om det scannede netværk. Analysen vil derfor kunne
afsløre sårbarheder, der ikke umiddelbart er synlige for en almindelig
angriber. En White Box test er typisk mere omfattende end en Black Box
test og forudsætter en højere grad af deltagelse fra kundens side, men
giver en meget detaljeret og tilbundsgående undersøgelse.  

\item En Grey Box test er som navnet siger et kompromis mellem en White Box
og en Black Box test. Typisk vil sikkerhedsspecialisten udover en
IP-adresse være i besiddelse af de mest grundlæggende
systemoplysninger: Hvilken type af server der er tale om (mail-,
webserver eller andet), operativsystemet og eventuelt om der er
opstillet en firewall foran serveren. 
\end{list2}
\end{list1}


\slide{Fordele ved at få udført planlagt sikkerhedstest}

\begin{quote}
Formålet med en sikkerhedstest er at nedbringe risici for systemerne
og sikre organisationen mod uventede tab af data, tab af omdømme,
forøgede omkostninger. Formålet er ikke at udpege en syndebuk eller
identificere dårlige medarbejdere.  
\end{quote}

\begin{list1}
\item Giver gavnlig information
\item undgår nedbrud på uheldige tidspunkter
\item Målgrupper:
\begin{list2}
\item IT-afdeling og teknisk personale
\item Ledelse, koncernledelse    
\end{list2}
\item Afleveringer:
\begin{list2}
\item Rapport med tekniske anbefalinger og opsummering/checklister
\item Executive summary    
\end{list2}
\end{list1}

\slide{Værktøjer}

\begin{list1}
\item Alle bruger nogenlunde de samme værktøjer, måske forskellige
  mærker
\begin{list2}
\item Portscanner - Fydor Nmap
\item Generel sårbarhedsscanner - Nessus skrevet af Renaud Deraison
\item Speciel web sårbarhedsscanner - eksempelvis Nikto webchecker
\item Speciel database sårbarhedsscanner - eksempelvis \link{http://www.nextgenss.com/orascan.htm}
\item ...
\item Rapportværktøj - manuel eller automatisk, helst så automatiseret
  som muligt   
\item Meget ofte er sikkerhedstest automatiseret på de indledende
  skridt og manuel derefter
\end{list2}
\end{list1}

\slide{Persongalleri}

\begin{list2}
\item Sikkerhedskonsulent - den konsulent der kommer ud til kunden 
\item Kontaktperson - kundens ansatte som kan hjælpe med praktiske
  spørgsmål og skabe kontakt til de rette personer i kundens organisation 
\item Systemejer - den ansvarlige for et bestemt system 
\item Netværksejer - den ansvarlige for netværk hos kunden
\item Driftorganisation - dem der driver systemerne
\item Sikkerhedsansvarlig - den ansvarlige for sikkerheden hos kunden 
\end{list2}


\slide{Planlægning af sikkerhedstest}

\begin{list1}
\item Sårbarhedsanalysens omfang
\begin{list2}
\item Scope - hvad skal testes
\item Hvornår skal testes - indenfor et aftalt tidsrum
\item Hvor testes fra - logfilerne vil afsløre IP-adresser
\item Skal være aftalt på forhånd
\item Kan overskrides delvist - eksempelvis ved port 80 scan på samme
  subnet eller tilsvarende
\item Skal der forsøges ude af drift angreb - DoS
\item Se endvidere slide om Rules of engagement senere   
\end{list2}
\item {\bf Sårbarhedsanalysen omfatter (targets):}
\begin{list2}
\item 192.168.1.1 - firewall/router
\item 192.168.1.2 - mailserver
\item 192.168.1.3 - webserver
\item Testen udføres i tidsrummet mandag 1. til fredag 5. fra 217.157.20.128/28
\end{list2}
\end{list1}


\slide{Før konsulenten ankommer - forberedelse}

\begin{list1}
\item Testplan med oversigt over targets og IP-adresser
\item Netværkstegninger og anden information som er aftalt oplyst
\item Hvor skal sikkerhedskonsulenten placeres på insidetest - ikke i serverrum tak :-)
\item Kabling af netværksstik
\item Gæstekort - til test over flere dage
\item kantine, toiletter osv.
\end{list1}
\vskip 1cm
\centerline{Betragt det som en ny kollega - med tidsbegrænset kontrakt}

\slide{Udvælgelse af systemer til test}

\hlkimage{14cm}{images/demo-netvaerk.pdf}

\begin{list1}
\item Typiske interessante mål og årsager
\begin{list2}
\item Routere på netværksvejen til kritiske systemer og netværk -
  tilgængelighed 
\item Firewall - begrænses trafikken tilstrækkeligt
\item Mailservere - tillades relaying udefra
\item Webservere - kan der afvikles kode på systemet, downloades data     
\end{list2}
\end{list1}

\slide{Godkendelse og tilladelse}

\begin{list1}
\item Udførelse af test kan have negativ indflydelse på driften
\item Inden en test kan udføres skal der indhentes tilladelser fra:
\begin{list2}
\item systemejere
\item netværksejer
\item driftorganisationer
\end{list2}
\item At belyse problemerne er formålet\\
- at få dem belyst indenfor et aftalt tidsrum er en fordel!
\end{list1}

\slide{Scannerudstyr på insidetest}

\vskip 2 cm
\begin{quote}
Scannersystemer, hardware og software kræver en del ekspertice og
opsætning. Det er tidskrævende at foretage denne opsætning og
konsulenten har på forhånd udvalgt og konfigureret udstyr til testen.  
Det skal derfor accepteres at konsulenten tilslutter eget udstyr til
de pågældende netværk og dette sker naturligvis under strenge krav til
konsulentens udstyr.  
\end{quote}
\vskip 2 cm
\centerline{\bf Det er ikke en mulighed at bruge kundens udstyr!}

\slide{testens udførelse}

\begin{list1}
\item testen udføres ved samarbejde mellem konsulent og virksomhed
\item Først og fremmest skal testen startes
\begin{list2}
\item Når konsulenten ankommer kontaktes kontaktpersonen
\item Konsulenten vises til rette og pakker ud/stiller op
\item Såfremt det ønskes inspiceres og godkendes udstyret
\item Konsulenten tilslutter sig netværket og test er officielt igang
\item Konsulenten verificerer adgangen til netværk og melder klar,
  begynder test
\end{list2}
\item ... tiden går ... testen udføres ... 
\item kontaktpersonen er hele tiden til rådighed på mobiltelefon
\item Testen afsluttes og der pakkes ned i modsat rækkefølge  
\end{list1}


\slide{Afbrydelse af testen - kompromitterede maskiner og nedbrud}

\begin{list1}
\item Der kan være årsager der medfører at testen skal indstilles
\item Sikkerhedskonsulenten afbryder testen
\begin{list2}
\item Det anses for uforsvarligt at fortsætte, der er fundet
  kompromitterede systemer eller beviser der kan ødelægges
\item Netværket er dårligt, mulighederne for udførelse er forringet
\end{list2}
\item Kunden ønsker at afbryde testen
\begin{list2}
\item Der opleves for store problemer under udførelsen
\item Systemnedbrud på forretningskritiske systemer
\item Andre kriser der gør det valgte tidspunkt uegnet 
\end{list2}
\item NB: eksempler! - man afbryder altid når kunden ønsker det!
\end{list1}

\slide{Oprydning efter testen}

\begin{list1}
\item Sikkerhedskonsulenten er ansvarlig for:
\begin{list2}
\item Fjerne data fra systemerne
\item Fjerne brugerkonti, få fjernet brugeroplysninger og
  loginmuligheder
\item Fjerne software som ikke skal benyttes mere    
\end{list2}
\item Driftsorganisationen er ansvarlig for:
\begin{list2}
\item Undersøgelse af systemerne
\item Eventuel genstart af systemer, der kan være nedsat effektivitet
\item Fjerne patchkabler for stik der er kablet speciet til konsulenten
\end{list2}
\end{list1}

\slide{Afrapportering - resultater}

\begin{list1}
\item Hvad indeholder en sikkerhedstest rapport:  
\begin{list2}
\item titel, indholdsfortegnelse, firmanavne - ca. 15-30 sider for 5 hosts    
\item fortrolighedserklæring - det er fortrolige oplysninger
\item Executive summary - ofte i større virksomheder   
\item Information om den udførte scanning
\item Omfang/scope
\item Gennemgang af targets - detaljeret information og med anbefalinger
\item Konklusion - ofte mere teknisk
\item Bilag - detaljerede oplysninger og oversigter, checklister
\end{list2}
\item Det er organisationen der selv vælger hvilke anbefalinger der følges
\end{list1}


\slide{Hostinfo}

\hlkimage{8cm}{images/host-info.pdf}

\begin{center}
  
\tiny
\link{file:/userdata/security6.net/projects/pentest/hostinfo/host-10.0.42.117.pdf}

\link{file:/userdata/security6.net/images/sample-report.pdf}
\end{center}

\slide{Rules of engagement - regler og etik for sikkerhedstest}

\begin{list2}
\item NB: stor forskel på Danmark og udlandet!
\item Sikkerhedskonsulenten må ikke give anledning til nye sårbarheder
  som følge af testen
\item Sikkerhedskonsulenten må ikke installere ny software på
  systemer uden forudgående aftale
\item Sikkerhedskonsulenten efterlader ikke usikre
  systemadministratorkonti eller tilsvarende efter testen
\item Sikkerhedskonsulenten tager altid kontakt til kunden ved
  høj-risiko sårbarheder  
\item Er man hyret til netværkssikkerhed kan man godt \emph{snuse}
  lidt rundt om systemerne under test - der kan være et sårbart
  testsystem lige ved siden af
\item Security6.net vil ved opdagelse af åbenlyse sikkerhedsrisici
  dokumentere disse i rapporten, uanset scope for opgaven ellers
\end{list2}

\centerline{Det er en balancegang}


\slide{Konsulentens udstyr - vil du være sikkerhedskonsulent}

\begin{list1}
\item Bøger:
\begin{list2}
\item \emph{Counter Hack: A Step-by-Step Guide to Computer Attacks and
Effective Defenses}, Ed Skoudis, Prentice Hall PTR, 1st edition July 2001
\item \emph{Network Security Assessment: Know Your Network},
  Chris McNab, O'Reilly March 2004 
\item \emph{Gray Hat Hacking}, Shon Harris et al, Osborne, 2005    

\item Se oversigter over bøger og værktøjer igennem præsentationen:
\end{list2}
\item Internetressourcer:
\begin{list2}
\item Auditor Security Collection - CD image med Linux+værktøjer    
\item \emph{OSSTMM - Open Source Security Testing Methodology Manual}
  af Pete Herzog \\
\link{http://www.isecom.org/osstmm/}
\item \link{http://www.professionalsecuritytester.com/}
\end{list2}
\end{list1}




\slide{Udvælgelse af værktøjer til sikkerhedstest}


\begin{list1}
\item Sikkerhedskonsulenterne bruger typisk Open Source værktøjer på UNIX og
enkelte systemer med Windows - jeg bruger helst Windows 2000
\item Jeg anbefaler kraftigt at Windows systemerne ikke benyttes som
arbejdsstation i hverdagen
\item I Security6.net bruges Windows systemerne aldrig til håndtering
  af email, Windows systemerne benytter opdateret systemsoftware og antivirus 
\end{list1}

% slides start
\slide{Forudsætninger}

\begin{list1}
\item Dette er et teknisk foredrag og fuldt udbytte kræver at
  deltagerne har mindst 2 års praktisk erfaring som teknikker og/eller
  systemadministrator
%\item Vi gennemgår mange forskellige ting - ofte i detaljer
\item Til penetrationstest og det meste Internet-sikkerhedsarbejde er der
 følgende forudsætninger
\begin{list2}
\item Netværkserfaring
\item TCP/IP principper - ofte i detaljer
\item Programmmeringserfaring er en fordel
\item UNIX kendskab er ofte en {\bfseries nødvendighed}\\
- fordi de nyeste værktøjer er skrevet til UNIX i form af Linux og BSD
\vskip 3 mm
\item Security6.net anvender OpenBSD til øvelser og UNIX kendskab
  er derfor en fordel
\item Alle øvelser kan udføres fra en Windows PC - UNIX øvelserne
  foregår via login til UNIX maskinen
\end{list2}
\end{list1}

\slide{Kursusnetværk}

\hlkimage{22cm}{images/kursus-netvaerk.pdf}


\slide{Hackerværktøjer}
% måske til reference afsnit?

\begin{list1}
\item Der benyttes en del værktøjer:
\begin{list2}
\item nmap - \link{http://www.insecure.org} portscanner
\item Nessus - \link{http://www.nessus.org} automatiseret testværktøj
%\item libnet m.fl. - \link{http://www.packetfactory.net} - diverse projekter
%  relateret til pakker og IP netværk
%\item l0phtcrack - \link{http://www.atstake.com/research/lc/} - The Password
%  Auditing and Recovery Application
\item Wireshark - \link{http://http://www.wireshark.org/} avanceret netværkssniffer
\item OpenBSD - \link{http://www.openbsd.org} operativsystem med fokus
  på sikkerhed 
%\item \link{http://www.isecom.org/} - Open Source Security Testing
%  Methodology Manual - gennemgang af elementer der bør indgå i en struktureret test 
\item Putty - 
\link{http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html}
terminal emulator med indbygget SSH
\end{list2}
\end{list1}

% 
%page
\slide{Hvad skal der ske?}

\begin{list1}
\item Tænk som en hacker
\item Rekognoscering
\begin{list2}
\item ping sweep, port scan
\item OS detection - TCP/IP eller banner grab
\item Servicescan - rpcinfo, netbios, ...
\item telnet/netcat interaktion med services
\end{list2}
\item Udnyttelse/afprøvning: Nessus, nikto, exploit programs
\item Oprydning/hærdning vises måske ikke, men I bør i praksis:
\begin{list2}
\item Lav en rapport
\item Ændre, forbedre og hærde systemer
\item Gennemgå rapporten, registrer ændringer
\item Opdater programmer, konfigurationer, arkitektur, osv. 
\end{list2}
\item I skal jo også VISE andre at I gør noget ved sikkerheden.
\end{list1}


%\slide{Hackere}

% Her skal KSA præsentation ind

% session 1-2 netværk start her


% xxx \slide{RFC, Internet, åbne standarder}

% input fra tidligere præsentationer 5-10 slides

\slide{Internet idag}

\hlkimage{14cm}{images/server-client.pdf}

\begin{list1}
\item Klienter og servere
\item Rødder i akademiske miljøer
\item Protokoller der er op til 20 år gamle
\item Meget lidt kryptering, mest på http til brug ved e-handel 
\end{list1}

\slide{OSI og Internet modellerne}

\hlkimage{14cm,angle=90}{images/compare-osi-ip.pdf}


\slide{Wireshark - grafisk pakkesniffer}

\hlkimage{20cm}{images/wireshark-website.png} 

\centerline{\link{http://www.wireshark.org}}
\centerline{både til Windows og UNIX, tidligere kendt som Ethereal}

\slide{Brug af Wireshark}

\hlkimage{13cm}{images/ethereal-capture-options.png}

\centerline{Man starter med Capture - Options}

\slide{Brug af Wireshark}

\hlkimage{24cm}{images/ethereal-main-window.png}

\centerline{Læg mærke til filtermulighederne}


\slide{Secure Shell - SSH og SCP}

\begin{center}
\colorbox{white}{\includegraphics[width=12cm]{images/tshirt-9b.jpg}}  
\end{center}
\begin{list1}
\item SSH afløser en række protokoller som er usikre:
  \begin{list2}
  \item Telnet til terminal adgang
  \item r* programmerne, rsh, rcp, rlogin, ...
  \item FTP med brugerid/password
  \end{list2}
\end{list1}


\slide{SSH - de nye kommandoer er}
\begin{list1}
\item kommandoerne er:
\begin{list2}
  \item ssh - Secure Shell
  \item scp - Secure Copy
  \item sftp - secure FTP 
  \end{list2}
\item Husk: SSH er både navnet på protokollerne - version 1 og 2 samt
  programmet \verb+ssh+ til at logge ind på andre systemer
\item SSH tillader også port-forward, tunnel til usikre protokoller,
  eksempelvis X protokollen til UNIX grafiske vinduer
\item {\bfseries NB: Man bør idag bruge SSH protokol version 2!}
\end{list1}


\slide{Putty en SSH til Windows}

\begin{center}
\colorbox{white}{\includegraphics[width=13cm]{images/putty-1.jpg}}  

Login skærmen til Putty terminal programmet
\end{center}

\slide{Grafisk Secure Copy - WinSCP}

\begin{center}
\colorbox{white}{\includegraphics[width=12cm]{images/winscp-explorer.png}}  
\end{center}

\begin{center}
\item screenshot fra
  \link{http://winscp.vse.cz/eng/screenshots/large/explorer.gif} 
\end{center}


\slide{traceroute}

\begin{list1}
  \item traceroute programmet virker ved hjælp af TTL
\item levetiden for en pakke tælles ned i hver router på vejen og ved at sætte denne lavt
  opnår man at pakken \emph{timer ud} - besked fra hver router på vejen
\item default er UDP pakker, men på UNIX systemer er der ofte mulighed
  for at bruge ICMP
\end{list1}

\begin{alltt}
{\bfseries  traceroute 217.157.20.129}
traceroute to 217.157.20.129 (217.157.20.129)\\
, 30 hops max, 40 byte packets
 1  safri (10.0.0.11)  3.577 ms  0.565 ms  0.323 ms
 2  router (217.157.20.129)  1.481 ms  1.374 ms  1.261 ms
\end{alltt}


\slide{traceroute - med UDP}

\begin{alltt}
\small # {\bfseries tcpdump -i en0 host 217.157.20.129 or host 10.0.0.11}
tcpdump: listening on en0
23:23:30.426342 10.0.0.200.33849 > router.33435: udp 12 [ttl 1]
23:23:30.426742 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.436069 10.0.0.200.33849 > router.33436: udp 12 [ttl 1]
23:23:30.436357 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.437117 10.0.0.200.33849 > router.33437: udp 12 [ttl 1]
23:23:30.437383 safri > 10.0.0.200: icmp: time exceeded in-transit
23:23:30.437574 10.0.0.200.33849 > router.33438: udp 12
23:23:30.438946 router > 10.0.0.200: icmp: router udp port 33438 unreachable
23:23:30.451319 10.0.0.200.33849 > router.33439: udp 12
23:23:30.452569 router > 10.0.0.200: icmp: router udp port 33439 unreachable
23:23:30.452813 10.0.0.200.33849 > router.33440: udp 12
23:23:30.454023 router > 10.0.0.200: icmp: router udp port 33440 unreachable
23:23:31.379102 10.0.0.200.49214 > safri.domain:  6646+ PTR? \\
200.0.0.10.in-addr.arpa. (41)
23:23:31.380410 safri.domain > 10.0.0.200.49214:  6646 NXDomain* 0/1/0 (93)
14 packets received by filter
0 packets dropped by kernel
\end{alltt}

\slide{Værdien af traceroute}

\begin{list1}
\item diagnosticering af netværksproblemer - formålet med traceroute
\item indblik i netværkets opbygning!
\item svar fra hosts - en modtaget pakke fremfor et \emph{sort hul}

\item traceroute er ikke et angreb - det er også vigtigt at kunne
  genkende normal trafik!
\end{list1}

\slide{Network mapping}

\hlkimage{23cm}{images/network-example.pdf}

\begin{list1}
\item Ved brug af traceroute og tilsvarende programmer kan man ofte
  udlede topologien i det netværk man undersøger  
\end{list1}

\slide{Flere traceprogrammer}

\begin{list1}

\item mtr My traceroute - grafisk \link{http://www.bitwizard.nl/mtr/}
\item lft - \emph{layer four trace} benytter TCP SYN og FIN prober
\item trace ved hjælp af TCP og andre protokoller findes
\item paratrace - \emph{Parasitic Traceroute via Established TCP Flows
    and IPID Hopcount} 
\item Der findes webservices hvor man kan trace fra, \\
eksempelvis: \link{http://www.traceroute.org}
\end{list1}

\slide{What time is it?}

\hlkimage{8cm}{images/xclock.pdf}

\begin{center}
\hlkbig Hvad er klokken?

\vskip 1 cm
Hvad betydning har det for sikkerheden?

Brug NTP Network Time Protocol på produktionssystemer
\end{center}

\slide{What time is it? - spørg ICMP}

\vskip 1 cm

\begin{list1}
  \item ICMP timestamp option - request/reply
\item hvad er klokken på en server
\item Slayer icmpush - er installeret på server
\item viser tidstempel
\end{list1}

\begin{alltt}
# {\bfseries icmpush -v -tstamp 10.0.0.12}
ICMP Timestamp Request packet sent to 10.0.0.12 (10.0.0.12)

Receiving ICMP replies ...
fischer         -> 21:27:17
icmpush: Program finished OK
\end{alltt}

\slide{Informationsindsamling}

\begin{list1}
\item Det vi har udført er informationsindsamling
\item Indsamlingen kan være aktiv eller passiv indsamling i forhold
  til målet for angrebet
\item passiv kunne være at lytte med på trafik eller søge i databaser
  på Internet
\item aktiv indsamling er eksempelvis at sende ICMP pakker og
  registrere hvad man får af svar
\end{list1}


\slide{whois systemet}

\begin{list1}
\item IP adresserne administreres i dagligdagen af et antal Internet
  registries, hvor de største er:
\begin{list2}
\item RIPE (Réseaux IP Européens)  \link{http://ripe.net}
\item ARIN American Registry for Internet Numbers \link{http://www.arin.net}
\item Asia Pacific Network Information Center \link{http://www.apnic.net}
\item LACNIC (Regional Latin-American and Caribbean IP Address
  Registry) - Latin America and some Caribbean Islands
  \link{http://www.lacnic.net} 
\item AfriNIC African Internet Numbers Registry \link{http://www.afrinic.net}
\end{list2}
\item disse fem kaldes for Regional Internet Registries (RIRs) i
  modsætning til Local Internet Registries (LIRs) og National Internet
  Registry (NIR) 
\end{list1}


\slide{DNS systemet}
 
\begin{list1}
\item navneopslag på Internet  
\item tidligere brugte man en {\bfseries hosts} fil\\
  hosts filer bruges stadig lokalt til serveren - IP-adresser
\item UNIX: /etc/hosts
\item Windows \verb+c:\windows\system32\drivers\etc\hosts+
\item Eksempel: www.security6.net har adressen 217.157.20.131
\item skrives i database filer, zone filer
\end{list1}
\begin{alltt}
  ns1     IN      A       217.157.20.130
  IN      AAAA    2001:618:433::1
  www     IN      A       217.157.20.131
  IN      AAAA    2001:618:433::14
\end{alltt}

\slide{Mere end navneopslag}

\begin{list1}
\item består af resource records med en type:
  \begin{list2}
  \item adresser A-records
  \item IPv6 adresser AAAA-records
  \item autoritative navneservere NS-records
  \item post, mail-exchanger MX-records
  \item flere andre: md ,  mf ,  cname ,  soa ,
    mb , mg ,  mr ,  null ,  wks ,  ptr ,
    hinfo ,  minfo ,  mx ....
  \end{list2}
\end{list1}
\begin{alltt}
  IN      MX      10      mail.security6.net.
  IN      MX      20      mail2.security6.net.
\end{alltt}

\slide{Små DNS tools bind-version - Shell script}

\begin{alltt}\small
#! /bin/sh
# Try to get version info from BIND server
PROGRAM=`basename $0`
. `dirname $0`/functions.sh
if [ $# -ne 1 ]; then
   echo "get name server version, need a target! "
   echo "Usage: $0 target"
   echo "example $0 10.1.2.3"
   exit 0
fi
TARGET=$1
# using dig 
start_time
dig @$1 version.bind chaos txt
echo Authors BIND er i versionerne 9.1 og 9.2 - måske ...
dig @$1 authors.bind chaos txt
stop_time
\end{alltt}
\centerline{\link{http://www.kramse.dk/files/tools/dns/bind-version}}

\slide{Små DNS tools dns-timecheck - Perl script}

\begin{alltt}\small
#!/usr/bin/perl
# modified from original by Henrik Kramshøj, hlk@kramse.dk
# 2004-08-19
#
# Original from: http://www.rfc.se/fpdns/timecheck.html
use Net::DNS;

my $resolver = Net::DNS::Resolver->new;
$resolver->nameservers($ARGV[0]);

my $query = Net::DNS::Packet->new;
$query->sign_tsig("n","test");

my $response = $resolver->send($query);
foreach my $rr ($response->additional) {
  print "localtime vs nameserver $ARGV[0] time difference: ";
  print$rr->time_signed - time() if $rr->type eq "TSIG";
}  
\end{alltt}
% inserting stupid $ to stop EMACS from
\centerline{\link{http://www.kramse.dk/files/tools/dns/dns-timecheck}}


\slide{Intrusion Detection Systems - IDS}

\begin{list1}
\item angrebsværktøjerne efterlader spor
\item hostbased IDS - kører lokalt på et system og forsøger at
  detektere om der er en angriber inde
\item network based IDS - NIDS - bruger netværket
\item Automatiserer netværksovervågning:
  \begin{list2}
  \item bestemte pakker kan opfattes som en signatur
\item analyse af netværkstrafik - FØR angreb
\item analyse af netværk under angreb - sender en alarm
  \end{list2}
\item \link{http://www.snort.org} - det kan anbefales at se på Snort
\end{list1}

\slide{Ulemper ved IDS}

\hlkimage{5cm}{images/snort_tm.png}

\begin{list1}
\item snort er baseret på signaturer
\item mange falske alarmer - tuning og vedligehold
\item hvordan sikrer man sig at man har opdaterede signaturer for
  angreb som går verden rundt på et døgn 
\end{list1}

\slide{TCP sequence number prediction}

\begin{list1}
  \item tidligere baserede man ofte login og adgange på de IP adresser
  som folk kom fra
\item det er ikke pålideligt at tro på address based authentication
\item TCP sequence number kan måske gættes
\item Mest kendt er nok Shimomura der blev hacket på den måde, måske
  af Kevin D Mitnick eller en kompagnon
\end{list1}

\slide{Basal Portscanning}

\begin{list1}
\item Hvad er portscanning
\item afprøvning af alle porte fra 0/1 og op til 65535
\item målet er at identificere åbne porte - sårbare services
\item typisk TCP og UDP scanning
\item TCP scanning er ofte mere pålidelig end UDP scanning
\end{list1}

{\hlkbig TCP handshake er nemmere at identificere

UDP applikationer svarer forskelligt - hvis overhovedet}

\slide{TCP three way handshake}

\hlkimage{7cm}{images/tcp-three-way.pdf}

\begin{list2}
\item {\bfseries TCP SYN half-open} scans
\item Tidligere loggede systemer kun når der var etableret en fuld TCP
  forbindelse - dette kan/kunne udnyttes til \emph{stealth}-scans
\item Hvis en maskine modtager mange SYN pakker kan dette fylde
  tabellen over connections op - og derved afholde nye forbindelser
  fra at blive oprette - {\bfseries SYN-flooding}
\end{list2}


\slide{Ping og port sweep}

\begin{list1}
\item scanninger på tværs af netværk kaldes for sweeps 
\item Scan et netværk efter aktive systemer med PING
\item Scan et netværk efter systemer med en bestemt port åben
\item Er som regel nemt at opdage:
  \begin{list2}
    \item konfigurer en maskine med to IP-adresser som ikke er i brug
\item hvis der kommer trafik til den ene eller anden er det portscan
\item hvis der kommer trafik til begge IP-adresser er der nok
  foretaget et sweep - bedre hvis de to adresser ligger et stykke fra hinanden
  \end{list2}

\end{list1}

\slide{nmap port sweep efter port 80/TCP}

\begin{list1}
  \item Port 80 TCP er webservere
\end{list1}

\begin{alltt}
\small # {\bfseries nmap  -p 80 217.157.20.130/28}

Starting nmap V. 3.00 ( www.insecure.org/nmap/ )
Interesting ports on router.kramse.dk (217.157.20.129):
Port       State       Service
80/tcp     filtered    http                    

Interesting ports on www.kramse.dk (217.157.20.131):
Port       State       Service
80/tcp     open        http                    

Interesting ports on  (217.157.20.139):
Port       State       Service
80/tcp     open        http                    

\end{alltt}

\slide{nmap port sweep efter port 161/UDP}

\begin{list1}
  \item Port 161 UDP er SNMP
\end{list1}

\begin{alltt}  
\small # {\bfseries nmap -sU -p 161 217.157.20.130/28}

Starting nmap V. 3.00 ( www.insecure.org/nmap/ )
Interesting ports on router.kramse.dk (217.157.20.129):
Port       State       Service
161/udp    open        snmp                    

The 1 scanned port on mail.kramse.dk (217.157.20.130) is: closed

Interesting ports on www.kramse.dk (217.157.20.131):
Port       State       Service
161/udp    open        snmp                    

The 1 scanned port on  (217.157.20.132) is: closed
\end{alltt}

\slide{OS detection}
\begin{alltt}
\footnotesize
# nmap -O ip.adresse.slet.tet \emph{scan af en gateway}
Starting nmap 3.48 ( http://www.insecure.org/nmap/ ) at 2003-12-03 11:31 CET
Interesting ports on gw-int.security6.net (ip.adresse.slet.tet):
(The 1653 ports scanned but not shown below are in state: closed)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
1080/tcp open  socks
5000/tcp open  UPnP
Device type: general purpose
Running: FreeBSD 4.X
OS details: FreeBSD 4.8-STABLE
Uptime 21.178 days (since Wed Nov 12 07:14:49 2003)
Nmap run completed -- 1 IP address (1 host up) scanned in 7.540 seconds
\end{alltt}

\begin{list2}
\item lavniveau måde at identificere operativsystemer på, prøv også
  \verb+nmap -A+
\item send pakker med \emph{anderledes} indhold
\item Reference: \emph{ICMP Usage In Scanning} Version 3.0,
  Ofir Arkin\\ \link{http://www.sys-security.com/html/projects/icmp.html}
\end{list2}

\slide{Erfaringer hidtil}

\begin{list1}
  \item mange oplysninger
\item kan man stykke oplysningerne sammen kan man sige en hel del om
  netværket 
\item en skabelon til registrering af maskiner er god
  \begin{list2}
    \item svarer på ICMP: $\Box$\  echo, $\Box$\ mask, $\Box$\ time
\item svarer på traceroute: $\Box$\ ICMP, $\Box$\ UDP
\item Åbne porte TCP og UDP: 
\item Operativsystem:
\item ... (banner information m.v.)
  \end{list2}
\item Mange små pakker kan oversvømme store forbindelser og
  give problemer for netværk
\end{list1}


\slide{Vurdering af produkter}

\begin{list1}
\item Pentesting er ikke kun til test af produktionsnetværk
\item man skal ofte vurdere nye produkter - sikkerhedsmæssigt og
  funktionalitetsmæssigt - yder det beskyttelse, forbedrer det
  sikkerheden m.v.
\end{list1}

\slide{Hvad er værdien af pentest?}

\begin{list1}
\item hvor og hvordan kan I bruge penetrationstest
\item hvis man vil have et andet indblik i netværket, TCP, UDP, ICMP,
  portscannning og samle puslespil udfra få informationer 
\item Netværksadministratorer kan bruge pentesting til at sikre egne
  netværk ved brug af samme teknikker som hackere
\item IT-/sikkerheds-chef vurdere og evaluere tilbud og løsninger for
  sikkerheden. Er den påtænkte løsning fornuftig?
\item Man står med en server der er kompromitteret - hvordan skete
  det? - hvordan forhindrer vi det en anden gang. 
\end{list1}



% dag 2
% session 2-1


\slide{Simple Network Management Protocol}

\begin{list1}
\item SNMP er en protokol der supporteres af de fleste professionelle
  netværksenheder, såsom switche, routere
\item hosts - skal slås til men følger som regel med
\item SNMP bruges til: 
  \begin{list2}
    \item \emph{network management}
    \item statistik
    \item rapportering af fejl - SNMP traps
  \end{list2}
\item {\bfseries sikkerheden baseres på community strings der sendes
    som klartekst ...}
\item det er nemmere at brute-force en community string end en
  brugerid/kodeord kombination
\end{list1}

\slide{brute force}

\begin{list1}
\item hvad betyder bruteforcing?\\
afprøvning af alle mulighederne
\end{list1}

\begin{alltt}
\small
Hydra v2.5 (c) 2003 by van Hauser / THC <vh@thc.org>
Syntax: hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]] 
[-o FILE] [-t TASKS] [-g TASKS] [-T SERVERS] [-M FILE] [-w TIME] 
[-f] [-e ns] [-s PORT] [-S] [-vV] server service [OPT]

Options:
  -S        connect via SSL
  -s PORT   if the service is on a different default port, define it here
  -l LOGIN  or -L FILE login with LOGIN name, or load several logins from FILE
  -p PASS   or -P FILE try password PASS, or load several passwords from FILE
  -e ns     additional checks, "n" for null password, "s" try login as pass
  -C FILE   colon seperated "login:pass" format, instead of -L/-P option
  -M FILE   file containing server list (parallizes attacks, see -T)
  -o FILE   write found login/password pairs to FILE instead of stdout
...  
\end{alltt}


\slide{Windows RPC CVE-2003-0352} 

\begin{list1}
\item Hackergruppe "Last Stage of Delirium" finder sårbarhed i RPC
\item Den 27. juni 2003skrev LSD til Microsoft om fejlen
\begin{list2}
  

\item Microsoft har frigivet rettelser i juli 2003. 
\item LSD har ry for at arbejde seriøst sammen med
produkt-leverandørerne. De kommunikerer sårbarheder til
leverandørerne og frigiver ikke "exploit-programmer" før
leverandørerne har fået en fair chance til at løse deres
problemer. 

\item Beskrivelse af sårbarheden kan findes hos Microsoft på:\\
\link{http://microsoft.com/technet/treeview/default.asp?url=/technet/security/bulletin/MS03-026.asp}
\end{list2}
\item Kilder:\\
%\link{http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-0352}\\
\link{http://www.securityfocus.com/news/6519}\\
\link{http://www.cert.org/advisories/CA-2003-16.html}\\
\link{http://lsd-pl.net/} -  detaljerede beskrivelser af exploits
\end{list1}


\slide{Start på demo}

\hlkimage{16cm}{images/server-client.pdf}

\begin{list2}
\item To almindelige computere - en switch erstatter Internet
\item Windows er installeret på et system og ikke opdateret
\item dcom.c exploit er hentet fra Internet og bruges næsten uændret
\end{list2}


\slide{Hvad sker der?}

\begin{alltt}
[hlk@fiona hlk]$ ./dcom 6 10.0.0.206
---------------------------------------------------------
- Remote DCOM RPC Buffer Overflow Exploit
- Original code by FlashSky and Benjurry
- Rewritten by HDM <hdm [at] metasploit.com>
- Using return address of 0x77e626ba
- Dropping to System Shell...

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

\verb+C:\WINDOWS\system32>exit+   {\bf - find selv på kommandoer, fri adgang!!}

 - Read failure
[hlk@fiona hlk]$ 
\end{alltt}

\slide{Windows RPC/dcom - Blaster orm}

\begin{list1}
\item Kilde: Symantec - 12/8 2003
  \begin{list2}
    
  \item THREAT:          W32.Blaster.Worm
  \item CATEGORY:  3
    W32.Blaster.Worm is a worm that will exploit the DCOM RPC
    vulnerability using TCP port 135. It will attempt to download and
    run a file, msblast.exe. 
  \item STEP 1: Read Critical Information  
  \item STEP 2: Update your Virus Definitions
    
  \end{list2}
  
\item Situationen er den sædvanlige - den almindelige livscyklus for
  en sårbarhed
  \begin{list2}
    \item[10] Der findes en sårbarhed - hackergruppe, leverandør eller
    sikkerhedskonsulent
\item Leverandøren kontaktes og på et tidspunkt offentliggøres
  informationen
\item Der kommer proof-of-concept kode (PoC), exploit program
\item Sårbarheden bliver populær
\item Der kommer en orm - og folk går i panik
%\item \emph{goto 10}
  \end{list2}

\end{list1}


\slide{Sårbarheder - CVE}

\begin{list1}
\item Common Vulnerabilities and Exposures (CVE) er:
  \begin{list2}
  \item klassifikation
  \item unik navngivning af sårbarheder. 
  \end{list2}
\item Sårbarheder tildeles
  \begin{list2}
  \item initielt oprettes med status CANDIDATE
  \end{list2}
\item CVE vedligeholdes af MITRE - som er en not-for-profit 
organisation skabt til forskning og udvikling i USA.
National Vulnerability Database er en af mulighederne for at søge i CVE. 
%\item CVE er et kvantespring indenfor sikkerhed - og en stor succes!
\item Kilde: \link{http://cve.mitre.org/} og \link{http://nvd.nist.gov}
\end{list1}

\slide{Sårbarheder - OSVDB}

\hlkimage{14cm}{images/osvdb-logo.jpg}

\begin{list1}
\item Læg mærke til at der er forskel på antallet af sårbarheder -
  nogle databaser opretter enkeltvis mens andre slår dem sammen
\item Demo sårbarhederne idag tæller eksempelvis i OSVDB 1 sårbarhed
  for hvert sårbart script  
\item Kilde: \link{http://www.osvdb.org}
\end{list1}


\slide{konfigurationsfejl - ofte overset}

\begin{list1}
\item Forkert brug af programmer er ofte overset
\begin{list2}
\item opfyldes forudsætningerne
\item er programmet egnet til dette miljø
\item er man udannet/erfaren i dette produkt
\end{list2}
\item Kunne I finde på at kopiere cmd.exe til
/scripts kataloget på en IIS?
\item Det har jeg engang været ude for at en kunde havde gjort!
\item hvis I under test af en server opdager at denne har
  /scripts/cmd1.exe eller "FTP-scripts" til at hente værktøjer ...
så er den pågældende server formentlig kompromitteret 
\end{list1}



\slide{Undgå standard indstillinger}

\begin{list1}
\item når vi scanner efter services går det nemt med at finde dem
\item Giv jer selv mere tid til at omkonfigurere og opdatere ved at undgå standardindstillinger
\item Tiden der går fra en sårbarhed annonceres på bugtraq til den
  bliver udnyttet er meget kort idag! 
\item Ved at undgå standard indstillinger kan der
  måske opnås en lidt længere frist - inden ormene kommer
\item NB: ingen garanti - og det hjælper sjældent mod en dedikeret angriber
\end{list1}


\slide{buffer overflows et C problem}

\begin{list1}
\item {\bfseries Et buffer overflow}
er det der sker når man skriver flere data end der er afsat plads til
i en buffer, et dataområde. Typisk vil programmet gå ned, men i visse
tilfælde kan en angriber overskrive returadresser for funktionskald og
overtage kontrollen. 
\item {\bfseries Stack protection} 
er et udtryk for de systemer der ved hjælp af operativsystemer,
programbiblioteker og lign. beskytter stakken med returadresser og
andre variable mod overskrivning gennem buffer overflows. StackGuard
og Propolice er nogle af de mest kendte.
\end{list1}

\slide{Exploits - udnyttelse af sårbarheder}

\begin{list1}
\item exploit/exploitprogram er
\begin{list2}
\item udnytter eller demonstrerer en sårbarhed
\item rettet mod et specifikt system.
\item kan være 5 linier eller flere sider
\item Meget ofte Perl eller et C program 
\end{list2}
\end{list1}

Eksempel:
\begin{verbatim}
 #! /usr/bin/perl
 # ./chars.pl | nc server 31337
 print "abcdefghijkl";
 print chr(237);
 print chr(13);
 print chr(220);
 print chr(186);
 print "\n";
\end{verbatim}


\slide{Privilegier least privilege}

\begin{list1}
\item Hvorfor afvikle applikationer med administrationsrettigheder -
  hvis der kun skal læses fra eksempelvis en database?
\item {\bfseries least privilege} 
betyder at man afvikler kode med det mest
restriktive sæt af privileger - kun lige nok til at
opgaven kan udføres
\item Dette praktiseres ikke i webløsninger i Danmark - eller meget få steder
\end{list1}

\slide{Privilegier privilege escalation}
\begin{list1}
\item {\bfseries privilege escalation} er når man på en eller anden vis
opnår højere privileger på et system, eksempelvis som
følge af fejl i programmer der afvikles med højere
privilegier. Derfor HTTPD servere på UNIX afvikles som
nobody - ingen specielle rettigheder.
\item En angriber der kan afvikle vilkårlige kommandoer kan ofte finde
  en sårbarhed som kan udnyttes lokalt - få rettigheder = lille skade
\end{list1}


\slide{local vs. remote exploits}

\begin{list1} 
\item {\bfseries local vs. remote}
angiver om et exploit er rettet mod
en sårbarhed lokalt på maskinen, eksempelvis
opnå højere privilegier, eller beregnet
til at udnytter sårbarheder over netværk
\item {\bfseries remote root exploit} 
- den type man frygter mest, idet
det er et exploit program der når det afvikles giver
angriberen fuld kontrol, root user er administrator
på UNIX, over netværket. 
\item {\bfseries zero-day exploits} dem som ikke offentliggøres - dem
  som hackere holder for sig selv. Dag 0 henviser til at ingen kender
  til dem før de offentliggøres og ofte er der umiddelbart ingen
  rettelser til de sårbarheder
\end{list1}

\slide{Hvordan laves et buffer overflow?}

\begin{list1}
\item Findes ved at prøve sig frem
\begin{list2}
\item black box testing
\item closed source
\item reverse engineering
\end{list2}
\item Ved Open source Findes de typisk ved at læse/analysere koden 
\begin{list2}
\item RATS
\item flere andre 
\end{list2}
\item Virker typisk mod specifikke versioner
\begin{list2}
\item Windows IIS 4.0 med service pack XX
\item Red Hat Linux 7.3 default
\end{list2}
\end{list1}

\slide{Demo: Insecure programming buffer overflows 101}

{\bfseries Opgave:} Lav et C program og oversæt det

{\bfseries Forslag til fremgangsmåde:}
\begin{list2}
\item Prøv at skrive dette program ind som \verb+demo.c+
\item Dernæst oversættes med kommandoen:
\verb+gcc -o demo demo.c+
\item start programmet med kommandoen
\verb+./demo test+ eller andre input
\end{list2}

{\bfseries Hjælp:}
\begin{alltt}
main(int argc, char **argv)
\{      char buf[10];
        strcpy(buf, argv[1]); 
        printf("%s\textbackslash{}n",buf);
\}
the_shell()
\{  system("/bin/sh");  \}
\end{alltt}


\slide{GDB GNU Debugger}

\begin{list1}
  \item GNU compileren og debuggeren fungerer godt!
\item prøv \verb+gdb ./demo+ og kør derefter programmet fra \emph{gdb prompten}
med  \verb+run 1234+
\item når I således ved hvor lang strengen skal være kan I fortsætte
  med \verb+nm+ kommandoen - til at finde adressen på
  \verb+the_shell+\\
skriv \verb+nm demo | grep shell+

\item Kunsten er således at generere en streng der er præcist så lang
  at man får lagt denne adresse ind på det \emph{rigtige sted}.
\item Perl kan erstatte AAAAA således \verb+`perl -e "print 'A'x10"`+
\end{list1}


\slide{Øvelse: C debug med GDB}

\begin{list1}
\item Vi laver sammen en session med GDB
\item Afprøvning med diverse input
\begin{list2}
\item \verb+./demo langstrengsomgiverproblemerforprogrammethvorformon+    
\item \verb+gdb demo+ efterfulgt af run med parametre\\
\verb+run AAAAAAAAAAAAAAAAAAAAAAAAAAAAA+
\end{list2}
\end{list1}

{\bfseries Hjælp:}\\
Kompiler programmet og kald det fra kommandolinien med 
\verb+./demo 123456...7689+ indtil det dør ... derefter prøver I det
samme i GDB

Hvad sker der? Avancerede brugere kan ændre 
\verb+strcpy+ til \verb+strncpy+


\slide{GDB output}

\begin{alltt}
\small
hlk@bigfoot:demo$ gdb demo
GNU gdb 5.3-20030128 (Apple version gdb-330.1) (Fri Jul 16 21:42:28 GMT 2004)
Copyright 2003 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "powerpc-apple-darwin".
Reading symbols for shared libraries .. done
(gdb) {\bf run AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA}
Starting program: /Volumes/userdata/projects/security/exploit/demo/demo AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Reading symbols for shared libraries . done
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Program received signal EXC_BAD_ACCESS, Could not access memory.
{\bf 0x41414140} in ?? ()
(gdb) 
\end{alltt}
%$

\slide{Buffer overflows}

\hlkimage{3cm}{images/shellcoders-handbook.jpg}

\begin{list1}
\item Hvis man vil lære at lave buffer overflows og exploit programmer
  er følgende dokumenter et godt sted at starte
\item \emph{Smashing The Stack For Fun And Profit} Aleph One
\item \emph{Writing Buffer Overflow Exploits with Perl - anno 2000}
\item Følgende bog kan ligeledes anbefales:
\emph{The Shellcoder's Handbook : Discovering and Exploiting Security Holes} 
af Jack Koziol, David Litchfield, Dave Aitel, Chris Anley, Sinan
"noir" Eren, Neel Mehta, Riley Hassell, John Wiley \& Sons, 2004 
\item NB: bogen er avanceret og således IKKE for begyndere! 
\end{list1}



\slide{Stack protection}

\begin{list1}
\item Stack protection er mere almindeligt\\
- med i OpenBSD current fra 2. dec 2002

\item Buffer overflows er almindeligt kendte
\begin{list2}    
\item Selv OpenSSH har haft buffer overflows
\item Stack protection prøver at modvirke/fjerne
  muligheden for buffer overflows. arbitrary code execution
  bliver til ude af drift for berørte services
\end{list2}

\item Propolice\\
\link{http://www.openbsd.org}\\
\link{http://www.trl.ibm.com/projects/security/ssp/}

\item StackGuard\\
\link{http://www.immunix.org/stackguard.html}
\end{list1}


\slide{JAVA programmering}

\begin{list1}
\item Hvorfor ikke bare bruge JAVA?
\item JAVA karakteristik
\begin{list2}
\item automatisk garbage collection
\item bytecode verifikation på
\item mulighed for signeret kode
\item beskyldes for at være langsomt
\item platformsuafhængigt
\end{list2}
\item JAVA just in Time (JIT) er sammenligneligt med kompileret C
\item god sikkerhedsmodel - men problemer i implementationerne
\item JVM - den virtuelle maskine er dog skrevet i C og udsat for angreb
\end{list1}


\slide{Hackerværktøjer}

\begin{list1}
\item Dan Farmer og Wietse Venema skrev i 1993 artiklen\\
\emph{Improving the Security of Your Site by Breaking Into it}
\item Senere i 1995 udgav de så en softwarepakke med navnet SATAN
\emph{Security Administrator Tool for Analyzing Networks}
 Pakken vagte
 en del furore, idet man jo gav alle på internet mulighed for at hacke
\begin{quote}
We realize that SATAN is a two-edged sword - like
many tools, it can be used for good and for evil
purposes. We also realize that intruders (including
wannabees) have much more capable (read intrusive)
tools than offered with SATAN. 
\end{quote}
\item SATAN og ideerne med automatiseret scanning efter sårbarheder
  blev siden ført videre i programmer som Saint, SARA og idag findes
  mange hackerværktøjer og automatiserede scannere: 
\begin{list2}
\item Nessus, ISS scanner, Fyodor Nmap, Typhoon, ORAscan
\end{list2}
\end{list1}
Kilde:
\link{http://www.fish.com/security/admin-guide-to-cracking.html}



\slide{Brug hackerværktøjer!}

\begin{list1}
\item Hackerværktøjer - bruger I dem? - efter dette kursus gør I 
\item portscannere kan afsløre huller i forsvaret
\item webtestværktøjer som crawler igennem et website og finder alle
  forms kan hjælpe
\item I vil kunne finde mange potentielle problemer proaktivt ved
  regelmæssig brug af disse værktøjer - også potentielle driftsproblemer
\item husk dog penetrationstest er ikke en sølvkugle
\item honeypots kan måske være med til at afsløre angreb og
  kompromitterede systemer hurtigere
\end{list1}


% opgaver session 3-4
\slide{Pentest med Nessus}

\hlkimage{22cm}{images/nessus-netvaerk.pdf}

\begin{list1}
\item Nessus er en Open Source sårbarhedsscanner
\item Baseret på en server og en klient 
\link{http://www.nessus.org}
\end{list1}

\slide{Sikkerhedsteknologier}

\begin{list1}
\item Brug alt hvad I kan overkomme:
\begin{list2}
\item Firewalls: IPfilter, IPtables, OpenBSD PF
\item Kryptografi 
\item Secure Shell - SSH
\item betragt Telnet, Rlogin, Rsh, Rexec som døde!
\item FTP bør kun bruges til anonym FTP
\item Intrusion Detection - Snort
\item Sudo
\item Tripwire, mtree, MD5
\end{list2}
\item Sikkerhedspolitikken er din "plan" for sikkerheden
- og er med til at sikre niveauet er ens
\item Firewalls hjælper ikke mod alle trusler
\end{list1}

\slide{Opsummering afslutning}

\begin{list1}
\item Husk følgende:
\begin{list2}
\item Husk: IT-sikkerhed er ikke kun netværkssikkerhed!
\item Sikkerhed kommer fra langsigtede intiativer\\
 {\bfseries Vi håber I kan genkende de problemer vi har talt om,
    og finde information om nye problemer i netværk som bliver kendt\\
 eksempelvis nye metoder til scanning eller omgåelse af
    firewalls} 
\item Hvad er informationssikkerhed?
\item Data på elektronisk form
\item Data på fysisk form
\item Social engineering er måske overset - \emph{The Art of Deception: 
Controlling the Human Element of Security}
af Kevin D. Mitnick, William L. Simon, Steve Wozniak
\end{list2}
\item Computer Forensics er reaktion på en hændelse
\item {\bfseries Informationssikkerhed er en proces}
\end{list1}

\slide{Anbefalinger generelt}

\begin{list1}
\item Drop legacy kompatibilitet
\item Udryd gamle usikre
\begin{list2}
\item protokoller - som SSH version 1
\item programmer telnet, FTP, R* - password i klartekst
\item services NT LAN manager
\end{list2}
\item {\bfseries VÆK med dem!}
\item Det handler om sikkerhed, det der ikke er
aktivt kan ikke misbruges
\item undgå standardindstillinger
\end{list1}

\slide{Anbefalinger til jer}
% oversigt over dem

{\bf \large Oversigt over anbefalinger} 
\begin{list1}
\item {\bf Følg med!} - læs websites, bøger, artikler, mailinglister, ...
\item {\bf Vurder altid sikkerhed} - skal integreres i processer
\item {\bf Hændelseshåndtering} - du vil komme ud for sikkerhedshændelser
\item {\bf Lav en sikkerhedspolitik} - herunder software og e-mail politik 
\end{list1}

{\hlkbig \bfseries Hver måned offentliggøres ca. 100 nye
sårbarheder i produkter - software/hardware }


\slide{Følg med! - mange kilder}
\begin{list1}
\item {\bf websites} prøv at kigge både på officielle/kommercielle websites
  - men også indimellem på \emph{de små gyder} på Internet 
\item {\bf bøger} der er en god liste over \emph{MUST READ} sikkerhedsbøger
  på adressen\\
\href{http://sun.soci.niu.edu/~rslade/mnbksccd.htm}
{http://sun.soci.niu.edu/\~{}rslade/mnbksccd.htm}
\item {\bf artikler} mange steder, men eksempelvis\\ 
\link{http://www.securityfocus.com}
\item {\bf mailinglister} leverandør ejede lister og generelle - som
  bugtraq og full-disclosure
\item {\bf personer} der findes personer på Internet som er værd at
  holde øje med. Eksempelvis: Bruce Schneiers nyhedsbrev crypto-gram\\
  \link{http://www.counterpane.com/crypto-gram.html}
\end{list1}


\slide{Spørgsmål?}


\vskip 4cm

\begin{center}
\hlkbig 

\myname

\myweb
\vskip 2 cm

I er altid velkomne til at sende spørgsmål på e-mail
\end{center}

% opgaver
%\slide{}

%\label{ex:sample}

%{\bfseries Opgave:} 

%{\bfseries Forslag til fremgangsmåde:} 

%{\bfseries Hjælp:} 

%{\bfseries Diskussion:} 



\slide{Reklamer: kursusafholdelse}

\begin{list1}
\item Følgende kurser afholdes med mig som underviser
\begin{list2}
\item IPv6 workshop - 1 dag\\
 Introduktion til Internetprotokollerne og forberedelse til
  implementering i egne netværk. 
\item Wireless teknologier og sikkerhed workshop - 1-2 dage\\
En dag med fokus på netværksdesign og fornuftig implementation af
trådløse netværk, samt integration med hjemmepc og
wirksomhedsnetværk. 
\item Hacker workshop 2 dage\\
Workshop med detaljeret gennemgang af hackermetoderne angreb over
netværk, exploitprogrammer, portscanning, Nessus m.fl.
\item Forensics workshop 2 dage\\
Med fokus på tilgængelige open source værktøjer gennemgås metoder og
praksis af undersøgelse af diskimages og spor på computer systemer
\item Moderne Firewalls og Internetsikkerhed 2 dage\\
Informere om trusler og aktivitet på Internet, samt give et bud
på hvorledes en avanceret moderne firewall idag kunne konfigureres.
\end{list2}
\end{list1}

Se mere på \link{http://www.security6.net/courses.html}

\slide{Network Security Tools}

\hlkimage{5cm}{images/network-security-tool-ora.jpg}
\begin{list1}
\item \emph{Network Security Tools : Writing, Hacking, and Modifying
    Security Tools} Nitesh Dhanjani, Justin Clarke, O'Reilly 2005, ISBN:
    0596007949 
 \end{list1}

\slide{}

\hlkimage{5cm}{images/freebsd-openbsd-security-tools-ora.jpg}
\begin{list1}
\item \emph{Mastering FreeBSD and OpenBSD Security} Yanek Korff, Paco
  Hope, Bruce Potter, O'Reilly, 2005, ISBN: 0596006268
\end{list1}

\slide{Hackers Challenge}

\begin{center}
\colorbox{white}{
\includegraphics[width=3cm]{images/hackers-challenge.jpg}
\includegraphics[width=33mm]{images/hackers-challenge2.jpg}}
\end{center}

\begin{list1}
%\item Hændelseshåndtering - øvelse som I kigger på i weekenden
%\item Opgaverne er kopieret fra bogen 
\item \emph{Hacker's Challenge : Test Your Incident Response Skills Using 20 Scenarios}
 af Mike Schiffman McGraw-Hill Osborne Media; (October 18, 2001) ISBN:
 0072193840
\item \emph{Hacker's Challenge II : Test Your Network Security and
 Forensics Skills} 
 af Mike Schiffman McGraw-Hill Osborne Media, 2003 ISBN: 0072226307
\item Bogen indeholder scenarier i første halvdel, og løsninger i
  anden halvdel - med fokus på relevante logfiler og sårbarheder  
\item Hackers challenge nr 3 udkommer i 2006
\end{list1}


\slide{Network Security Assessment}

\begin{center}
\colorbox{white}{
\includegraphics[width=6cm]{images/oreilly-networksa.png}}
\end{center}

\begin{list1}
%\item Hændelseshåndtering - øvelse som I kigger på i weekenden
%\item Opgaverne er kopieret fra bogen 
\item \emph{Network Security Assessment 
Know Your Network}
 af Chris McNab, O'Reilly Marts 2004 ISBN: 0-596-00611-X
\item Bogen er anbefalelsesværdig
\item Der kan hentes kapitel 4 som PDF - \emph{IP Network Scanning}
\end{list1}

\slide{Counter Hack}

\hlkimage{6cm}{images/counter-hack.jpg}

\begin{list1}
\item \emph{Counter Hack: A Step-by-Step Guide to Computer Attacks and
Effective Defenses}, Ed Skoudis, Prentice Hall PTR, 1st edition July 2001
\item Bogen er anbefalelsesværdig og er kommet i anden udgave
\item Minder mig om et universitetskursus i opbygningen
\end{list1}

\slide{Hackerværktøjer}
% måske til reference afsnit?

\begin{list2}
\item nmap - \link{http://www.insecure.org} portscanner
\item Nessus - \link{http://www.nessus.org} automatiseret testværktøj
%\item libnet m.fl. - \link{http://www.packetfactory.net} - diverse projekter
%  relateret til pakker og IP netværk
\item l0phtcrack - \link{http://www.atstake.com/research/lc/} - The Password
  Auditing and Recovery Application, kig også på Cain og Abel fra
  \link{http://oxid.it} hvis det skal være gratis
\item Wireshark - \link{http://www.wireshark.org} avanceret netværkssniffer
%\item F.I.R.E -  \link{http://biatchux.dmzs.com/} - en cd-rom der indeholder en 
%  bootable Linux del.
\item OpenBSD - \link{http://www.openbsd.org} operativsystem med fokus
  på sikkerhed 
\item \link{http://www.isecom.org/} - Open Source Security Testing
  Methodology Manual - gennemgang af elementer der bør indgå i en struktureret test 
\item Putty - 
\link{http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html}

terminal emulator med indbygget SSH

\item 
\link{http://www.remote-exploit.org} - Backtrack security collection -
en boot CD med hackerværktøjer
\end{list2}

\slide{Referencer}

\begin{list1}
\item Anbefalede bøger:
\begin{list2}
\item \emph{Computer Forensics: Incident Response Essentials}, Warren
  G. Kruse II og Jay G. Heiser, Addison-Wesley, 2002.
\item \emph{Incident Response}, E. Eugene Schultz og Russel Shumway,
  New Riders, 2002
\item \emph{CISSP All-in-One Certification Exam Guide}, Shon Harris 
McGraw-Hill/Osborne, 2002
\item \emph{Network Intrusion Detection}, Stephen Northcutt og Judy Novak, New
  Riders, 2nd edition, 2001
\item \emph{Intrusion Signatures and Analysis}, Stephen Northcutt et al, New
  Riders, 2001
\item \emph{Practical UNIX and Internet Security}, Simson Garfinkel og
  Gene Spafford, 2nd edition
\item \emph{Firewalls and Internet Security},  Cheswick,
  Bellovin og Rubin, Addison-Wesley, 2nd edition, 2003
\item \emph{Hacking Exposed}, Scambray et al, 4th edition, Osborne, 2003 
  - tror der er en nyere  
  \item \emph{Building Open Source Network Security Tools}, Mike
  D. Schiffman, Wiley 2003 
\item \emph{Gray Hat Hacking : The Ethical Hacker's Handbook} Shon
  Harris, Allen  Harper, Chris  Eagle, Jonathan  Ness,
  Michael Lester, McGraw-Hill Osborne Media 2004, ISBN: 0072257091
\end{list2}
\end{list1}


\slide{Referencer}

\begin{list1}
\item Internet
  \begin{list2}
  \item \link{http://www.project.honeynet.org} - diverse honeynet projekter
  information om pakker og IP netværk. Har flere forensics challenges
  hvor man kan hente images og foretage sin egen analyse
  \item \link{http://www.packetfactory.net} - diverse projekter
  relateret til pakker og IP netværk eksempelvis libnet

\item \link{http://www.isecom.org/} - Open Source Security Testing
  Methodology Manual - Hvordan laver man struktureret test! 

\end{list2}
\item Mailinglists
  \begin{list2}
    \item securityfocus m.fl. - de fleste producenter og væktøjer
    har mailinglister tilknyttet
  \end{list2}
\item Papers - der findes MANGE dokumenter på Internet
\begin{list2}
\item \emph{Security Problems in the TCP/IP Protocol Suite},
  S.M. Bellovin, 1989 og fremefter
\end{list2}
\end{list1}

\slide{Packet factory projects}

\begin{center}
\colorbox{white}{\includegraphics[width=20cm]{images/packetfactory-header.jpg}}
\end{center}

\begin{list2}
\item Projects (udvalgte):
\item firewalk [gateway ACL scanner]
\item firestorm (in development) [next 
  generation scanner]
\item ISIC [IP stack integrity checker]
\item libnet [network packet assembly/injection library]     
\item libradiate [802.11b frame assembly/injection library]     
\item nemesis [command line IP stack]     
\item ngrep [GNU grep for the network]     
\item packit [tool to monitor, and inject customized IPv4 traffic]     
\item Billede og information fra \link{http://www.packetfactory.net}
\end{list2}



\slide{CISSP fra ISC2}

\hlkimage{16cm}{images/cissp-logo.png}

\begin{list1}
\item Primære website: \link{http://www.isc2.org}
\item Vigtigt link \link{http://www.cccure.org/}
\item Den kræver mindst 3 års erfaring indenfor et relevant fagområde
\item Multiple choice 6 timer 250 spørgsmål - kan tages i Danmark
\end{list1}



\slide{GIAC GSEC krav}

\hlkimage{4cm}{images/SANS-logo.png}

\begin{list1}
\item Security Essentials - basal sikkerhed
\item Krav om en \emph{Practical assignment} - mindst 8 sider, 15
  sider i gennemsnit
\item multiple choice eksamen
\item Primære website: \link{http://www.giac.org}
\item Reading room: \link{http://www.sans.org/rr/}
\item Der findes en god oversigt i filen 
\emph{GIAC Certification: Objectives and Curriculum}\\
  \link{http://www.giac.org/overview/brief.pdf}

\end{list1}

\end{document}
